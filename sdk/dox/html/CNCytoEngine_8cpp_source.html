<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Affymetrix Power Tools: copynumber/CNCytoEngine.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_41dda80f44caddc01a4a55d902223772.html">copynumber</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>CNCytoEngine.cpp</h1>  </div>
</div>
<div class="contents">
<a href="CNCytoEngine_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">////////////////////////////////////////////////////////////////</span>
<a name="l00002"></a>00002 <span class="comment"></span><span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2005 Affymetrix, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This program is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">// it under the terms of the GNU General Public License (version 2) as</span>
<a name="l00007"></a>00007 <span class="comment">// published by the Free Software Foundation.</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a name="l00012"></a>00012 <span class="comment">// General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment">// along with this program;if not, write to the</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 <span class="comment">// Free Software Foundation, Inc.,</span>
<a name="l00018"></a>00018 <span class="comment">// 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00019"></a>00019 <span class="comment">//</span><span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">////////////////////////////////////////////////////////////////</span>
<a name="l00021"></a>00021 <span class="comment"></span><span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">/**</span>
<a name="l00023"></a>00023 <span class="comment"> * @file CNCytoEngine.cpp</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * @brief This file contains the CNCytoEngine class members.</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="CNCytoEngine_8h.html" title="This header contains the Log2RatioEngine class definition.">copynumber/CNCytoEngine.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="comment">//</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="Annotation_8h.html" title="Wrapper for the SQLite Annotation database.">copynumber/Annotation.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="CNAnalysisEngine_8h.html" title="This header contains the CNAnalysisEngine class definition.">copynumber/CNAnalysisEngine.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="CNAnalysisMethodChipstream_8h.html" title="This header contains the CNAnalysisMethodChipstream class definition.">copynumber/CNAnalysisMethodChipstream.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="CNAnalysisMethodFactory_8h.html" title="This header contains the CNAnalysisMethodFactory class definition.">copynumber/CNAnalysisMethodFactory.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="CNAnalysisMethodReference_8h.html" title="This header contains the CNAnalysisMethodReference class definition.">copynumber/CNAnalysisMethodReference.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="CNAnalysisMethodCovariateParams_8h.html" title="Class containing common data for covariate-based signal and log2ratio adjustment.">copynumber/CNAnalysisMethodCovariateParams.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;broadutil/BroadException.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="ExceptionBase_8h.html">calvin_files/exception/src/ExceptionBase.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;chipstream/CnProbeGenderCelListener.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="EngineUtil_8h.html" title="Some common functions that application executables make use of.">chipstream/EngineUtil.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;file5/File5.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;file5/File5_File.h&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="Fs_8h.html" title="///">util/Fs.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="TmpFileFactory_8h.html" title="///">util/TmpFileFactory.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="comment">//</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;../external/newmat/myexcept.h&quot;</span>
<a name="l00047"></a>00047 <span class="comment">//</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00049"></a>00049 <span class="comment">//</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <a class="code" href="classCNCytoEngine_1_1Reg.html">CNCytoEngine::Reg</a> <a class="code" href="classCNCytoEngine.html#a39dd23fc8a71dc05594dece3617d156d">CNCytoEngine::reg</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="classCNCytoEngine.html#a435136ab656a8bee121b49b14776cd09">00054</a> <a class="code" href="classCNCytoEngine.html" title="The engine for controlling the copynumber Cytos.">CNCytoEngine</a> * <a class="code" href="classCNCytoEngine.html#a435136ab656a8bee121b49b14776cd09">CNCytoEngine::FromBase</a>(<a class="code" href="classBaseEngine.html" title="Base class for analysis engines.">BaseEngine</a> *engine)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     <span class="keywordflow">if</span> (engine != NULL &amp;&amp; engine-&gt;getEngineName() == CNCytoEngine::EngineName())
<a name="l00057"></a>00057         <span class="keywordflow">return</span> (<a class="code" href="classCNCytoEngine.html" title="The engine for controlling the copynumber Cytos.">CNCytoEngine</a> *)engine;
<a name="l00058"></a>00058     <span class="keywordflow">return</span> NULL;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 <span class="comment"></span>
<a name="l00061"></a>00061 <span class="comment">/**</span>
<a name="l00062"></a>00062 <span class="comment"> * @brief Constructor</span>
<a name="l00063"></a>00063 <span class="comment"> */</span>
<a name="l00064"></a><a class="code" href="classCNCytoEngine.html#aae5598aa675033fd9f0339bfbfcfbd41">00064</a> <a class="code" href="classCNCytoEngine.html#aae5598aa675033fd9f0339bfbfcfbd41" title="Constructor.">CNCytoEngine::CNCytoEngine</a>()
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     m_pstdMethods = NULL;
<a name="l00067"></a>00067     <a class="code" href="classCNCytoEngine.html#afcb62b004efe154cf020f0a031a6a3a0" title="Define any standard methods used by the engine.">defineStdMethods</a>();
<a name="l00068"></a>00068     defineOptions();
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 <span class="comment"></span>
<a name="l00071"></a>00071 <span class="comment">/**</span>
<a name="l00072"></a>00072 <span class="comment"> * @brief Destructor</span>
<a name="l00073"></a>00073 <span class="comment"> */</span>
<a name="l00074"></a><a class="code" href="classCNCytoEngine.html#ad142a80f8189faf660286f7bbf934259">00074</a> <a class="code" href="classCNCytoEngine.html#ad142a80f8189faf660286f7bbf934259" title="Destructor.">CNCytoEngine::~CNCytoEngine</a>()
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076     <a class="code" href="classCNCytoEngine.html#a73f4a636dbcce9f8819ef2c7b58fed4a" title="Initialize the data and free any memory allocated.">clear</a>();
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 <span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">/**</span>
<a name="l00080"></a>00080 <span class="comment"> * @brief Initialize the data and free any memory allocated.</span>
<a name="l00081"></a>00081 <span class="comment"> */</span>
<a name="l00082"></a><a class="code" href="classCNCytoEngine.html#a73f4a636dbcce9f8819ef2c7b58fed4a">00082</a> <span class="keywordtype">void</span> <a class="code" href="classCNCytoEngine.html#a73f4a636dbcce9f8819ef2c7b58fed4a" title="Initialize the data and free any memory allocated.">CNCytoEngine::clear</a>()
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084     <span class="keywordflow">if</span> (m_pstdMethods != NULL) {<span class="keyword">delete</span> m_pstdMethods; m_pstdMethods = NULL;}
<a name="l00085"></a>00085     <span class="comment">// Clean up static data.</span>
<a name="l00086"></a>00086     CNExperiment::getQCMetricColumnNames()-&gt;deleteAll();
<a name="l00087"></a>00087     CNAnalysisMethod::getCelFileParams()-&gt;clear();
<a name="l00088"></a>00088     Annotation::getParams()-&gt;clear();
<a name="l00089"></a>00089     CNAnalysisMethod::getParams()-&gt;clear();
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 <span class="comment"></span>
<a name="l00092"></a>00092 <span class="comment">/**</span>
<a name="l00093"></a>00093 <span class="comment"> * @brief Define any standard methods used by the engine</span>
<a name="l00094"></a>00094 <span class="comment"> */</span>
<a name="l00095"></a><a class="code" href="classCNCytoEngine.html#afcb62b004efe154cf020f0a031a6a3a0">00095</a> <span class="keywordtype">void</span> <a class="code" href="classCNCytoEngine.html#afcb62b004efe154cf020f0a031a6a3a0" title="Define any standard methods used by the engine.">CNCytoEngine::defineStdMethods</a>() {
<a name="l00096"></a>00096 <span class="comment">//    m_stdMethods[&quot;brlmm&quot;] = &quot;quant-norm.sketch=50000,pm-only,brlmm.transform=ccs.K=4&quot;;</span>
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">/**</span>
<a name="l00100"></a>00100 <span class="comment"> * @brief Print any standard methods used by the engine</span>
<a name="l00101"></a>00101 <span class="comment"> * @param std::ostream&amp; - The specified output stream</span>
<a name="l00102"></a>00102 <span class="comment"> */</span>
<a name="l00103"></a>00103 <span class="keywordtype">void</span> CNCytoEngine::printStandardMethods(std::ostream &amp;out) {
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (m_pstdMethods == NULL) {<span class="keywordflow">return</span>;}
<a name="l00105"></a>00105     std::map&lt;std::string,std::string&gt;::iterator iter;
<a name="l00106"></a>00106     out &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Standard Methods:&quot;</span> &lt;&lt; std::endl;
<a name="l00107"></a>00107       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxLength = 0;
<a name="l00108"></a>00108       <span class="keywordflow">for</span>(iter = m_pstdMethods-&gt;begin(); iter != m_pstdMethods-&gt;end(); iter++) {
<a name="l00109"></a>00109         <span class="keywordflow">if</span>(iter-&gt;first.size() &gt; maxLength)
<a name="l00110"></a>00110           maxLength = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)iter-&gt;first.size();
<a name="l00111"></a>00111       }
<a name="l00112"></a>00112       <span class="keywordflow">for</span>(iter = m_pstdMethods-&gt;begin(); iter != m_pstdMethods-&gt;end(); iter++) {
<a name="l00113"></a>00113         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentLength = 0;
<a name="l00114"></a>00114         out &lt;&lt; <span class="stringliteral">&quot; &#39;&quot;</span> &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">&quot;&#39; &quot;</span>;
<a name="l00115"></a>00115         currentLength = (<span class="keywordtype">unsigned</span> int)iter-&gt;first.size();
<a name="l00116"></a>00116         <span class="keywordflow">while</span>(currentLength &lt; maxLength + 1) {
<a name="l00117"></a>00117             out.put(<span class="charliteral">&#39; &#39;</span>);
<a name="l00118"></a>00118           currentLength++;
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120         out &lt;&lt; iter-&gt;second &lt;&lt; std::endl;
<a name="l00121"></a>00121       }
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 <span class="comment"></span>
<a name="l00124"></a>00124 <span class="comment">/**</span>
<a name="l00125"></a>00125 <span class="comment"> * @brief Define the options used by this engine</span>
<a name="l00126"></a>00126 <span class="comment"> */</span>
<a name="l00127"></a>00127 <span class="keywordtype">void</span> CNCytoEngine::defineOptions() {
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   defineOptionSection(<span class="stringliteral">&quot;Input Options&quot;</span>);
<a name="l00130"></a>00130   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chipstream&quot;</span>, PgOpt::STRING_OPT,
<a name="l00131"></a>00131                     <span class="stringliteral">&quot;String representing chipstream parameters. This includes normal-diploid analysis parameters .&quot;</span>,
<a name="l00132"></a>00132                     <span class="stringliteral">&quot;chipstream&quot;</span>);
<a name="l00133"></a>00133   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;check-input-files&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00134"></a>00134                      <span class="stringliteral">&quot;Does an upfront check of the syntax and content of the input files: gender-override, genotype-call-override, snp-reference-input files.&quot;</span>,
<a name="l00135"></a>00135                      <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00136"></a>00136   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;doDualNormalization&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00137"></a>00137                      <span class="stringliteral">&quot;The usual default action is to normalize SNP and CN probeset separately.  This option allows a single normalization set for CytoScanHD chips.  &quot;</span>,
<a name="l00138"></a>00138                      <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00139"></a>00139   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;config-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00140"></a>00140                     <span class="stringliteral">&quot;The configuration file name as passed from GTC or the Cyto Browser.&quot;</span>,
<a name="l00141"></a>00141                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00142"></a>00142   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;antigenomic-probe-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00143"></a>00143                     <span class="stringliteral">&quot;The probe indexes (ProbeID - 1) of the antigenomic probes on the array.&quot;</span>,
<a name="l00144"></a>00144                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00145"></a>00145   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-reference-input-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00146"></a>00146                     <span class="stringliteral">&quot;Input SNP reference file name.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00147"></a>00147   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-input&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;Input reference file name.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00148"></a>00148   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00149"></a>00149                      <span class="stringliteral">&quot;File defining probe sequences and locations.&quot;</span>,
<a name="l00150"></a>00150                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00151"></a>00151   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cdf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00152"></a>00152                      <span class="stringliteral">&quot;File defining probe sets.&quot;</span>,
<a name="l00153"></a>00153                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00154"></a>00154   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;spf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00155"></a>00155                      <span class="stringliteral">&quot;spf format file defining probe sets.&quot;</span>,
<a name="l00156"></a>00156                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00157"></a>00157   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;qcc-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00158"></a>00158                      <span class="stringliteral">&quot;File defining QC probesets.&quot;</span>,
<a name="l00159"></a>00159                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00160"></a>00160   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;qca-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00161"></a>00161                      <span class="stringliteral">&quot;File defining QC analysis methods.&quot;</span>,
<a name="l00162"></a>00162                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00163"></a>00163   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cel-files&quot;</span>, PgOpt::STRING_OPT,
<a name="l00164"></a>00164                      <span class="stringliteral">&quot;Text file specifying cel files to process, one per line with the &quot;</span>
<a name="l00165"></a>00165                      <span class="stringliteral">&quot;first line being &#39;cel_files&#39;.&quot;</span>,
<a name="l00166"></a>00166                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00167"></a>00167   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chrX-probes&quot;</span>, PgOpt::STRING_OPT,
<a name="l00168"></a>00168                      <span class="stringliteral">&quot;File containing probe_id (1-based) of probes on chrX. &quot;</span>
<a name="l00169"></a>00169                      <span class="stringliteral">&quot;Used for copy number probe chrX/Y ratio gender calling.&quot;</span>,
<a name="l00170"></a>00170                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00171"></a>00171   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chrY-probes&quot;</span>, PgOpt::STRING_OPT,
<a name="l00172"></a>00172                      <span class="stringliteral">&quot;File containing probe_id (1-based) of probes on chrY. &quot;</span>
<a name="l00173"></a>00173                      <span class="stringliteral">&quot;Used for copy number probe chrX/Y ratio gender calling.&quot;</span>,
<a name="l00174"></a>00174                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00175"></a>00175   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;normal-diploid-files-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00176"></a>00176                    <span class="stringliteral">&quot;Text file specifying normal-diploid probeset files. First line must be &#39;normal_diploid_files&#39;.&quot;</span>,
<a name="l00177"></a>00177                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00178"></a>00178   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-cels&quot;</span>, PgOpt::STRING_OPT,
<a name="l00179"></a>00179                      <span class="stringliteral">&quot;&#39;Normal&#39; CEL file(s) to process when doing paired analysis of Cancer vs. Normal.&quot;</span>,
<a name="l00180"></a>00180                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00181"></a>00181   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;annotation-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00182"></a>00182                      <span class="stringliteral">&quot;NetAffx Annotation database file.&quot;</span>,
<a name="l00183"></a>00183                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00184"></a>00184   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;normal-diploid-files&quot;</span>, PgOpt::STRING_OPT,
<a name="l00185"></a>00185                      <span class="stringliteral">&quot;Normal Diploid probeset file names.&quot;</span>,
<a name="l00186"></a>00186                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00187"></a>00187   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;sketch-size&quot;</span>, PgOpt::INT_OPT,
<a name="l00188"></a>00188                     <span class="stringliteral">&quot;The number number of point to be used for a sketch.&quot;</span>,  <span class="stringliteral">&quot;50000&quot;</span>);
<a name="l00189"></a>00189   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;covariates-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00190"></a>00190                      <span class="stringliteral">&quot;External covariates file.&quot;</span>,
<a name="l00191"></a>00191                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00192"></a>00192   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;minSegSeparation&quot;</span>, PgOpt::INT_OPT,
<a name="l00193"></a>00193                     <span class="stringliteral">&quot;Value used to skip over centromere in LOH.&quot;</span>,  <span class="stringliteral">&quot;1000000000&quot;</span>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   defineOptionSection(<span class="stringliteral">&quot;Output Options&quot;</span>);
<a name="l00196"></a>00196   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-reference-output-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00197"></a>00197                     <span class="stringliteral">&quot;Output SNP reference file name.&quot;</span>,
<a name="l00198"></a>00198                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00199"></a>00199   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-output&quot;</span>, PgOpt::STRING_OPT,
<a name="l00200"></a>00200                     <span class="stringliteral">&quot;Output reference file name.&quot;</span>,
<a name="l00201"></a>00201                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00202"></a>00202   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;file-name-prefix&quot;</span>, PgOpt::STRING_OPT,
<a name="l00203"></a>00203                     <span class="stringliteral">&quot;CYCHP file name prefix.&quot;</span>,
<a name="l00204"></a>00204                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00205"></a>00205   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;file-name-suffix&quot;</span>, PgOpt::STRING_OPT,
<a name="l00206"></a>00206                     <span class="stringliteral">&quot;CYCHP file name suffix.&quot;</span>,
<a name="l00207"></a>00207                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00208"></a>00208   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;file-name-ext&quot;</span>, PgOpt::STRING_OPT,
<a name="l00209"></a>00209                     <span class="stringliteral">&quot;CYCHP file name extension.&quot;</span>,
<a name="l00210"></a>00210                     <span class="stringliteral">&quot;cychp&quot;</span>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   defineOptionSection(<span class="stringliteral">&quot;Analysis Options&quot;</span>);
<a name="l00213"></a>00213   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;run-geno-qc&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00214"></a>00214                      <span class="stringliteral">&quot;Run the GenoQC engine.&quot;</span>,
<a name="l00215"></a>00215                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00216"></a>00216   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;adapter-type-normalization&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00217"></a>00217                     <span class="stringliteral">&quot;Adapter Type Normalization option. true = perform adapter type normalization.&quot;</span>,
<a name="l00218"></a>00218                     <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00219"></a>00219   defOptMult(<span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;analysis&quot;</span>, PgOpt::STRING_OPT,
<a name="l00220"></a>00220                     <span class="stringliteral">&quot;String representing analysis pathway desired.&quot;</span>,
<a name="l00221"></a>00221                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00222"></a>00222   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00223"></a>00223                     <span class="stringliteral">&quot;String representing wave correction pathway desired.&quot;</span>,
<a name="l00224"></a>00224                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00225"></a>00225   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00226"></a>00226                     <span class="stringliteral">&quot;String representing local gc correction background pathway desired.&quot;</span>,
<a name="l00227"></a>00227                     <span class="stringliteral">&quot;none&quot;</span>);
<a name="l00228"></a>00228   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00229"></a>00229                     <span class="stringliteral">&quot;String representing local gc correction background intensity adjustment &quot;</span>
<a name="l00230"></a>00230                     <span class="stringliteral">&quot;pathway desired.&quot;</span>,
<a name="l00231"></a>00231                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00232"></a>00232   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;image-correction-intensity-adjustment-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00233"></a>00233                     <span class="stringliteral">&quot;String representing image correction intensity adjustment pathway desired.&quot;</span>,
<a name="l00234"></a>00234                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00235"></a>00235   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;log2ratio-adjustment-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00236"></a>00236                     <span class="stringliteral">&quot;String representing high pass filter parameters for modification of log2ratios.&quot;</span>,
<a name="l00237"></a>00237                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00238"></a>00238   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;wave-correction-log2ratio-adjustment-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00239"></a>00239                     <span class="stringliteral">&quot;String representing wave correction log2ratio adjustment pathway desired.&quot;</span>,
<a name="l00240"></a>00240                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00241"></a>00241   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;allele-peaks-reporter-method&quot;</span>, PgOpt::STRING_OPT,
<a name="l00242"></a>00242                     <span class="stringliteral">&quot;String representing allele peaks reporter pathway desired.&quot;</span>,
<a name="l00243"></a>00243                     <span class="stringliteral">&quot;allele-peaks-reporter-method&quot;</span>);
<a name="l00244"></a>00244   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;hmm-priors&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00245"></a>00245                     <span class="stringliteral">&quot;Read HMM priors from the reference file.&quot;</span>,
<a name="l00246"></a>00246                     <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00247"></a>00247   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;hmm-means-check&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00248"></a>00248                     <span class="stringliteral">&quot;Check HMM priors in the reference file for consistency.&quot;</span>,
<a name="l00249"></a>00249                     <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00250"></a>00250   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;brlmmp-parameters&quot;</span>, PgOpt::STRING_OPT,
<a name="l00251"></a>00251                      <span class="stringliteral">&quot;Parameters to use when running brlmmp.&quot;</span>,
<a name="l00252"></a>00252                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00253"></a>00253   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;signal-adjustment-covariates&quot;</span>, PgOpt::STRING_OPT,
<a name="l00254"></a>00254                     <span class="stringliteral">&quot;String representing the covariate-based signal adjustment pathway desired.&quot;</span>,
<a name="l00255"></a>00255                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00256"></a>00256   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;lr-adjustment-covariates&quot;</span>, PgOpt::STRING_OPT,
<a name="l00257"></a>00257                     <span class="stringliteral">&quot;String representing the covariate-based log2 ratio adjustment pathway desired.&quot;</span>,
<a name="l00258"></a>00258                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00259"></a>00259   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;allele-peaks-adjustment-covariates&quot;</span>, PgOpt::STRING_OPT,
<a name="l00260"></a>00260                    <span class="stringliteral">&quot;String representing the covariate-based allele peaks adjustment pathway desired.&quot;</span>,
<a name="l00261"></a>00261                    <span class="stringliteral">&quot;&quot;</span>);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   defineOptionSection(<span class="stringliteral">&quot;QC Options&quot;</span>);
<a name="l00264"></a>00264   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-qc-use-contrast&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00265"></a>00265                     <span class="stringliteral">&quot;SNP QC use intensity contrast.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00266"></a>00266   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-qc-snp-list&quot;</span>, PgOpt::STRING_OPT,
<a name="l00267"></a>00267                     <span class="stringliteral">&quot;Input file containing a list of SNP Ids to be used in calculating the SNPQC value.&quot;</span>,
<a name="l00268"></a>00268                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00269"></a>00269   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-qc-k&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00270"></a>00270                     <span class="stringliteral">&quot;SNP QC K value.&quot;</span>, <span class="stringliteral">&quot;2.0&quot;</span>);
<a name="l00271"></a>00271   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-qc-em-threshold&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00272"></a>00272                     <span class="stringliteral">&quot;SNP QC EM Threshold.&quot;</span>, <span class="stringliteral">&quot;0.05&quot;</span>);
<a name="l00273"></a>00273   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;snp-qc-bin-size&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00274"></a>00274                     <span class="stringliteral">&quot;SNP QC bin size.&quot;</span>, <span class="stringliteral">&quot;0.04&quot;</span>);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   defineOptionSection(<span class="stringliteral">&quot;Misc Options&quot;</span>);
<a name="l00277"></a>00277   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;explain&quot;</span>, PgOpt::STRING_OPT,
<a name="l00278"></a>00278                     <span class="stringliteral">&quot;Explain a particular operation (i.e. --explain cn-state or --explain loh).&quot;</span>,
<a name="l00279"></a>00279                     <span class="stringliteral">&quot;&quot;</span>);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   defineOptionSection(<span class="stringliteral">&quot;Advanced Options&quot;</span>);
<a name="l00282"></a>00282   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probeset-ids&quot;</span>, PgOpt::STRING_OPT,
<a name="l00283"></a>00283                      <span class="stringliteral">&quot;Tab delimited file with column &#39;probeset_id&#39; specifying probesets to summarize.&quot;</span>,
<a name="l00284"></a>00284                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00285"></a>00285   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;global-parameter-override&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00286"></a>00286                     <span class="stringliteral">&quot;Global parameters in loh-cyto analysis input string will override those &quot;</span>
<a name="l00287"></a>00287                     <span class="stringliteral">&quot;given in the snp-reference-input-file.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00288"></a>00288   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;keep-temp-reference-data&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00289"></a>00289                     <span class="stringliteral">&quot;Set to true, this option will keep the final signal and intensity values computed &quot;</span>
<a name="l00290"></a>00290                     <span class="stringliteral">&quot;while determining the CN reference file.  Warning: It may be large.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00291"></a>00291   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;keep-intermediate-data&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00292"></a>00292                     <span class="stringliteral">&quot;Set to true, this option will keep all, intensity values computed &quot;</span>
<a name="l00293"></a>00293                     <span class="stringliteral">&quot;while invoking any intensity adjustment method.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00294"></a>00294   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;keep-intermediate-data-local&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00295"></a>00295                     <span class="stringliteral">&quot;Set to true, this option will keep all, intensity values computed &quot;</span>
<a name="l00296"></a>00296                     <span class="stringliteral">&quot;while invoking any intensity adjustment method. This is a duplicate option for local testing.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00297"></a>00297   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;genotype-call-override-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00298"></a>00298                     <span class="stringliteral">&quot;Input file containing genotype calls to be used in place of brlmmp-p calls.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00299"></a>00299   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;gender-override-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00300"></a>00300                     <span class="stringliteral">&quot;A file containing externally computed genders. It is used in reference &quot;</span>
<a name="l00301"></a>00301                     <span class="stringliteral">&quot;and snp-reference generation&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00302"></a>00302   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;gc-content-override-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00303"></a>00303                     <span class="stringliteral">&quot;Input file used to override the GC content read from the annotation &quot;</span>
<a name="l00304"></a>00304                     <span class="stringliteral">&quot;files (Two columns with header line, ProbeSetName/GCContent).&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00305"></a>00305   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;gc-correction-bin-count&quot;</span>, PgOpt::INT_OPT,
<a name="l00306"></a>00306                     <span class="stringliteral">&quot;The number of bins to use for GC content.&quot;</span>, <span class="stringliteral">&quot;25&quot;</span>);
<a name="l00307"></a>00307   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;xChromosome&quot;</span>, PgOpt::INT_OPT,
<a name="l00308"></a>00308                     <span class="stringliteral">&quot;X Chromosome&quot;</span>,
<a name="l00309"></a>00309                     <span class="stringliteral">&quot;24&quot;</span>);
<a name="l00310"></a>00310   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;yChromosome&quot;</span>, PgOpt::INT_OPT,
<a name="l00311"></a>00311                     <span class="stringliteral">&quot;Y Chromosome&quot;</span>,
<a name="l00312"></a>00312                     <span class="stringliteral">&quot;25&quot;</span>);
<a name="l00313"></a>00313   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;male-gender-ratio-cutoff&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00314"></a>00314                     <span class="stringliteral">&quot;Male gender ratio cutoff&quot;</span>, <span class="stringliteral">&quot;1.3&quot;</span>);
<a name="l00315"></a>00315   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;female-gender-ratio-cutoff&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00316"></a>00316                     <span class="stringliteral">&quot;Female gender ratio cutoff&quot;</span>, <span class="stringliteral">&quot;1.0&quot;</span>);
<a name="l00317"></a>00317   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-chromosome&quot;</span>, PgOpt::INT_OPT,
<a name="l00318"></a>00318                     <span class="stringliteral">&quot;Reference chromosome&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>);
<a name="l00319"></a>00319   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;xx-cutoff&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00320"></a>00320                     <span class="stringliteral">&quot;XX cutoff&quot;</span>, <span class="stringliteral">&quot;0.8&quot;</span>);
<a name="l00321"></a>00321   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;xx-cutoff-high&quot;</span>, PgOpt::DOUBLE_OPT,
<a name="l00322"></a>00322                     <span class="stringliteral">&quot;XX cutoff high&quot;</span>, <span class="stringliteral">&quot;1.07&quot;</span>);
<a name="l00323"></a>00323   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;y-cutoff&quot;</span>, PgOpt::DOUBLE_OPT, <span class="stringliteral">&quot;Y cutoff&quot;</span>, <span class="stringliteral">&quot;0.65&quot;</span>);
<a name="l00324"></a>00324   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;warning-message-limit&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;Set the limit on the number of warning message produced.&quot;</span>, <span class="stringliteral">&quot;10&quot;</span>);
<a name="l00325"></a>00325 <span class="comment">//  defineOption(&quot;&quot;, &quot;ad-limit&quot;, PgOpt::DOUBLE_OPT, &quot;Allelic Difference Limit&quot;, &quot;0.2&quot;);</span>
<a name="l00326"></a>00326 <span class="comment">//  defineOption(&quot;&quot;, &quot;xx-cutoff-ad&quot;, PgOpt::DOUBLE_OPT, &quot;XX cutoff Allelic Difference&quot;, &quot;0.066&quot;);</span>
<a name="l00327"></a>00327 <span class="comment">//  defineOption(&quot;&quot;, &quot;xx-cutoff-override&quot;, PgOpt::DOUBLE_OPT, &quot;XX cutoff Override&quot;, &quot;0.9&quot;);</span>
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;waviness-block-size&quot;</span>, PgOpt::INT_OPT,
<a name="l00330"></a>00330                     <span class="stringliteral">&quot;marker count&quot;</span>, <span class="stringliteral">&quot;50&quot;</span>);
<a name="l00331"></a>00331   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;waviness-genomic-span&quot;</span>, PgOpt::INT_OPT,
<a name="l00332"></a>00332                     <span class="stringliteral">&quot;genomic segment length&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00333"></a>00333   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cn-calibrate-parameters&quot;</span>, PgOpt::STRING_OPT,
<a name="l00334"></a>00334                     <span class="stringliteral">&quot;SmoothSignal calibration parameters&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;use-old-kdensity-function&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00337"></a>00337                    <span class="stringliteral">&quot;For testing only, revert to the old slow kdensity method for density estimation.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   defineOptionSection(<span class="stringliteral">&quot;Engine Options (Not used on command line)&quot;</span>);
<a name="l00340"></a>00340   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cels&quot;</span>, PgOpt::STRING_OPT,
<a name="l00341"></a>00341                      <span class="stringliteral">&quot;CEL files to process.&quot;</span>,
<a name="l00342"></a>00342                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00343"></a>00343   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;arrs&quot;</span>, PgOpt::STRING_OPT,
<a name="l00344"></a>00344                      <span class="stringliteral">&quot;ARR files to process. Must be paired with cels.&quot;</span>,
<a name="l00345"></a>00345                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00346"></a>00346   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;result-files&quot;</span>, PgOpt::STRING_OPT,
<a name="l00347"></a>00347                      <span class="stringliteral">&quot;CYCHP files to output. Must be paired with cels.&quot;</span>,
<a name="l00348"></a>00348                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a> objCNAnalysisEngine;
<a name="l00351"></a>00351   objCNAnalysisEngine.setEngine(<span class="keyword">this</span>);
<a name="l00352"></a>00352   objCNAnalysisEngine.<a class="code" href="classCNAnalysisEngine.html#a695951bd6f3ea19ca14c7b4006829822" title="Define options used by this engine, and also the CNWorkflowEngine.">defineSharedOptions</a>();
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 <span class="comment"></span>
<a name="l00355"></a>00355 <span class="comment">/**</span>
<a name="l00356"></a>00356 <span class="comment"> * @brief Add a cel file specification to the options</span>
<a name="l00357"></a>00357 <span class="comment"> * @param const std::string&amp; - The cel file name</span>
<a name="l00358"></a>00358 <span class="comment"> * @param const std::string&amp; - The sample (arr) file name</span>
<a name="l00359"></a>00359 <span class="comment"> * @param const std::string&amp; - The result (cychp) file name</span>
<a name="l00360"></a>00360 <span class="comment"> */</span>
<a name="l00361"></a><a class="code" href="classCNCytoEngine.html#a4fc44f3918fec771d4a8e480b308bea7">00361</a> <span class="keywordtype">void</span> <a class="code" href="classCNCytoEngine.html#a4fc44f3918fec771d4a8e480b308bea7" title="Add a cel file specification to the options.">CNCytoEngine::addCel</a>(<span class="keyword">const</span> std::string&amp; strCelFileName, <span class="keyword">const</span> std::string&amp; strSampleFileName, <span class="keyword">const</span> std::string&amp; strResultFileName)
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <a class="code" href="classOptions.html#ae588e20caeee2962dd19e495afc11d99" title="Add a value to a vector of values for option.">pushOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>, strCelFileName);
<a name="l00364"></a>00364     <a class="code" href="classOptions.html#ae588e20caeee2962dd19e495afc11d99" title="Add a value to a vector of values for option.">pushOpt</a>(<span class="stringliteral">&quot;arrs&quot;</span>, strSampleFileName);
<a name="l00365"></a>00365     <a class="code" href="classOptions.html#ae588e20caeee2962dd19e495afc11d99" title="Add a value to a vector of values for option.">pushOpt</a>(<span class="stringliteral">&quot;result-files&quot;</span>, strResultFileName);
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 <span class="comment"></span>
<a name="l00368"></a>00368 <span class="comment">/**</span>
<a name="l00369"></a>00369 <span class="comment"> * @brief Define the states used by this engine</span>
<a name="l00370"></a>00370 <span class="comment"> */</span>
<a name="l00371"></a>00371 <span class="keywordtype">void</span> CNCytoEngine::defineStates() {
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cytoscan-hd&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;The array is the CytoScanHD product.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00374"></a>00374         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cytoscan-hd&quot;</span>, ((Annotation::isCytoScanHD(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;annotation-file&quot;</span>))) ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>));
<a name="l00375"></a>00375     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;num-rows&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The number of rows on the chip.&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00376"></a>00376     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;num-cols&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The number of cols on the chip.&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00377"></a>00377     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-wave-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;wave-count-used&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00378"></a>00378     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;sample-count&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00379"></a>00379     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-file&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;reference-file&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00380"></a>00380     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;create-snp-reference&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;create-snp-reference&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00381"></a>00381     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;create-reference&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;create-reference&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00382"></a>00382     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;copynumber-reference-file&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;copynumber-reference-file&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00383"></a>00383     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-text-output&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;The reference file is in ascii text format.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00384"></a>00384     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;recommended-reference-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The recommended number of samples for a Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;44&quot;</span>);
<a name="l00385"></a>00385     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;recommended-reference-female-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The recommended number of female samples for a Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;20&quot;</span>);
<a name="l00386"></a>00386     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;recommended-reference-male-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The recommended number of male samples for a Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;20&quot;</span>);
<a name="l00387"></a>00387     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The actual number of samples for the Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00388"></a>00388     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-female-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The actual number of female samples for the Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00389"></a>00389     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-male-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The actual number of male samples for the Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00390"></a>00390     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;reference-unknown-sample-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The actual number of unknown gender samples for the Copy Number reference.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00391"></a>00391     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The actual number of probes on the chip.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00392"></a>00392     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-rows-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The number of probe rows on the chip.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00393"></a>00393     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-columns-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The number of probe columns on the chip.&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00394"></a>00394     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probeset-count&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;The number of probesets on the chip.&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00395"></a>00395     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;log2ratio-hdf5-output&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;Write intermediate output in HDF5 format.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00396"></a>00396     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;log2ratio-text-output&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;Write intermediate output in ASCII Text format.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00397"></a>00397     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;yTarget&quot;</span>, PgOpt::DOUBLE_OPT, <span class="stringliteral">&quot;Store yTarget for sharing between modules.&quot;</span>, <span class="stringliteral">&quot;NaN&quot;</span>);
<a name="l00398"></a>00398     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;array-size&quot;</span>, PgOpt::INT_OPT, <span class="stringliteral">&quot;Array size for determining which array we are running full or focused.&quot;</span>, <span class="stringliteral">&quot;2015&quot;</span>);
<a name="l00399"></a>00399     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;temp-reference-file&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;temp-reference-file&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00400"></a>00400     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;pdnn-reference-values-exist&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;A boolean value set to true if pdnn parameters exist in the CN reference-input file.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00401"></a>00401     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chrX-probes-filtered&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;Temp file for filtered chr-X probes.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00402"></a>00402     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chrY-probes-filtered&quot;</span>, PgOpt::STRING_OPT, <span class="stringliteral">&quot;Temp file for filtered chr-Y probes.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00403"></a>00403     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;disable-covariates-file-warning&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;Indicates that the covariates file warning should be disabled to avoid redundant warnings.&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00404"></a>00404     defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;AD-modulation-no-single-peak&quot;</span>, PgOpt::BOOL_OPT, <span class="stringliteral">&quot;Indicates whether allelic differences have been changed by the AD modulation correction method&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a> objCNAnalysisEngine;
<a name="l00407"></a>00407     objCNAnalysisEngine.setEngine(<span class="keyword">this</span>);
<a name="l00408"></a>00408     objCNAnalysisEngine.<a class="code" href="classCNAnalysisEngine.html#a37ba8bd72a060e96bfea75d39903838b" title="Define options used by this engine, and also the CNWorkflowEngine.">defineSharedStates</a>();
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="classAnalysis.html">00411</a> <span class="keyword">class </span><a class="code" href="classAnalysis.html">Analysis</a>
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413 <span class="keyword">public</span>:
<a name="l00414"></a>00414     <span class="keywordtype">int</span> Order;
<a name="l00415"></a>00415     std::string Name;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> getName()
<a name="l00418"></a>00418     {
<a name="l00419"></a>00419         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> str = Name;
<a name="l00420"></a>00420         <span class="keywordtype">int</span> iFindIndex = str.indexOf(<span class="stringliteral">&quot;.&quot;</span>);
<a name="l00421"></a>00421         <span class="keywordflow">if</span> (iFindIndex != std::string::npos)
<a name="l00422"></a>00422         {
<a name="l00423"></a>00423             str = str.substring(0, iFindIndex);
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425         <span class="keywordflow">return</span> str;
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keywordtype">int</span> compareTo(<a class="code" href="classAnalysis.html">Analysis</a>&amp; that, <span class="keywordtype">int</span> iCompareCode)
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430         <span class="keywordtype">int</span> iCompareResult = 0;
<a name="l00431"></a>00431         <span class="keywordflow">switch</span> (iCompareCode)
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433         <span class="keywordflow">case</span> 0:
<a name="l00434"></a>00434             iCompareResult = <a class="code" href="classAffxArray.html" title="A template class derived from std::vector.">AffxArray&lt;int&gt;::compare</a>(Order, that.Order);
<a name="l00435"></a>00435             <span class="keywordflow">break</span>;
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437         <span class="keywordflow">return</span> iCompareResult;
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="structAnalysis_1_1ComparePred.html">00440</a>     <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> k&gt; <span class="keyword">struct </span><a class="code" href="structAnalysis_1_1ComparePred.html">ComparePred</a> {
<a name="l00441"></a>00441         <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> <a class="code" href="classAnalysis.html">Analysis</a>* lhs, <span class="keyword">const</span> <a class="code" href="classAnalysis.html">Analysis</a>* rhs)<span class="keyword"> const </span>{
<a name="l00442"></a>00442             <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;CNCytoEngine/Analysis: ComparePred instantiated with an invalid compare code = &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(k));
<a name="l00443"></a>00443             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445     };
<a name="l00446"></a>00446 };
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="structAnalysis_1_1ComparePred_3_010_01_4.html">00448</a> <span class="keyword">template</span>&lt;&gt; <span class="keyword">struct </span><a class="code" href="structAnalysis_1_1ComparePred.html">Analysis::ComparePred</a>&lt;0&gt; {
<a name="l00449"></a>00449     <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> <a class="code" href="classAnalysis.html">Analysis</a>* lhs, <span class="keyword">const</span> <a class="code" href="classAnalysis.html">Analysis</a>* rhs)<span class="keyword"> const </span>{
<a name="l00450"></a>00450         <span class="keywordflow">return</span> <a class="code" href="classAffxArray.html" title="A template class derived from std::vector.">AffxArray&lt;int&gt;::compare</a>(lhs-&gt;Order, rhs-&gt;Order) &lt; 0;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 };
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keywordtype">void</span> CNCytoEngine::checkParameters()
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456     defineStates();
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459         <span class="keywordflow">if</span> ( (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)  &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) )
<a name="l00460"></a>00460         {
<a name="l00461"></a>00461                 <span class="keywordflow">if</span>(!predictedIntensitiesExist(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>)))
<a name="l00462"></a>00462                 {
<a name="l00463"></a>00463                     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;PDNN predicted intensity values are missing from input reference file. To use the pdnn intensity adjustment while analyzing samples you must use a reference input file where these values were created.  To create these values use the the option --local-gc-background-correction-reference-method pdnn-reference-method  when generating the reference input file. You may be using an out-dated input reference file.&quot;</span>);
<a name="l00464"></a>00464                 }
<a name="l00465"></a>00465                 <span class="keywordflow">else</span>
<a name="l00466"></a>00466                 {
<a name="l00467"></a>00467                     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;pdnn-reference-values-exist&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00468"></a>00468                 }
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470     } 
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;adapter-type-normalization&quot;</span>)))
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;adapter-type-normalization cannot be run against the cyto2 arrays.&quot;</span>);
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     std::vector&lt;std::string&gt;&amp; analysis = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;analysis&quot;</span>);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="keywordflow">if</span>(analysis.size() == 0) {
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l00481"></a>00481         {
<a name="l00482"></a>00482             analysis.push_back(<span class="stringliteral">&quot;log2-ratio-cyto2&quot;</span>);
<a name="l00483"></a>00483             analysis.push_back(<span class="stringliteral">&quot;kernel-smooth&quot;</span>);
<a name="l00484"></a>00484             analysis.push_back(<span class="stringliteral">&quot;cn-cyto2&quot;</span>);
<a name="l00485"></a>00485             analysis.push_back(<span class="stringliteral">&quot;cn-cyto2-gender&quot;</span>);
<a name="l00486"></a>00486             analysis.push_back(<span class="stringliteral">&quot;cn-segment&quot;</span>);
<a name="l00487"></a>00487             analysis.push_back(<span class="stringliteral">&quot;loh-cyto2&quot;</span>);
<a name="l00488"></a>00488             analysis.push_back(<span class="stringliteral">&quot;mosaicism&quot;</span>);
<a name="l00489"></a>00489             analysis.push_back(<span class="stringliteral">&quot;allele-peaks&quot;</span>);
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491         <span class="keywordflow">else</span>
<a name="l00492"></a>00492         {
<a name="l00493"></a>00493                         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cytoscan-hd&quot;</span>))
<a name="l00494"></a>00494                         {
<a name="l00495"></a>00495                                 analysis.push_back(<span class="stringliteral">&quot;log2-ratio&quot;</span>);
<a name="l00496"></a>00496                                 analysis.push_back(<span class="stringliteral">&quot;allelic-difference&quot;</span>);
<a name="l00497"></a>00497                                 analysis.push_back(<span class="stringliteral">&quot;kernel-smooth&quot;</span>);
<a name="l00498"></a>00498                                 analysis.push_back(<span class="stringliteral">&quot;cn-cyto2&quot;</span>);
<a name="l00499"></a>00499                                 analysis.push_back(<span class="stringliteral">&quot;cn-cyto2-gender&quot;</span>);
<a name="l00500"></a>00500                                 analysis.push_back(<span class="stringliteral">&quot;cn-segment&quot;</span>);
<a name="l00501"></a>00501                                 analysis.push_back(<span class="stringliteral">&quot;lohCytoScan&quot;</span>);
<a name="l00502"></a>00502                                 analysis.push_back(<span class="stringliteral">&quot;loh-segment&quot;</span>);
<a name="l00503"></a>00503                                 analysis.push_back(<span class="stringliteral">&quot;cn-neutral-loh&quot;</span>);
<a name="l00504"></a>00504                                 analysis.push_back(<span class="stringliteral">&quot;genotype&quot;</span>);
<a name="l00505"></a>00505                         }
<a name="l00506"></a>00506                         <span class="keywordflow">else</span>
<a name="l00507"></a>00507                         {
<a name="l00508"></a>00508                                 analysis.push_back(<span class="stringliteral">&quot;log2-ratio&quot;</span>);
<a name="l00509"></a>00509                                 analysis.push_back(<span class="stringliteral">&quot;allelic-difference&quot;</span>);
<a name="l00510"></a>00510                                 analysis.push_back(<span class="stringliteral">&quot;gaussian-smooth&quot;</span>);
<a name="l00511"></a>00511                                 analysis.push_back(<span class="stringliteral">&quot;cn-state&quot;</span>);
<a name="l00512"></a>00512                                 analysis.push_back(<span class="stringliteral">&quot;cn-gender&quot;</span>);
<a name="l00513"></a>00513                                 analysis.push_back(<span class="stringliteral">&quot;cn-segment&quot;</span>);
<a name="l00514"></a>00514                                 analysis.push_back(<span class="stringliteral">&quot;loh&quot;</span>);
<a name="l00515"></a>00515                                 analysis.push_back(<span class="stringliteral">&quot;loh-segment&quot;</span>);
<a name="l00516"></a>00516                                 analysis.push_back(<span class="stringliteral">&quot;cn-neutral-loh&quot;</span>);
<a name="l00517"></a>00517                                 analysis.push_back(<span class="stringliteral">&quot;normal-diploid&quot;</span>);
<a name="l00518"></a>00518                                 analysis.push_back(<span class="stringliteral">&quot;mosaicism&quot;</span>);
<a name="l00519"></a>00519                         }
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="comment">// Make consistency checks</span>
<a name="l00524"></a>00524     checkConsistency(analysis);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <span class="comment">// Insure proper analysis order.</span>
<a name="l00527"></a>00527     <span class="keywordtype">bool</span> bCyto2LOH = <span class="keyword">false</span>;
<a name="l00528"></a>00528     <a class="code" href="classAffxArray.html" title="A template class derived from std::vector.">AffxArray&lt;Analysis&gt;</a> ar;
<a name="l00529"></a>00529     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; (i &lt; analysis.size()); i++)
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531         <a class="code" href="classAnalysis.html">Analysis</a>* p = <span class="keyword">new</span> <a class="code" href="classAnalysis.html">Analysis</a>;
<a name="l00532"></a>00532         p-&gt;Name = analysis[i];
<a name="l00533"></a>00533         p-&gt;Order = CNSegment::getSegmentType(p-&gt;getName());
<a name="l00534"></a>00534         ar.add(p);
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536     ar.quickSort(0);
<a name="l00537"></a>00537     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; (i &lt; analysis.size()); i++)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539         <a class="code" href="classAnalysis.html">Analysis</a>* p = ar.getAt(i);
<a name="l00540"></a>00540         analysis[i] = p-&gt;Name;
<a name="l00541"></a>00541         <span class="keywordflow">if</span> (p-&gt;getName() == <span class="stringliteral">&quot;loh-cyto2&quot;</span>) {bCyto2LOH = <span class="keyword">true</span>;}
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     ar.deleteAll();
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a> objCNAnalysisEngine;
<a name="l00547"></a>00547     objCNAnalysisEngine.setEngine(<span class="keyword">this</span>);
<a name="l00548"></a>00548     objCNAnalysisEngine.<a class="code" href="classBaseEngine.html#a2d72424f85cd48253aa9cdc60ea83ef5" title="Check the validity of options specified.">checkOptions</a>();
<a name="l00549"></a>00549     objCNAnalysisEngine.<a class="code" href="classCNAnalysisEngine.html#a49916ef1d51a33cdeb95be080c9349f4" title="Release the memory used by the engine.">clear</a>();
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">if</span> ((!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cychp-output&quot;</span>)) &amp;&amp; (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cnchp-output&quot;</span>)))
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify either cychp-ouptut or cnchp-output.&quot;</span>);
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     CovariateParams::checkParams(*<span class="keyword">this</span>);
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 <span class="comment"></span>
<a name="l00559"></a>00559 <span class="comment">/**</span>
<a name="l00560"></a>00560 <span class="comment"> * @brief Make sure that our options are sane. Call Err::errAbort if not.</span>
<a name="l00561"></a>00561 <span class="comment"> */</span>
<a name="l00562"></a>00562 <span class="keywordtype">void</span> CNCytoEngine::checkOptionsImp() {
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="comment">//defineStates();</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">// file is not used by the engine</span>
<a name="l00567"></a>00567     <span class="comment">//setLibFileOpt(&quot;config-file&quot;);</span>
<a name="l00568"></a>00568     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>);
<a name="l00569"></a>00569     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>);
<a name="l00570"></a>00570     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l00571"></a>00571     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l00572"></a>00572     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;qcc-file&quot;</span>);
<a name="l00573"></a>00573     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;qca-file&quot;</span>);
<a name="l00574"></a>00574     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>);
<a name="l00575"></a>00575     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>);
<a name="l00576"></a>00576     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;annotation-file&quot;</span>);
<a name="l00577"></a>00577     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>);
<a name="l00578"></a>00578     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;gc-content-override-file&quot;</span>);
<a name="l00579"></a>00579     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;snp-qc-snp-list&quot;</span>);
<a name="l00580"></a>00580     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;probe-file&quot;</span>);
<a name="l00581"></a>00581     <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;covariates-file&quot;</span>);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;explain&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) { explain(); exit(0); }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cel-files&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00586"></a>00586         <span class="keywordflow">if</span> (getArgCount() &gt; 0) {
<a name="l00587"></a>00587             error(<span class="stringliteral">&quot;CEL files cannot be specified both as command line arguments and as lists with \&quot;cel-files\&quot;/\&quot;cels\&quot; options&quot;</span>);
<a name="l00588"></a>00588         }
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     checkParameters();
<a name="l00592"></a>00592     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(4, <span class="stringliteral">&quot;Parameters are ok.&quot;</span>);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596         <span class="keywordflow">if</span>(!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;doDualNormalization&quot;</span>))
<a name="l00597"></a>00597         {
<a name="l00598"></a>00598             error(<span class="stringliteral">&quot;You cannot turn off dual normalization when the cyto2 input parameter is true.  This program will not allow single normalization on 2.7M or 310K chips.  It may only be turned off when analyzing snp6 and snp7 chips.&quot;</span>  );
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Must specify an output directory.&quot;</span>);}
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00604"></a>00604       <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<span class="stringliteral">&quot;temp&quot;</span>));
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     std::vector&lt;std::string&gt;&amp; analysis = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;analysis&quot;</span>);
<a name="l00608"></a>00608     <span class="keywordflow">if</span>(analysis.size() == 0) {
<a name="l00609"></a>00609         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l00610"></a>00610         {
<a name="l00611"></a>00611             analysis.push_back(<span class="stringliteral">&quot;log2-ratio-cyto2&quot;</span>);
<a name="l00612"></a>00612             analysis.push_back(<span class="stringliteral">&quot;kernel-smooth&quot;</span>);
<a name="l00613"></a>00613             analysis.push_back(<span class="stringliteral">&quot;cn-cyto2&quot;</span>);
<a name="l00614"></a>00614             analysis.push_back(<span class="stringliteral">&quot;cn-cyto2&quot;</span>);
<a name="l00615"></a>00615             analysis.push_back(<span class="stringliteral">&quot;cn-cyto2-gender&quot;</span>);
<a name="l00616"></a>00616             analysis.push_back(<span class="stringliteral">&quot;cn-segment&quot;</span>);
<a name="l00617"></a>00617             analysis.push_back(<span class="stringliteral">&quot;loh-cyto2&quot;</span>);
<a name="l00618"></a>00618             analysis.push_back(<span class="stringliteral">&quot;mosaicism&quot;</span>);
<a name="l00619"></a>00619             analysis.push_back(<span class="stringliteral">&quot;allele-peaks&quot;</span>);
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621         <span class="keywordflow">else</span>
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623             analysis.push_back(<span class="stringliteral">&quot;log2-ratio&quot;</span>);
<a name="l00624"></a>00624             analysis.push_back(<span class="stringliteral">&quot;allelic-difference&quot;</span>);
<a name="l00625"></a>00625             analysis.push_back(<span class="stringliteral">&quot;gaussian-smooth&quot;</span>);
<a name="l00626"></a>00626             analysis.push_back(<span class="stringliteral">&quot;cn-state&quot;</span>);
<a name="l00627"></a>00627             analysis.push_back(<span class="stringliteral">&quot;cn-gender&quot;</span>);
<a name="l00628"></a>00628             analysis.push_back(<span class="stringliteral">&quot;cn-segment&quot;</span>);
<a name="l00629"></a>00629             analysis.push_back(<span class="stringliteral">&quot;loh&quot;</span>);
<a name="l00630"></a>00630             analysis.push_back(<span class="stringliteral">&quot;loh-segment&quot;</span>);
<a name="l00631"></a>00631             analysis.push_back(<span class="stringliteral">&quot;cn-neutral-loh&quot;</span>);
<a name="l00632"></a>00632             analysis.push_back(<span class="stringliteral">&quot;normal-diploid&quot;</span>);
<a name="l00633"></a>00633             analysis.push_back(<span class="stringliteral">&quot;mosaicism&quot;</span>);
<a name="l00634"></a>00634             analysis.push_back(<span class="stringliteral">&quot;cn-snp7&quot;</span>);
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="comment">// Insure proper analysis order.</span>
<a name="l00639"></a>00639     <span class="keywordtype">bool</span> bCyto2LOH = <span class="keyword">false</span>;
<a name="l00640"></a>00640     <a class="code" href="classAffxArray.html" title="A template class derived from std::vector.">AffxArray&lt;Analysis&gt;</a> ar;
<a name="l00641"></a>00641     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; (i &lt; analysis.size()); i++)
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643         <a class="code" href="classAnalysis.html">Analysis</a>* p = <span class="keyword">new</span> <a class="code" href="classAnalysis.html">Analysis</a>;
<a name="l00644"></a>00644         p-&gt;Name = analysis[i];
<a name="l00645"></a>00645         p-&gt;Order = CNSegment::getSegmentType(p-&gt;getName());
<a name="l00646"></a>00646         ar.add(p);
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648     ar.quickSort(0);
<a name="l00649"></a>00649     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; (i &lt; analysis.size()); i++)
<a name="l00650"></a>00650     {
<a name="l00651"></a>00651         <a class="code" href="classAnalysis.html">Analysis</a>* p = ar.getAt(i);
<a name="l00652"></a>00652         analysis[i] = p-&gt;Name;
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (p-&gt;getName() == <span class="stringliteral">&quot;loh-cyto2&quot;</span>) {bCyto2LOH = <span class="keyword">true</span>;}
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655     ar.deleteAll();
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;keep-temp-reference-data&quot;</span>) )
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;keep-temp-reference-data&quot;</span>,<span class="stringliteral">&quot;true&quot;</span>);
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;keep-intermediate-data&quot;</span>) )
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;keep-intermediate-data&quot;</span>,<span class="stringliteral">&quot;true&quot;</span>);
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00667"></a>00667     {
<a name="l00668"></a>00668         error(<span class="stringliteral">&quot;Please specify either a reference-input file or a reference-output file, but not both.&quot;</span>);
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00672"></a>00672     {
<a name="l00673"></a>00673         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l00674"></a>00674         {
<a name="l00675"></a>00675             <span class="keywordflow">if</span> (!isCyto2Reference(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>))) {error(<span class="stringliteral">&quot;The reference-input specified either does not exist, or is not the correct type for the CNCytoEngine.&quot;</span>);}
<a name="l00676"></a>00676         }
<a name="l00677"></a>00677         <span class="keywordflow">else</span>
<a name="l00678"></a>00678         {
<a name="l00679"></a>00679             <span class="keywordflow">if</span> (!isCN5Reference(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>))) {error(<span class="stringliteral">&quot;The reference-input specified either does not exist, or is not the correct type for the CNCytoEngine.&quot;</span>);}
<a name="l00680"></a>00680         }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;doDualNormalization&quot;</span>))
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684             <span class="keywordflow">if</span> (!isDualNormalizeReference(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>))) 
<a name="l00685"></a>00685             {
<a name="l00686"></a>00686                  error(<span class="stringliteral">&quot;The reference-input was generated with the doDualNormalization set to false. This is incompatible with the present run where the doDualNormalization option has been set to true. Either regenerate the reference or set the doDualNormalization option to false.&quot;</span>);
<a name="l00687"></a>00687             }
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689         <span class="keywordflow">else</span>
<a name="l00690"></a>00690         {
<a name="l00691"></a>00691             <span class="keywordflow">if</span> (isDualNormalizeReference(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>))) 
<a name="l00692"></a>00692             {
<a name="l00693"></a>00693                 error(<span class="stringliteral">&quot;The reference-input was generated with the doDualNormalization set to true. This is incompatible with the present run where the doDualNormalization option has been set to false. Either regenerate the reference or set the doDualNormalization option to true.&quot;</span>);
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;create-reference&quot;</span>, <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00698"></a>00698         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>));
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703         <span class="comment">// if (getOptBool(&quot;cyto2&quot;))</span>
<a name="l00704"></a>00704         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>)      &amp;&amp;
<a name="l00705"></a>00705             <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>  &amp;&amp; 
<a name="l00706"></a>00706             <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708             <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probe-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) || (!Fs::fileExists(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probe-file&quot;</span>))))
<a name="l00709"></a>00709             {
<a name="l00710"></a>00710                 error(<span class="stringliteral">&quot;Please specify a valid probe-file when creating a reference.&quot;</span>);
<a name="l00711"></a>00711             }
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;reference-cels&quot;</span>).size() &gt; 0)
<a name="l00714"></a>00714         {
<a name="l00715"></a>00715             error(<span class="stringliteral">&quot;Specify reference-cels in combination with the reference-input option, not the reference-output option.&quot;</span>);
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;create-reference&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00718"></a>00718         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>));
<a name="l00719"></a>00719     }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         <span class="keywordflow">if</span> (!isCyto2SnpReference(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>)))
<a name="l00725"></a>00725                 {
<a name="l00726"></a>00726                         error(<span class="stringliteral">&quot;The snp-reference-input-file specified either does not exist, or is not the correct type for the CNCytoEngine.&quot;</span>);
<a name="l00727"></a>00727                 }
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-output-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00731"></a>00731     {
<a name="l00732"></a>00732             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l00733"></a>00733             error(<span class="stringliteral">&quot;When using the snp-reference-output-file option you must also use the snp-reference-input-file option.  This file must contain valid data for the information component of each probeset.&quot;</span>);
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-output-file&quot;</span>) == <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>)){
<a name="l00736"></a>00736                         error(<span class="stringliteral">&quot;snp-reference-input-file cannot have the same name as the snp-reference-output-file&quot;</span>);
<a name="l00737"></a>00737                 }
<a name="l00738"></a>00738             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l00739"></a>00739                         error(<span class="stringliteral">&quot;To use the snp-reference-output-file option you must also use the reference-output option&quot;</span>);
<a name="l00740"></a>00740                 }
<a name="l00741"></a>00741             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>){
<a name="l00742"></a>00742                         error(<span class="stringliteral">&quot;To use the snp-reference-file-output option you cannot set the reference-input option&quot;</span>);
<a name="l00743"></a>00743                 }
<a name="l00744"></a>00744         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;create-snp-reference&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00745"></a>00745         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;snp-reference-output-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-output-file&quot;</span>));
<a name="l00746"></a>00746             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;gender-override-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l00747"></a>00747                         error(<span class="stringliteral">&quot;To use the snp-reference-file-output option you must specify a gender-override-file containing the gender of the samples being analyzed&quot;</span>);
<a name="l00748"></a>00748                 }
<a name="l00749"></a>00749             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;genotype-call-override-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l00750"></a>00750                         error(<span class="stringliteral">&quot;To use the snp-reference-file-output option you must specify a genotype-call-override-file containing the genotypes of all the SNP marker of all samples being analyzed.&quot;</span>);
<a name="l00751"></a>00751                 }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754     <span class="keywordflow">if</span> (bCyto2LOH)
<a name="l00755"></a>00755     {
<a name="l00756"></a>00756         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00757"></a>00757         {
<a name="l00758"></a>00758             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;A snp-reference-input-file must be set to perform an loh-cyto2 analysis&quot;</span>);
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760         <span class="keywordflow">else</span>
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762             <span class="keywordflow">if</span> ((!Fs::fileExists(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>))) || (!affx::File5_File::isHdf5file(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>))) || (<a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>), <span class="stringliteral">&quot;SNPReference&quot;</span>, <span class="stringliteral">&quot;SNPReference&quot;</span>) == -1))
<a name="l00763"></a>00763             {
<a name="l00764"></a>00764                 error(<span class="stringliteral">&quot;A valid snp-reference-input-file must be set to perform an loh-cyto2 analysis&quot;</span>);
<a name="l00765"></a>00765             }
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="comment">/* Read in cel file list from other file if specified. */</span>
<a name="l00770"></a>00770     vector&lt;string&gt; celFiles;
<a name="l00771"></a>00771     EngineUtil::getCelFiles(celFiles, <span class="keyword">this</span>);
<a name="l00772"></a>00772     <span class="keywordflow">if</span>(celFiles.size() == 0)
<a name="l00773"></a>00773         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No cel files specified.&quot;</span>);
<a name="l00774"></a>00774     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>,celFiles);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 <span class="comment">//MG temporary code for Bitao</span>
<a name="l00777"></a>00777         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;normal-diploid-files-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00778"></a>00778         {
<a name="l00779"></a>00779 
<a name="l00780"></a>00780                 std::string normalDiploidFilesFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;normal-diploid-files-file&quot;</span>);
<a name="l00781"></a>00781                 std::vector&lt;std::string&gt; normalDiploidFiles;
<a name="l00782"></a>00782                 <a class="code" href="classaffx_1_1TsvFile.html#a6f8b66aa4e9afc93dd1e42e8adcb1554" title="put the column of a file into a vector. /// the column and file are required to exist or we die...">affx::TsvFile::extractColToVec</a>(normalDiploidFilesFile,<span class="stringliteral">&quot;normal_diploid_files&quot;</span>,&amp;normalDiploidFiles, <a class="code" href="namespaceaffx.html#a8f36853f1d3b6cfb79edebd82760691daf605fbe0e244c4a604d176991d8df2c6" title="warn if not bound">affx::TSV_BIND_REQUIRED</a>);
<a name="l00783"></a>00783                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;normal-diploid-files&quot;</span>, normalDiploidFiles);
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785 <span class="comment">//</span>
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>, <span class="stringliteral">&quot;CN5&quot;</span>);}
<a name="l00788"></a>00788     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;run-geno-qc&quot;</span>))
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00791"></a>00791             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00792"></a>00792                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>)));
<a name="l00793"></a>00793             } <span class="keywordflow">else</span> {
<a name="l00794"></a>00794                 <span class="keywordtype">string</span> refFileName = <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-output&quot;</span>));
<a name="l00795"></a>00795                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),refFileName + <span class="stringliteral">&quot;.&quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>) + <span class="stringliteral">&quot;.GenoQC.txt&quot;</span>));
<a name="l00796"></a>00796             }
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00799"></a>00799             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00800"></a>00800                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>)));
<a name="l00801"></a>00801             } <span class="keywordflow">else</span> {
<a name="l00802"></a>00802                 wstring wDateTime = DateTime::GetCurrentDateTime().ToString();
<a name="l00803"></a>00803                 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> dateTime = StringUtils::ConvertWCSToMBS(wDateTime);
<a name="l00804"></a>00804                 dateTime.replace(<span class="charliteral">&#39;:&#39;</span>, <span class="charliteral">&#39;-&#39;</span>);
<a name="l00805"></a>00805                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),dateTime + <span class="stringliteral">&quot;.&quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>) + <span class="stringliteral">&quot;.GenoQC.txt&quot;</span>));
<a name="l00806"></a>00806             }
<a name="l00807"></a>00807         }
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809 <span class="comment">//    if ((popts-&gt;m_iCnChpVersion &lt; 1) || (popts-&gt;m_iCnChpVersion &gt; 2)) {popts-&gt;errAbort(&quot;Invalid CNCHP version: &quot; + ::getInt(popts-&gt;m_iCnChpVersion));}</span>
<a name="l00810"></a>00810     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;annotation-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) || (!Fs::fileExists(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;annotation-file&quot;</span>))))
<a name="l00811"></a>00811     {
<a name="l00812"></a>00812         error(<span class="stringliteral">&quot;Must specify a valid annotation-file.&quot;</span>);
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814     <span class="comment">/*</span>
<a name="l00815"></a>00815 <span class="comment">    if ((getOpt(&quot;annotation-file&quot;) == &quot;&quot;) || ((getOpt(&quot;netaffx-snp-annotation-file&quot;) == &quot;&quot;) &amp;&amp; (getOpt(&quot;netaffx-cn-annotation-file&quot;) == &quot;&quot;)))</span>
<a name="l00816"></a>00816 <span class="comment">    {</span>
<a name="l00817"></a>00817 <span class="comment">        error(&quot;Must specify an annotation-file.&quot;);</span>
<a name="l00818"></a>00818 <span class="comment">    }</span>
<a name="l00819"></a>00819 <span class="comment">    */</span>
<a name="l00820"></a>00820     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Must specify a cdf-file or spf-file.&quot;</span>);}
<a name="l00821"></a>00821 <span class="comment">//    if (getOpt(&quot;special-snps&quot;) == &quot;&quot;) {error(&quot;Must specify special-snps.&quot;);}</span>
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Must specify chrX-probes.&quot;</span>);}
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Must specify chrY-probes.&quot;</span>);}
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="keywordtype">bool</span> bFileExists = Fs::fileExists(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l00826"></a>00826     
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (bFileExists)
<a name="l00828"></a>00828     {
<a name="l00829"></a>00829         <span class="keywordflow">if</span> (affx::File5_File::isHdf5file(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>))) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Input reference is in HDF5 format.&quot;</span>);}
<a name="l00830"></a>00830         <span class="keywordflow">if</span> (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l00831"></a>00831         {
<a name="l00832"></a>00832             <span class="keywordflow">if</span> (!affx::File5_File::isHdf5file(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>))){error(<span class="stringliteral">&quot;Text format reference-file is not supported in apt-copynumber-Cyto.&quot;</span>);}
<a name="l00833"></a>00833             <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strAnnotationFileName = <a class="code" href="classCNCytoEngine.html#a00093f795f6818963406c14e66ba1b67" title="Return the annotation file names.">getAnnotationFileName</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l00834"></a>00834             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;CN Reference File\&#39;s annotation-file &quot;</span> + strAnnotationFileName);
<a name="l00835"></a>00835             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l00836"></a>00836             {
<a name="l00837"></a>00837                 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strAnnotationVersion = getAnnotationVersion(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l00838"></a>00838                 <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: CN Reference annotation-version to be used is:&quot;</span> + strAnnotationVersion);
<a name="l00839"></a>00839                 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strAnnotationArrayType = getAnnotationArrayType(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l00840"></a>00840                 <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;CN Reference annotation-array-type &quot;</span> + strAnnotationArrayType);
<a name="l00841"></a>00841             }
<a name="l00842"></a>00842             <span class="keywordflow">if</span> (strAnnotationFileName != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00843"></a>00843             {
<a name="l00844"></a>00844 <span class="comment">/* MG  put a warning here</span>
<a name="l00845"></a>00845 <span class="comment">                if (Fs::basename(strAnnotationFileName) != Fs::basename(getOpt(&quot;annotation-file&quot;)))</span>
<a name="l00846"></a>00846 <span class="comment">                {</span>
<a name="l00847"></a>00847 <span class="comment">                    error(&quot;Annotation file name does not match the reference file.&quot;);</span>
<a name="l00848"></a>00848 <span class="comment">                }</span>
<a name="l00849"></a>00849 <span class="comment">*/</span>
<a name="l00850"></a>00850                 <span class="keywordtype">int</span> iNormalizationType = -1;
<a name="l00851"></a>00851                 <span class="keywordtype">int</span> iSampleCount = -1;
<a name="l00852"></a>00852                 <span class="keywordtype">bool</span> bAdapterTypeNormalization = <span class="keyword">false</span>;
<a name="l00853"></a>00853                 <span class="keywordflow">if</span> (<a class="code" href="classCNCytoEngine.html#a49f6b27ac1f1ce3eb78a57f14e75bfec" title="Return the normalization types.">getNormalizationTypes</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>), iNormalizationType, bAdapterTypeNormalization, iSampleCount))
<a name="l00854"></a>00854                 {
<a name="l00855"></a>00855                     <span class="keywordflow">if</span>(iSampleCount != -1)
<a name="l00856"></a>00856                     {
<a name="l00857"></a>00857                         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;sample-count&quot;</span>,<a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(iSampleCount));
<a name="l00858"></a>00858                     }
<a name="l00859"></a>00859                     <span class="keywordflow">if</span> (bAdapterTypeNormalization != <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;adapter-type-normalization&quot;</span>))
<a name="l00860"></a>00860                     {
<a name="l00861"></a>00861                         error(<span class="stringliteral">&quot;Selected Adapter Type Normalization does not match reference.&quot;</span>);
<a name="l00862"></a>00862                     }
<a name="l00863"></a>00863                 } <span class="keywordflow">else</span> {error(<span class="stringliteral">&quot;Cannot open reference-file: &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));}
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865             <span class="keywordflow">else</span>
<a name="l00866"></a>00866             {
<a name="l00867"></a>00867                 error(<span class="stringliteral">&quot;Cannot retreive annotation-file name from the reference file.&quot;</span>);
<a name="l00868"></a>00868             }
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>)) {error(<span class="stringliteral">&quot;Cannot open reference-file: &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));}
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;run-geno-qc&quot;</span>))
<a name="l00874"></a>00874     {
<a name="l00875"></a>00875         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qca-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Please specify a qca-file.&quot;</span>);}
<a name="l00876"></a>00876         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qcc-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {error(<span class="stringliteral">&quot;Please specify a qcc-file.&quot;</span>);}
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>).size() &gt; 0)
<a name="l00880"></a>00880     {
<a name="l00881"></a>00881         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>).size() != <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size())
<a name="l00882"></a>00882         {
<a name="l00883"></a>00883           error(<span class="stringliteral">&quot;When specifying ARR files, the number of ARR files specified must match the number of CEL files specified .&quot;</span>);
<a name="l00884"></a>00884         }
<a name="l00885"></a>00885         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiIndex = 0; (uiIndex &lt; <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>).size()); uiIndex++)
<a name="l00886"></a>00886         {
<a name="l00887"></a>00887             <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strCelFileName = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>)[uiIndex];
<a name="l00888"></a>00888             <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strArrFileName = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>)[uiIndex];
<a name="l00889"></a>00889             <span class="keywordflow">if</span> (strArrFileName == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00890"></a>00890             {
<a name="l00891"></a>00891                 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strTempFileName = strCelFileName;
<a name="l00892"></a>00892                 <span class="keywordflow">if</span> (strTempFileName.toLowerCase().endsWith(<span class="stringliteral">&quot;.cel&quot;</span>))
<a name="l00893"></a>00893                 {
<a name="l00894"></a>00894                     strArrFileName = strCelFileName.substring(0, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)strCelFileName.length() - 4) + <span class="stringliteral">&quot;.ARR&quot;</span>;
<a name="l00895"></a>00895                 }
<a name="l00896"></a>00896                 <span class="keywordflow">else</span>
<a name="l00897"></a>00897                 {
<a name="l00898"></a>00898                     strArrFileName = strCelFileName + <span class="stringliteral">&quot;.ARR&quot;</span>;
<a name="l00899"></a>00899                 }
<a name="l00900"></a>00900                 <span class="keywordflow">if</span> (Fs::fileExists(strArrFileName)) {<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>)[uiIndex] = strArrFileName;}
<a name="l00901"></a>00901             }
<a name="l00902"></a>00902             <span class="keywordflow">else</span>
<a name="l00903"></a>00903             {
<a name="l00904"></a>00904                 <span class="keywordflow">if</span> (!Fs::fileExists(strArrFileName)) {error(<span class="stringliteral">&quot;Cannot find ARR file: &quot;</span> + strArrFileName);}
<a name="l00905"></a>00905             }
<a name="l00906"></a>00906             <span class="comment">// TODO: Check to see that ARR guid matches CEL file header.</span>
<a name="l00907"></a>00907         }
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>).size() &gt; 0)
<a name="l00911"></a>00911     {
<a name="l00912"></a>00912         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>).size() != <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size())
<a name="l00913"></a>00913         {
<a name="l00914"></a>00914           error(<span class="stringliteral">&quot;When specifying CYCHP files, the number of ARR files specified must match the number of CEL files specified .&quot;</span>);
<a name="l00915"></a>00915         }
<a name="l00916"></a>00916         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiIndex = 0; (uiIndex &lt; <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;arrs&quot;</span>).size()); uiIndex++)
<a name="l00917"></a>00917         {
<a name="l00918"></a>00918             <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strCychpFileName = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>)[uiIndex];
<a name="l00919"></a>00919             <span class="keywordflow">if</span> (strCychpFileName != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00920"></a>00920             {
<a name="l00921"></a>00921               <span class="keywordflow">if</span> ( !Fs::dirExists(<a class="code" href="classFs.html#a5308b59c6136f59d7f28947fcc0c6a71" title="just the dirname (will return &amp;quot;.&amp;quot; or &amp;quot;/&amp;quot; as well.) ///">Fs::dirname</a>(strCychpFileName)) ) {
<a name="l00922"></a>00922                 <a class="code" href="classFs.html#aea474e8df7665f070c5334fa322bd283" title="make all path of directories ///">Fs::mkdirPath</a>(<a class="code" href="classFs.html#a5308b59c6136f59d7f28947fcc0c6a71" title="just the dirname (will return &amp;quot;.&amp;quot; or &amp;quot;/&amp;quot; as well.) ///">Fs::dirname</a>(strCychpFileName), <span class="keyword">false</span>);
<a name="l00923"></a>00923               }
<a name="l00924"></a>00924             }
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926     }
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     checkChipType();
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l00931"></a>00931     {
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size() &lt; 6) {error(<span class="stringliteral">&quot;At least six cel files are needed to get a valid CN Reference file.&quot;</span>);}
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)) &amp;&amp; (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>)))
<a name="l00935"></a>00935     {
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-qc-snp-list&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00937"></a>00937         {
<a name="l00938"></a>00938             error(<span class="stringliteral">&quot;snp-qc-snp-list must be specified when running cyto2 arrays.&quot;</span>);
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Fs::fileExists(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-qc-snp-list&quot;</span>)))
<a name="l00941"></a>00941         {
<a name="l00942"></a>00942             error(<span class="stringliteral">&quot;snp-qc-snp-list must exist when specified.&quot;</span>);
<a name="l00943"></a>00943         }
<a name="l00944"></a>00944     }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00947"></a>00947     {
<a name="l00948"></a>00948         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) == <span class="stringliteral">&quot;none&quot;</span>) || (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>))
<a name="l00949"></a>00949         {
<a name="l00950"></a>00950             <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;When using the --local-gc-background-correction-reference-method, the --local-gc-background-intensity-adjustment-method must also be defined.&quot;</span>);
<a name="l00951"></a>00951         }
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00955"></a>00955     {
<a name="l00956"></a>00956         <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l00957"></a>00957         <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l00958"></a>00958         am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-intensity-adjustment-method&quot;</span>));
<a name="l00959"></a>00959         <span class="keyword">delete</span> am;
<a name="l00960"></a>00960     }
<a name="l00961"></a>00961     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;log2ratio-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;log2ratio-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00962"></a>00962     {
<a name="l00963"></a>00963         <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l00964"></a>00964         <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l00965"></a>00965         am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;log2ratio-adjustment-method&quot;</span>));
<a name="l00966"></a>00966         <span class="keyword">delete</span> am;
<a name="l00967"></a>00967     }
<a name="l00968"></a>00968     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;image-correction-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;image-correction-intensity-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00969"></a>00969     {
<a name="l00970"></a>00970         <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l00971"></a>00971         <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l00972"></a>00972         am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;image-correction-intensity-adjustment-method&quot;</span>));
<a name="l00973"></a>00973         <span class="keyword">delete</span> am;
<a name="l00974"></a>00974     }
<a name="l00975"></a>00975     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l00976"></a>00976     {
<a name="l00977"></a>00977         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00978"></a>00978         {
<a name="l00979"></a>00979             <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l00980"></a>00980             <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l00981"></a>00981             am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>));
<a name="l00982"></a>00982             <span class="keyword">delete</span> am;
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l00986"></a>00986     {
<a name="l00987"></a>00987         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-log2ratio-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-log2ratio-adjustment-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l00988"></a>00988         {
<a name="l00989"></a>00989             <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l00990"></a>00990             <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l00991"></a>00991             am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-log2ratio-adjustment-method&quot;</span>));
<a name="l00992"></a>00992             <span class="keyword">delete</span> am;
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996    <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;check-input-files&quot;</span>))
<a name="l00997"></a>00997     {
<a name="l00998"></a>00998             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;The --check-input-files default of true has been invoked.  The snp-reference-input, genotype-call-override and gender-override  files will be checked for syntax and content.  This process may take some time.  This checking may be turned of by setting the --check-input-file option to false.&quot;</span>);
<a name="l00999"></a>00999         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-output-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01000"></a>01000         {
<a name="l01001"></a>01001 
<a name="l01002"></a>01002             <span class="comment">// By the existence of the snp-reference-output-file we know we are doing a &quot;create snp-reference file&quot; run.</span>
<a name="l01003"></a>01003             <span class="comment">// Thus we check the genotype-call-override-file, gender-override, and snp-reference-input files.</span>
<a name="l01004"></a>01004 
<a name="l01005"></a>01005             <span class="comment">// Check the snp-reference-input file.</span>
<a name="l01006"></a>01006             <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01007"></a>01007             {
<a name="l01008"></a>01008                 <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Checking the --snp-reference-input-file file for syntax and content.&quot;</span>);
<a name="l01009"></a>01009                 <span class="keywordflow">if</span>(! checkSnpReferenceInputFile(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>)))
<a name="l01010"></a>01010                 {
<a name="l01011"></a>01011                     error(<span class="stringliteral">&quot;Invalid format/content found in the  --snp-reference-input-file&quot;</span>);
<a name="l01012"></a>01012                 }
<a name="l01013"></a>01013             } <span class="keywordflow">else</span>
<a name="l01014"></a>01014             {
<a name="l01015"></a>01015                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No snp-reference-input-file found during --check-input-files.&quot;</span>);
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017 
<a name="l01018"></a>01018             <span class="comment">// Check the genotype-call-override-file.</span>
<a name="l01019"></a>01019             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;genotype-call-override-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>)
<a name="l01020"></a>01020             {
<a name="l01021"></a>01021                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No genotype-call-override file found during --check-input-files.&quot;</span>);
<a name="l01022"></a>01022             }
<a name="l01023"></a>01023             <span class="keywordflow">else</span>
<a name="l01024"></a>01024             {
<a name="l01025"></a>01025                 <span class="comment">// We need to have the snp-reference-input-file to get the probesets with non-zero information content.</span>
<a name="l01026"></a>01026                 <span class="comment">// Thus we need to check for the existence of this file before beginning the check.</span>
<a name="l01027"></a>01027                 <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01028"></a>01028                 {
<a name="l01029"></a>01029                     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Checking the --genotype-call-override-file file for syntax and content.&quot;</span>);
<a name="l01030"></a>01030                     <span class="keywordflow">if</span>(! checkGenotypeCallOverrideFile( <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;genotype-call-override-file&quot;</span>),
<a name="l01031"></a>01031                                                         <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>),
<a name="l01032"></a>01032                                                         <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) )
<a name="l01033"></a>01033                       )
<a name="l01034"></a>01034                      {
<a name="l01035"></a>01035                          error(<span class="stringliteral">&quot;Invalid format/content found in the  --genotype-call-override-file&quot;</span>);
<a name="l01036"></a>01036                      }
<a name="l01037"></a>01037                 }
<a name="l01038"></a>01038                 <span class="keywordflow">else</span>
<a name="l01039"></a>01039                 {
<a name="l01040"></a>01040                     <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No snp-reference-input-file found during --check-input-files.&quot;</span>);
<a name="l01041"></a>01041                 }
<a name="l01042"></a>01042             }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044             <span class="comment">// Check the gender-override-file.</span>
<a name="l01045"></a>01045             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;gender-override-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>)
<a name="l01046"></a>01046             {
<a name="l01047"></a>01047                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No gender-override-file found during --check-input-files.&quot;</span>);
<a name="l01048"></a>01048             }
<a name="l01049"></a>01049             <span class="keywordflow">else</span>
<a name="l01050"></a>01050             {
<a name="l01051"></a>01051                 <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Checking the --gender-override-file file for syntax and content.&quot;</span>);
<a name="l01052"></a>01052                 <span class="keywordflow">if</span>(! checkGenderOverrideFile(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;gender-override-file&quot;</span>), <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>)))
<a name="l01053"></a>01053                  {
<a name="l01054"></a>01054                      error(<span class="stringliteral">&quot;Invalid format/content found in the  --gender-override-file&quot;</span>);
<a name="l01055"></a>01055                  }
<a name="l01056"></a>01056             }
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059     <span class="keywordflow">else</span>
<a name="l01060"></a>01060     {
<a name="l01061"></a>01061             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;The --check-input-files has been disabled.   The snp-reference-input, genotype-call-override and gender-override  files will NOT be checked for syntax and content at the start of the program.  Any syntax and content errors in these files will not be detected until they are used in the analyses.  This may be several hours/days into the run.&quot;</span>);
<a name="l01062"></a>01062     }
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01065"></a>01065 <span class="keywordtype">bool</span> CNCytoEngine::checkSnpReferenceInputFile(std::string strSnpReferenceFileName){
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     <span class="keywordtype">bool</span> bSuccessful=<span class="keyword">true</span>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01070"></a>01070     <span class="keywordflow">if</span>(  file5.open(strSnpReferenceFileName, affx::FILE5_OPEN_RO) != affx::FILE5_OK)
<a name="l01071"></a>01071     {
<a name="l01072"></a>01072         bSuccessful=<span class="keyword">false</span>;
<a name="l01073"></a>01073         <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01074"></a>01074     }
<a name="l01075"></a>01075     <span class="keywordflow">else</span>
<a name="l01076"></a>01076     {
<a name="l01077"></a>01077         <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = file5.openGroup(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN);
<a name="l01078"></a>01078         <span class="keywordflow">if</span>( group5-&gt;open(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l01079"></a>01079         {
<a name="l01080"></a>01080             bSuccessful=<span class="keyword">false</span>;
<a name="l01081"></a>01081             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group SNPReference in the snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01082"></a>01082         }
<a name="l01083"></a>01083         <span class="keywordflow">else</span>
<a name="l01084"></a>01084         {
<a name="l01085"></a>01085             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;EMSNParameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01086"></a>01086             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;EMSNParameters&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l01087"></a>01087             {
<a name="l01088"></a>01088                 bSuccessful=<span class="keyword">false</span>;
<a name="l01089"></a>01089                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group SNPReference/EMSParameters in the snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091             tsv5-&gt;close();
<a name="l01092"></a>01092             <span class="keyword">delete</span> tsv5;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094             tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;EMSNArray&quot;</span>, affx::FILE5_OPEN);
<a name="l01095"></a>01095             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;EMSNArray&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l01096"></a>01096             {
<a name="l01097"></a>01097                 bSuccessful=<span class="keyword">false</span>;
<a name="l01098"></a>01098                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group SNPReference/EMSNArray in the snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01099"></a>01099             }
<a name="l01100"></a>01100             tsv5-&gt;close();
<a name="l01101"></a>01101             <span class="keyword">delete</span> tsv5;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103             tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01104"></a>01104             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l01105"></a>01105             {
<a name="l01106"></a>01106                 bSuccessful=<span class="keyword">false</span>;
<a name="l01107"></a>01107                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group SNPReference/Parameters in the snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01108"></a>01108             }
<a name="l01109"></a>01109             tsv5-&gt;close();
<a name="l01110"></a>01110             <span class="keyword">delete</span> tsv5;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112             tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN);
<a name="l01113"></a>01113             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN) != affx::FILE5_OK)
<a name="l01114"></a>01114             {
<a name="l01115"></a>01115                 bSuccessful=<span class="keyword">false</span>;
<a name="l01116"></a>01116                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group SNPReference/SNPReference in the snp-reference-input-file &quot;</span> + strSnpReferenceFileName);
<a name="l01117"></a>01117             }
<a name="l01118"></a>01118             <span class="keywordflow">else</span>
<a name="l01119"></a>01119             {
<a name="l01120"></a>01120                 <span class="keywordtype">int</span> iColumnCount = tsv5-&gt;getColumnCount(0);
<a name="l01121"></a>01121                 <span class="keywordflow">if</span>( iColumnCount != 6){
<a name="l01122"></a>01122 
<a name="l01123"></a>01123                     bSuccessful=<span class="keyword">false</span>;
<a name="l01124"></a>01124                     <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Missing columns in the SNPReference/SNPReference section of the file  &quot;</span> + strSnpReferenceFileName);
<a name="l01125"></a>01125                 }
<a name="l01126"></a>01126                 <span class="keywordflow">else</span>
<a name="l01127"></a>01127                 {
<a name="l01128"></a>01128                     <span class="keywordtype">bool</span> boolFinal=<span class="keyword">true</span>;
<a name="l01129"></a>01129                     <a class="code" href="classaffx_1_1File5__TsvColumn.html">affx::File5_TsvColumn</a>* pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 0);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;probeset_id&quot;</span>);
<a name="l01132"></a>01132                     pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 1);
<a name="l01133"></a>01133                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;muAB&quot;</span>);
<a name="l01134"></a>01134                     pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 2);
<a name="l01135"></a>01135                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;muAA&quot;</span> );
<a name="l01136"></a>01136                     pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 3);
<a name="l01137"></a>01137                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;muBB&quot;</span> );
<a name="l01138"></a>01138                     pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 4);
<a name="l01139"></a>01139                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;information&quot;</span> );
<a name="l01140"></a>01140                     pColumnPointer = tsv5-&gt;<a class="code" href="classaffx_1_1File5__Tsv.html#adbf9b5b5c60f0be89248023cd6ca3609" title="This is an internal pointer - do not delete.">getColumnPtr</a>(0, 5);
<a name="l01141"></a>01141                     boolFinal = boolFinal &amp;&amp; (pColumnPointer-&gt;getColumnName() == <span class="stringliteral">&quot;useInEMAlgorithm&quot;</span> );
<a name="l01142"></a>01142 
<a name="l01143"></a>01143                     <span class="keywordflow">if</span>(! boolFinal)
<a name="l01144"></a>01144                     {
<a name="l01145"></a>01145                         bSuccessful=<span class="keyword">false</span>;
<a name="l01146"></a>01146                         <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Incorrectly named columns in the SNPReference/SNPReference section of the file  &quot;</span> + strSnpReferenceFileName);
<a name="l01147"></a>01147                     }
<a name="l01148"></a>01148                 }
<a name="l01149"></a>01149             }
<a name="l01150"></a>01150             tsv5-&gt;close();
<a name="l01151"></a>01151             <span class="keyword">delete</span> tsv5;
<a name="l01152"></a>01152         }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 
<a name="l01155"></a>01155         group5-&gt;close();
<a name="l01156"></a>01156         <span class="keyword">delete</span> group5;
<a name="l01157"></a>01157         file5.close();
<a name="l01158"></a>01158    }
<a name="l01159"></a>01159    <span class="keywordflow">return</span> bSuccessful;
<a name="l01160"></a>01160 }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 <span class="keywordtype">bool</span> CNCytoEngine::checkGenotypeCallOverrideFile(       <span class="keyword">const</span> std::string &amp;strGenotypeCallOverrideFileName,
<a name="l01164"></a>01164                                                         <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;vCelFiles,
<a name="l01165"></a>01165                                                         <span class="keyword">const</span> std::string  &amp;strSnpReferenceInputFileName )
<a name="l01166"></a>01166 {
<a name="l01167"></a>01167     <span class="keywordtype">bool</span> bSuccessful=<span class="keyword">true</span>;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     <span class="comment">// Load the probeset names from the snp-reference file that have non-zero information content.</span>
<a name="l01170"></a>01170     std::vector&lt;std::string&gt; vReferenceFileProbeSetNames;
<a name="l01171"></a>01171     <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01172"></a>01172     file5.open(strSnpReferenceInputFileName, affx::FILE5_OPEN_RO);
<a name="l01173"></a>01173     <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = file5.openGroup(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN);
<a name="l01174"></a>01174     <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;SNPReference&quot;</span>, affx::FILE5_OPEN);
<a name="l01175"></a>01175     <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         <span class="keywordtype">double</span> dInformation;
<a name="l01178"></a>01178         tsv5-&gt;get(0, 4, &amp;dInformation);
<a name="l01179"></a>01179         <span class="keywordflow">if</span>(dInformation &gt;0.0)
<a name="l01180"></a>01180         {
<a name="l01181"></a>01181             std::string strProbeSetName;
<a name="l01182"></a>01182             tsv5-&gt;get(0, 0, &amp;strProbeSetName);
<a name="l01183"></a>01183             vReferenceFileProbeSetNames.push_back(strProbeSetName);
<a name="l01184"></a>01184          }
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186     tsv5-&gt;close();
<a name="l01187"></a>01187     <span class="keyword">delete</span> tsv5;
<a name="l01188"></a>01188     group5-&gt;close();
<a name="l01189"></a>01189     <span class="keyword">delete</span> group5;
<a name="l01190"></a>01190     file5.close();
<a name="l01191"></a>01191     <span class="comment">// Done loading the probeset names.</span>
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="comment">// Load data from genotype-call-override file. There are 3 types of data to load and check:</span>
<a name="l01196"></a>01196     <span class="comment">//  1)  The first row must have the form:   &quot;probeset_id&quot;  followed by a CEL file name for</span>
<a name="l01197"></a>01197     <span class="comment">//      each column for which we have external genotype calls. We check for the existence of</span>
<a name="l01198"></a>01198     <span class="comment">//      the &quot;probeset_id&quot;.</span>
<a name="l01199"></a>01199     <span class="comment">//  2)  Then we load the CEL file names found in the remainder of the first row.</span>
<a name="l01200"></a>01200     <span class="comment">//  3)  Load the probeset names found in the first column.</span>
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a> *tsv = <span class="keyword">new</span> <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a>;
<a name="l01204"></a>01204     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a763ce0bbf19b4134d0445aa58e0f5011" title="Opens a file -- attempts to guess some defaults.">open</a>(strGenotypeCallOverrideFileName);
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="comment">//  1) Do a syntax check on the first row.  i.e check for the existence of &quot;probeset_id&quot;.</span>
<a name="l01207"></a>01207     std::string strSyntaxCheck =  tsv-&gt;getColumnName(0,0);
<a name="l01208"></a>01208     <span class="keywordflow">if</span>(strSyntaxCheck != <span class="stringliteral">&quot;probeset_id&quot;</span>)
<a name="l01209"></a>01209     {
<a name="l01210"></a>01210         bSuccessful = <span class="keyword">false</span>;
<a name="l01211"></a>01211         <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;The first row of the first column of the --genotype-call-override file must be the word:  \&#39;probeset_id\&#39; . The remainder of the first row must be a tab separated list of the CEL files for which external genotype information is being provided.&quot;</span>);
<a name="l01212"></a>01212     }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="comment">//  2) Load the names of the CEL files for which we have external genotype call data.</span>
<a name="l01216"></a>01216     std::vector&lt;std::string&gt; vGenoCelFileNames;
<a name="l01217"></a>01217     std::string celFileName;
<a name="l01218"></a>01218     <span class="keywordtype">int</span> iNumberOfCelFiles = tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a94ad901d12ab05cce0f050f99665970f" title="The number of columns for this level ///.">getColumnCount</a>(0);
<a name="l01219"></a>01219     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndex=1; iIndex &lt; iNumberOfCelFiles; iIndex++)
<a name="l01220"></a>01220     {
<a name="l01221"></a>01221         celFileName = tsv-&gt;getColumnName(0, iIndex);
<a name="l01222"></a>01222         vGenoCelFileNames.push_back(celFileName);
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     <span class="comment">//  3) Load the probeset names contained in the --genotype-call-override file.</span>
<a name="l01227"></a>01227     std::vector&lt;std::string&gt; vGenoFileProbeSetNames;
<a name="l01228"></a>01228     <span class="keywordflow">while</span> (tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl ///.">nextLevel</a>(0)==affx::TSV_OK)
<a name="l01229"></a>01229     {
<a name="l01230"></a>01230         std::string strProbeSetName;
<a name="l01231"></a>01231         tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field ///.">get</a>(0, 0, strProbeSetName);
<a name="l01232"></a>01232         vGenoFileProbeSetNames.push_back(strProbeSetName);
<a name="l01233"></a>01233     }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235     <span class="comment">//  Determine whether the set of probesets in the snp-reference file with non-zero information</span>
<a name="l01236"></a>01236     <span class="comment">//  all have entries in the the genotype-call-override file.</span>
<a name="l01237"></a>01237     sort(vGenoFileProbeSetNames.begin(), vGenoFileProbeSetNames.end(), <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01238"></a>01238     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndex = 0;  iIndex &lt; vReferenceFileProbeSetNames.size(); iIndex++)
<a name="l01239"></a>01239     {
<a name="l01240"></a>01240         <span class="keywordtype">bool</span> stringFound = <span class="keyword">false</span>;
<a name="l01241"></a>01241         stringFound = binary_search(    vGenoFileProbeSetNames.begin(),
<a name="l01242"></a>01242                                         vGenoFileProbeSetNames.end(),
<a name="l01243"></a>01243                                         vReferenceFileProbeSetNames[iIndex],
<a name="l01244"></a>01244                                         <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01245"></a>01245 
<a name="l01246"></a>01246         <span class="keywordflow">if</span>(!stringFound)
<a name="l01247"></a>01247         {
<a name="l01248"></a>01248 
<a name="l01249"></a>01249             bSuccessful=<span class="keyword">false</span>;
<a name="l01250"></a>01250             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No external genotype-call information was found in the genotype-call-override file for the probeset &quot;</span> + vReferenceFileProbeSetNames[iIndex] + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l01251"></a>01251 
<a name="l01252"></a>01252         }
<a name="l01253"></a>01253     }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     <span class="comment">//  Determine whether the set of CEL files for which we have external genotype-call information</span>
<a name="l01256"></a>01256     <span class="comment">//  contains data for all the CEL files defined in the --cel-files command.</span>
<a name="l01257"></a>01257     sort(vGenoCelFileNames.begin(), vGenoCelFileNames.end(), <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01258"></a>01258     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndex = 0;  iIndex &lt; vCelFiles.size(); iIndex++)
<a name="l01259"></a>01259     {
<a name="l01260"></a>01260         <span class="keywordtype">bool</span> stringFound = <span class="keyword">false</span>;
<a name="l01261"></a>01261         stringFound = binary_search(    vGenoCelFileNames.begin(),
<a name="l01262"></a>01262                                         vGenoCelFileNames.end(),
<a name="l01263"></a>01263                                         <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(vCelFiles[iIndex]),
<a name="l01264"></a>01264                                         <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01265"></a>01265 
<a name="l01266"></a>01266         <span class="keywordflow">if</span>(!stringFound)
<a name="l01267"></a>01267         {
<a name="l01268"></a>01268 
<a name="l01269"></a>01269             bSuccessful=<span class="keyword">false</span>;
<a name="l01270"></a>01270             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No external genotype-call information was found in the genotype-call-override file for the CEL file &quot;</span> + vCelFiles[iIndex] + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272         }
<a name="l01273"></a>01273     }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     <span class="keywordtype">char</span> cGenotype;
<a name="l01276"></a>01276     <span class="keywordtype">int</span> iGetValue;
<a name="l01277"></a>01277     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a05d594ceb54634fb1f39ca768276800e" title="Rewind back to the start of the data and clear the fields ///.">rewind</a>();
<a name="l01278"></a>01278     <span class="keywordflow">while</span> (tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl ///.">nextLevel</a>(0)==affx::TSV_OK)
<a name="l01279"></a>01279     {
<a name="l01280"></a>01280         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndex=1; iIndex &lt; iNumberOfCelFiles; iIndex++)
<a name="l01281"></a>01281         {
<a name="l01282"></a>01282             tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field ///.">get</a>(0, iIndex, iGetValue);
<a name="l01283"></a>01283             cGenotype = (char)(iGetValue);
<a name="l01284"></a>01284             <span class="keywordflow">if</span>( cGenotype != -1 &amp;&amp;  cGenotype != 0 &amp;&amp;  cGenotype != 1 &amp;&amp; cGenotype != 2)
<a name="l01285"></a>01285             {
<a name="l01286"></a>01286                 bSuccessful=<span class="keyword">false</span>;
<a name="l01287"></a>01287                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;An invalid genotype call of &quot;</span> + <a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iGetValue)  + <span class="stringliteral">&quot; was found in the --genotype-call-override file.&quot;</span>);
<a name="l01288"></a>01288             }
<a name="l01289"></a>01289         }
<a name="l01290"></a>01290     }
<a name="l01291"></a>01291     <span class="keyword">delete</span> tsv;
<a name="l01292"></a>01292   <span class="keywordflow">return</span> bSuccessful;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 <span class="keywordtype">bool</span> CNCytoEngine::checkGenderOverrideFile(     <span class="keyword">const</span> std::string &amp;strGenderOverrideFileName,
<a name="l01300"></a>01300                                                 <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;vCelFiles)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <span class="keywordtype">bool</span> bSuccessful=<span class="keyword">true</span>;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a> *tsv = <span class="keyword">new</span> <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a>;
<a name="l01305"></a>01305     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a763ce0bbf19b4134d0445aa58e0f5011" title="Opens a file -- attempts to guess some defaults.">open</a>(strGenderOverrideFileName);
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="comment">//  1) Do a syntax check on the first row.  i.e check for the existence of the words: &quot;experiment&quot; and &quot;gender&quot;.</span>
<a name="l01308"></a>01308     std::string strSyntaxCheck1 =  tsv-&gt;getColumnName(0,0);
<a name="l01309"></a>01309     std::string strSyntaxCheck2 =  tsv-&gt;getColumnName(0,1);
<a name="l01310"></a>01310     <span class="keywordflow">if</span>(strSyntaxCheck1 != <span class="stringliteral">&quot;experiment&quot;</span> || strSyntaxCheck2 != <span class="stringliteral">&quot;gender&quot;</span>)
<a name="l01311"></a>01311     {
<a name="l01312"></a>01312         bSuccessful = <span class="keyword">false</span>;
<a name="l01313"></a>01313         <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;The first row of the gender-override-file must be the words:  \&#39;experiment\&#39; and \&#39; gender\&#39;, tab separated.&quot;</span>);
<a name="l01314"></a>01314     }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     <span class="comment">//  2) Load the names of the experiments i.e. CEL files for which we have external gender data.</span>
<a name="l01318"></a>01318     std::vector&lt;std::string&gt; vGenderCelFileNames;
<a name="l01319"></a>01319     std::string strCelFileName;
<a name="l01320"></a>01320     <span class="keywordflow">while</span> (tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl ///.">nextLevel</a>(0)==affx::TSV_OK)
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322         tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field ///.">get</a>(0, 0, strCelFileName);
<a name="l01323"></a>01323         vGenderCelFileNames.push_back(strCelFileName);
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="comment">//  Determine whether the set of CEL files for which we have external gender information</span>
<a name="l01328"></a>01328     <span class="comment">//  contains data for all the CEL files defined in the --cel-files command.</span>
<a name="l01329"></a>01329     sort(vGenderCelFileNames.begin(), vGenderCelFileNames.end(), <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01330"></a>01330     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iIndex = 0;  iIndex &lt; vCelFiles.size(); iIndex++)
<a name="l01331"></a>01331     {
<a name="l01332"></a>01332         <span class="keywordtype">bool</span> stringFound = <span class="keyword">false</span>;
<a name="l01333"></a>01333         stringFound = binary_search(    vGenderCelFileNames.begin(),
<a name="l01334"></a>01334                                         vGenderCelFileNames.end(),
<a name="l01335"></a>01335                                         <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(vCelFiles[iIndex]),
<a name="l01336"></a>01336                                         <a class="code" href="classStringLessThan.html">StringLessThan</a>());
<a name="l01337"></a>01337 
<a name="l01338"></a>01338         <span class="keywordflow">if</span>(!stringFound)
<a name="l01339"></a>01339         {
<a name="l01340"></a>01340 
<a name="l01341"></a>01341             bSuccessful=<span class="keyword">false</span>;
<a name="l01342"></a>01342             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;No external gender information was found in the gender-override file for the CEL file &quot;</span> + vCelFiles[iIndex] + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l01343"></a>01343 
<a name="l01344"></a>01344         }
<a name="l01345"></a>01345     }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347     std::string strGetValue;
<a name="l01348"></a>01348     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a05d594ceb54634fb1f39ca768276800e" title="Rewind back to the start of the data and clear the fields ///.">rewind</a>();
<a name="l01349"></a>01349     <span class="keywordflow">while</span> (tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a2022895d082d1d635e7f59fccab12afb" title="Skip to the next level of data which matches seek_clvl ///.">nextLevel</a>(0)==affx::TSV_OK)
<a name="l01350"></a>01350     {
<a name="l01351"></a>01351         tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a7a81092ce134e8c9116a1a5bcfe287d1" title="Get the string value of a field ///.">get</a>(0, 1, strGetValue);
<a name="l01352"></a>01352         <span class="keywordflow">if</span>( strGetValue != <span class="stringliteral">&quot;F&quot;</span> &amp;&amp; strGetValue != <span class="stringliteral">&quot;M&quot;</span>)
<a name="l01353"></a>01353         {
<a name="l01354"></a>01354             bSuccessful=<span class="keyword">false</span>;
<a name="l01355"></a>01355             <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;An invalid gender call of &quot;</span> + strGetValue  + <span class="stringliteral">&quot; was found in the --gender-override-file.&quot;</span>);
<a name="l01356"></a>01356         }
<a name="l01357"></a>01357     }
<a name="l01358"></a>01358     <span class="keyword">delete</span> tsv;
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     <span class="keywordflow">return</span> bSuccessful;
<a name="l01361"></a>01361 
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="comment"></span>
<a name="l01365"></a>01365 <span class="comment">/**</span>
<a name="l01366"></a>01366 <span class="comment"> * @brief Run the specified analysis</span>
<a name="l01367"></a>01367 <span class="comment"> */</span>
<a name="l01368"></a>01368 <span class="keywordtype">void</span> CNCytoEngine::runImp() {
<a name="l01369"></a>01369   <span class="comment">// make this all one big try catch to make sure destructors are</span>
<a name="l01370"></a>01370   <span class="comment">// called if exceptions thrown.</span>
<a name="l01371"></a>01371   <span class="keywordflow">try</span> { <span class="comment">// outer try for handling the exception.</span>
<a name="l01372"></a>01372     <span class="keywordflow">try</span> { <span class="comment">// inner try for memory clean up.</span>
<a name="l01373"></a>01373       <a class="code" href="classFs.html#a878bcfc24efce5cf21c788e0dd801279" title="This will make the dir if it isnt there. /// If it is there, that is ok as long as it is writeable...">Fs::ensureWriteableDirPath</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>));
<a name="l01374"></a>01374       <a class="code" href="classFs.html#a878bcfc24efce5cf21c788e0dd801279" title="This will make the dir if it isnt there. /// If it is there, that is ok as long as it is writeable...">Fs::ensureWriteableDirPath</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l01375"></a>01375       <span class="comment">//</span>
<a name="l01376"></a>01376       <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;keep-intermediate-data&quot;</span>)) {
<a name="l01377"></a>01377         <span class="keywordtype">string</span> strAnalysisFilePath=<a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<span class="stringliteral">&quot;analysis&quot;</span>);
<a name="l01378"></a>01378         <a class="code" href="classFs.html#a878bcfc24efce5cf21c788e0dd801279" title="This will make the dir if it isnt there. /// If it is there, that is ok as long as it is writeable...">Fs::ensureWriteableDirPath</a>(strAnalysisFilePath);
<a name="l01379"></a>01379       }
<a name="l01380"></a>01380         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: Running Copy Number Cyto Engine.&quot;</span>);
<a name="l01381"></a>01381         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l01382"></a>01382         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;reference-cels&quot;</span>).size() &gt; 0)
<a name="l01383"></a>01383         {
<a name="l01384"></a>01384             std::vector&lt;std::string&gt; vCels = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l01385"></a>01385             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>, <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;reference-cels&quot;</span>));
<a name="l01386"></a>01386 
<a name="l01387"></a>01387             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;copynumber-reference-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l01388"></a>01388             useReference(<span class="keyword">false</span>);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>, vCels);
<a name="l01391"></a>01391             useReference(<span class="keyword">true</span>);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393         }
<a name="l01394"></a>01394         <span class="keywordflow">else</span>
<a name="l01395"></a>01395         {
<a name="l01396"></a>01396             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l01397"></a>01397             {
<a name="l01398"></a>01398                 createReference();
<a name="l01399"></a>01399             }
<a name="l01400"></a>01400             <span class="keywordflow">else</span>
<a name="l01401"></a>01401             {
<a name="l01402"></a>01402                 <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;copynumber-reference-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>));
<a name="l01403"></a>01403                 useReference(<span class="keyword">true</span>);
<a name="l01404"></a>01404             }
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: Done Running Copy Number Cyto Engine.&quot;</span>);   
<a name="l01407"></a>01407     } <span class="comment">// inner try end</span>
<a name="l01408"></a>01408     <span class="keywordflow">catch</span> (...) {
<a name="l01409"></a>01409       <span class="comment">// Free up any allocated memory here...</span>
<a name="l01410"></a>01410         <a class="code" href="classCNCytoEngine.html#a73f4a636dbcce9f8819ef2c7b58fed4a" title="Initialize the data and free any memory allocated.">clear</a>();
<a name="l01411"></a>01411       <span class="comment">// re-throw the unchanged exception.</span>
<a name="l01412"></a>01412       <span class="keywordflow">throw</span>;
<a name="l01413"></a>01413     }
<a name="l01414"></a>01414   } <span class="comment">// outer try end</span>
<a name="l01415"></a>01415   <span class="comment">/* When things go wrong see if we can die gracefully here. */</span>
<a name="l01416"></a>01416   <span class="keywordflow">catch</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a> &amp;e) {
<a name="l01417"></a>01417     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01418"></a>01418     error(<span class="stringliteral">&quot;Exception caught. &quot;</span>
<a name="l01419"></a>01419                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.<a class="code" href="classExcept.html#a6983a18bbb12fd78301d1ee77b2371ff" title="Standard what() call, just returns error message.">what</a>()));
<a name="l01420"></a>01420   }
<a name="l01421"></a>01421   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::bad_alloc &amp;e) {
<a name="l01422"></a>01422     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01423"></a>01423     error(<span class="stringliteral">&quot;std::bad_alloc caught. &quot;</span>
<a name="l01424"></a>01424                   <span class="stringliteral">&quot;The application has run out of memory. &quot;</span>
<a name="l01425"></a>01425                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.what()));
<a name="l01426"></a>01426   }
<a name="l01427"></a>01427   <span class="keywordflow">catch</span>(<a class="code" href="classaffymetrix__calvin__exceptions_1_1CalvinException.html">affymetrix_calvin_exceptions::CalvinException</a> &amp;ce) {
<a name="l01428"></a>01428     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01429"></a>01429     error(<span class="stringliteral">&quot;affymetrix_calvin_exceptions::CalvinException caught. &quot;</span>
<a name="l01430"></a>01430                    <span class="stringliteral">&quot;Affymetrix GeneChip Command Console library has thrown an exception. &quot;</span>
<a name="l01431"></a>01431                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="classaffymetrix__calvin__utilities_1_1StringUtils.html#a6f76720a2b06c2705477ee7498d7ccd0">affymetrix_calvin_utilities::StringUtils::ConvertWCSToMBS</a>(ce.<a class="code" href="classaffymetrix__calvin__exceptions_1_1CalvinException.html#a24f3db249eaee80ba1010dcc9e4db3d2">Description</a>()));
<a name="l01432"></a>01432   }
<a name="l01433"></a>01433   <span class="keywordflow">catch</span>(<a class="code" href="classBroadException.html">BroadException</a> &amp;e) {
<a name="l01434"></a>01434     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01435"></a>01435     error(<span class="stringliteral">&quot;BroadException caught. &quot;</span>
<a name="l01436"></a>01436                   <span class="stringliteral">&quot;Message is: &#39;&quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.m_msg) + <span class="stringliteral">&quot;&#39; source file: &#39;&quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.m_sourcefile) +
<a name="l01437"></a>01437                   <span class="stringliteral">&quot;:&quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.m_sourceline) + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l01438"></a>01438   }
<a name="l01439"></a>01439   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception &amp;e) {
<a name="l01440"></a>01440     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01441"></a>01441     error(<span class="stringliteral">&quot;std::exception caught. &quot;</span>
<a name="l01442"></a>01442                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.what()));
<a name="l01443"></a>01443   }
<a name="l01444"></a>01444   <span class="keywordflow">catch</span>(<span class="keyword">const</span> BaseException &amp;e) {
<a name="l01445"></a>01445     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01446"></a>01446     error(<span class="stringliteral">&quot;newmat BaseException caught. &quot;</span>
<a name="l01447"></a>01447                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.what()));
<a name="l01448"></a>01448   }
<a name="l01449"></a>01449   <span class="keywordflow">catch</span>(...) {
<a name="l01450"></a>01450     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l01451"></a>01451     error(<span class="stringliteral">&quot;Unknown exception caught. &quot;</span>
<a name="l01452"></a>01452                   <span class="stringliteral">&quot;No message is available.&quot;</span>);
<a name="l01453"></a>01453   }
<a name="l01454"></a>01454   <span class="comment">// free any allocated memory here...</span>
<a name="l01455"></a>01455   <a class="code" href="classCNCytoEngine.html#a73f4a636dbcce9f8819ef2c7b58fed4a" title="Initialize the data and free any memory allocated.">clear</a>();
<a name="l01456"></a>01456 }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="keywordtype">void</span> CNCytoEngine::createReference()
<a name="l01459"></a>01459 {
<a name="l01460"></a>01460     <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a>* engine = <span class="keyword">new</span> <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a>;
<a name="l01461"></a>01461     engine-&gt;setEngine(<span class="keyword">this</span>);
<a name="l01462"></a>01462     engine-&gt;createAnalysis();
<a name="l01463"></a>01463     <span class="keyword">delete</span> engine; engine = NULL;
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     <a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>* pdata = <span class="keyword">new</span> <a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>();
<a name="l01466"></a>01466     pdata-&gt;setEngine(<span class="keyword">this</span>);
<a name="l01467"></a>01467     <span class="keywordtype">int</span> iExperimentCount = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size();
<a name="l01468"></a>01468     pdata-&gt;getExperiments()-&gt;deleteAll();
<a name="l01469"></a>01469     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iExperimentIndex = 0; (iExperimentIndex &lt; iExperimentCount); iExperimentIndex++)
<a name="l01470"></a>01470     {
<a name="l01471"></a>01471         <a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>* p = <span class="keyword">new</span> <a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>;
<a name="l01472"></a>01472         p-&gt;setIndex(iExperimentIndex);        
<a name="l01473"></a>01473         p-&gt;setExperimentName(<a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>)[iExperimentIndex]));
<a name="l01474"></a>01474         pdata-&gt;getExperiments()-&gt;add(p);
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (iExperimentCount == 0) {<span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;No experiments to process.&quot;</span>));}
<a name="l01477"></a>01477     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iExperimentCount));
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     pdata-&gt;loadAnnotation(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>));      
<a name="l01480"></a>01480     <a class="code" href="classCNCytoEngine.html#a75edd342e8dd57109c0b74e048a8ef1f" title="Calculate the genders of the specified samples (cel files).">calculateGenders</a>(*pdata);
<a name="l01481"></a>01481     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;run-geno-qc&quot;</span>)) {<a class="code" href="classCNCytoEngine.html#a7b2d46809ff3497b68c8003a22bf990e" title="Call the geno-qc engine.">callGenoQCEngine</a>();}
<a name="l01482"></a>01482     removeTempProbeFiles();
<a name="l01483"></a>01483     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;temp-reference-file&quot;</span>, runReferencePart1(*pdata));
<a name="l01484"></a>01484 
<a name="l01485"></a>01485 <span class="comment">//    if (getOptBool(&quot;cyto2&quot;))</span>
<a name="l01486"></a>01486     {
<a name="l01487"></a>01487         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l01488"></a>01488         {
<a name="l01489"></a>01489             <span class="comment">// pdnn takes a lot of memory so we want to clear as much as we can before running it.</span>
<a name="l01490"></a>01490             <a class="code" href="classCNExperimentArray.html" title="A vector of CNExperiment pointers.">CNExperimentArray</a> v = *pdata-&gt;getExperiments();
<a name="l01491"></a>01491             pdata-&gt;getExperiments()-&gt;nullAll();
<a name="l01492"></a>01492             <span class="keyword">delete</span> pdata; pdata = NULL;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l01495"></a>01495             <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l01496"></a>01496             <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l01497"></a>01497             am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;local-gc-background-correction-reference-method&quot;</span>));
<a name="l01498"></a>01498             am-&gt;setEngine(<span class="keyword">this</span>);
<a name="l01499"></a>01499             am-&gt;run();
<a name="l01500"></a>01500             <span class="keyword">delete</span> am;
<a name="l01501"></a>01501             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l01502"></a>01502 
<a name="l01503"></a>01503             pdata = <span class="keyword">new</span> <a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>();
<a name="l01504"></a>01504             pdata-&gt;setEngine(<span class="keyword">this</span>);
<a name="l01505"></a>01505             pdata-&gt;setExperiments(v);
<a name="l01506"></a>01506             v.nullAll();
<a name="l01507"></a>01507             pdata-&gt;loadAnnotation(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>));
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510 
<a name="l01511"></a>01511     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {pdata-&gt;<a class="code" href="classCNLog2RatioData.html#a235e31fd7f73d9b75bb00257c85df4c6" title="Load the SNP reference file and set up the Probe Set array with the pre-calculated median values from...">loadSnpReferenceFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>));}
<a name="l01512"></a>01512     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;gender-override-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {pdata-&gt;<a class="code" href="classCNLog2RatioData.html#add763f5c3430427312c6717c20f34547" title="Load externally computed experiment genders.">loadGenderOverrideFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;gender-override-file&quot;</span>));}
<a name="l01513"></a>01513     runReferencePart2(*pdata, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-reference-file&quot;</span>));
<a name="l01514"></a>01514     <a class="code" href="classCNExperimentArray.html" title="A vector of CNExperiment pointers.">CNExperimentArray</a> arExperiments;
<a name="l01515"></a>01515     CNExperimentArray::copyExperiments(*pdata-&gt;getExperiments(), arExperiments);
<a name="l01516"></a>01516     <span class="keyword">delete</span> pdata; pdata = NULL;
<a name="l01517"></a>01517     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;none&quot;</span>) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l01518"></a>01518     {
<a name="l01519"></a>01519         <a class="code" href="classCNProbeSetArray.html" title="A vector of ProbeSet Pointers.">CNProbeSetArray</a> vDummy;
<a name="l01520"></a>01520         <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l01521"></a>01521         <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* am = NULL;
<a name="l01522"></a>01522         am = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;wave-correction-reference-method&quot;</span>));
<a name="l01523"></a>01523         am-&gt;setEngine(<span class="keyword">this</span>);
<a name="l01524"></a>01524         am-&gt;setup(arExperiments, 0, vDummy);
<a name="l01525"></a>01525         am-&gt;run();
<a name="l01526"></a>01526         <span class="keyword">delete</span> am;
<a name="l01527"></a>01527     }
<a name="l01528"></a>01528     arExperiments.deleteAll();
<a name="l01529"></a>01529     <span class="keywordflow">if</span>(!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;keep-temp-reference-data&quot;</span>))
<a name="l01530"></a>01530     {
<a name="l01531"></a>01531       <a class="code" href="classFs.html#a6b8f232817f933a42c21edde6ea55a3a" title="An error if it doesnt exist.">Fs::rm</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-reference-file&quot;</span>),<span class="keyword">false</span>);
<a name="l01532"></a>01532     }
<a name="l01533"></a>01533 }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> CNCytoEngine::runReferencePart1(<a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>&amp; data)
<a name="l01536"></a>01536 {
<a name="l01537"></a>01537     <a class="code" href="classCNAnalysisMethodReference.html" title="The Reference Analysis Method.">CNAnalysisMethodReference</a> reference;
<a name="l01538"></a>01538     reference.setEngine(<span class="keyword">this</span>);
<a name="l01539"></a>01539     reference.setup(*data.getExperiments(), *data.getProbeSets());
<a name="l01540"></a>01540     reference.runPart1();
<a name="l01541"></a>01541     <span class="keywordflow">return</span> reference.getTempFileName();
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01544"></a>01544 <span class="keywordtype">void</span> CNCytoEngine::runReferencePart2(<a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>&amp; data, <span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strTempFileName)
<a name="l01545"></a>01545 {
<a name="l01546"></a>01546     <a class="code" href="classCNAnalysisMethodReference.html" title="The Reference Analysis Method.">CNAnalysisMethodReference</a> reference;
<a name="l01547"></a>01547     reference.setEngine(<span class="keyword">this</span>);
<a name="l01548"></a>01548     reference.setup(*data.getExperiments(), *data.getProbeSets());
<a name="l01549"></a>01549     reference.setTempFileName(strTempFileName);
<a name="l01550"></a>01550     reference.runPart2();
<a name="l01551"></a>01551 }
<a name="l01552"></a>01552 
<a name="l01553"></a>01553 <span class="keywordtype">void</span> CNCytoEngine::useReference(<span class="keywordtype">bool</span> bAnalysis)
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555     <a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a> data;
<a name="l01556"></a>01556     data.setEngine(<span class="keyword">this</span>);
<a name="l01557"></a>01557     <a class="code" href="classCNAnalysisEngine.html" title="The engine for copy number calculations post log2 ratio calculation.">CNAnalysisEngine</a> engine;
<a name="l01558"></a>01558     engine.setEngine(<span class="keyword">this</span>);
<a name="l01559"></a>01559     engine.createAnalysis();
<a name="l01560"></a>01560     data.loadAnnotation(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>));
<a name="l01561"></a>01561     <span class="keywordtype">int</span> iExperimentCount = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size();
<a name="l01562"></a>01562     data.getExperiments()-&gt;deleteAll();
<a name="l01563"></a>01563     loadReferenceHeader(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-input&quot;</span>));
<a name="l01564"></a>01564 
<a name="l01565"></a>01565     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iExperimentIndex = 0; (iExperimentIndex &lt; iExperimentCount); iExperimentIndex++)
<a name="l01566"></a>01566     {
<a name="l01567"></a>01567         <a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>* p = <span class="keyword">new</span> <a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>;
<a name="l01568"></a>01568         p-&gt;setIndex(iExperimentIndex);
<a name="l01569"></a>01569         p-&gt;setExperimentName(<a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>)[iExperimentIndex]));
<a name="l01570"></a>01570         p-&gt;setCNReferenceHeader(m_vCNReferenceHeader);
<a name="l01571"></a>01571 <span class="comment">//MG temporary code for Bitao</span>
<a name="l01572"></a>01572                 <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;normal-diploid-files-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l01573"></a>01573                 {
<a name="l01574"></a>01574                         p-&gt;setExperimentNormalDiploidFileName(<a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;normal-diploid-files&quot;</span>)[iExperimentIndex]);
<a name="l01575"></a>01575                 }
<a name="l01576"></a>01576 <span class="comment">//</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 
<a name="l01579"></a>01579         data.getExperiments()-&gt;add(p);
<a name="l01580"></a>01580     }
<a name="l01581"></a>01581     <span class="keywordflow">if</span> (iExperimentCount == 0) {<span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;No experiments to process.&quot;</span>));}   
<a name="l01582"></a>01582     <a class="code" href="classCNCytoEngine.html#a75edd342e8dd57109c0b74e048a8ef1f" title="Calculate the genders of the specified samples (cel files).">calculateGenders</a>(data);
<a name="l01583"></a>01583 
<a name="l01584"></a>01584     <span class="keywordflow">if</span> (bAnalysis)
<a name="l01585"></a>01585     {
<a name="l01586"></a>01586         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;run-geno-qc&quot;</span>)) {<a class="code" href="classCNCytoEngine.html#a7b2d46809ff3497b68c8003a22bf990e" title="Call the geno-qc engine.">callGenoQCEngine</a>();}
<a name="l01587"></a>01587     }
<a name="l01588"></a>01588     removeTempProbeFiles();
<a name="l01589"></a>01589 
<a name="l01590"></a>01590     <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l01591"></a>01591     {
<a name="l01592"></a>01592         data.<a class="code" href="classCNLog2RatioData.html#a781c14ec7d3a8d045c4ec139f73440a0" title="Load the QC metrics from the report file.">loadQCMetrics</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>));
<a name="l01593"></a>01593     }
<a name="l01594"></a>01594     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l01595"></a>01595     {
<a name="l01596"></a>01596         data.<a class="code" href="classCNLog2RatioData.html#a98563435a322545374c99293c7ff7c82" title="Load the model file and set up the Probe Set array with the pre-calculated median values from the log...">loadCyto2ModelFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;copynumber-reference-file&quot;</span>));
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598     <span class="keywordflow">else</span>
<a name="l01599"></a>01599     {
<a name="l01600"></a>01600         data.<a class="code" href="classCNLog2RatioData.html#ac2d7caba60586cf34f587b645632eefb" title="Load the model file and set up the Probe Set array with the pre-calculated median values from the log...">loadModelFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;copynumber-reference-file&quot;</span>));
<a name="l01601"></a>01601     }
<a name="l01602"></a>01602     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {data.<a class="code" href="classCNLog2RatioData.html#a235e31fd7f73d9b75bb00257c85df4c6" title="Load the SNP reference file and set up the Probe Set array with the pre-calculated median values from...">loadSnpReferenceFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;snp-reference-input-file&quot;</span>));}
<a name="l01603"></a>01603     <span class="keywordtype">int</span> iProcessCount = data.getProbeSets()-&gt;getProcessCount();
<a name="l01604"></a>01604     <a class="code" href="classCNProbeSetArray.html" title="A vector of ProbeSet Pointers.">CNProbeSetArray</a> arProbeSetsToProcess;
<a name="l01605"></a>01605     arProbeSetsToProcess.reserve(iProcessCount);
<a name="l01606"></a>01606     <span class="keywordtype">int</span> iProbeSetCount = data.getProbeSetsAlternateSort()-&gt;getCount();
<a name="l01607"></a>01607     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iIndex = 0; (iIndex &lt; iProbeSetCount); iIndex++)
<a name="l01608"></a>01608     {
<a name="l01609"></a>01609         <span class="keywordflow">if</span> (data.getProbeSetsAlternateSort()-&gt;getAt(iIndex)-&gt;isProcess())
<a name="l01610"></a>01610         {
<a name="l01611"></a>01611             arProbeSetsToProcess.add(data.getProbeSetsAlternateSort()-&gt;getAt(iIndex));
<a name="l01612"></a>01612         }
<a name="l01613"></a>01613     }
<a name="l01614"></a>01614     arProbeSetsToProcess.quickSort(1);
<a name="l01615"></a>01615     <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> amFactory;
<a name="l01616"></a>01616     <a class="code" href="classCNAnalysisMethod.html" title="A base class for copy number analysis methods.">CNAnalysisMethod</a>* pChipstream = NULL;
<a name="l01617"></a>01617     pChipstream = amFactory.<a class="code" href="classCNAnalysisMethodFactory.html#adc33a01614b4d68d23f9de3200945bfb" title="Create a pointer to a new CNAnalysisMethod object as described in the string specification.">CNAnalysisMethodForString</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chipstream&quot;</span>));
<a name="l01618"></a>01618     pChipstream -&gt;setEngine(<span class="keyword">this</span>);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keywordflow">if</span> (!bAnalysis)
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         data.getAAlleleEstimates()-&gt;initialize(iExperimentCount, iProbeSetCount);
<a name="l01624"></a>01624         data.getBAlleleEstimates()-&gt;initialize(iExperimentCount, iProbeSetCount);
<a name="l01625"></a>01625         data.getGenotypeCalls()-&gt;initialize(iExperimentCount, iProbeSetCount);
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iExperimentIndex = 0; (iExperimentIndex &lt; iExperimentCount); iExperimentIndex++)
<a name="l01628"></a>01628     {
<a name="l01629"></a>01629 
<a name="l01630"></a>01630 
<a name="l01631"></a>01631         std::string strExperimentName = (*data.getExperiments()-&gt;getAt(iExperimentIndex)).getExperimentName();
<a name="l01632"></a>01632         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: Running  Analysis of Sample: &quot;</span> + strExperimentName);
<a name="l01633"></a>01633 
<a name="l01634"></a>01634         pChipstream-&gt;setup(*data.getExperiments(), iExperimentIndex, *data.getProbeSetsAlternateSort());
<a name="l01635"></a>01635         pChipstream-&gt;run();
<a name="l01636"></a>01636         <span class="keywordflow">if</span> (bAnalysis)
<a name="l01637"></a>01637         {
<a name="l01638"></a>01638             engine.<a class="code" href="classCNAnalysisEngine.html#af2ca81fde28c5d90d4d7a43ee4cbe328" title="Process the experiment.">process</a>(*data.getExperiments()-&gt;getAt(iExperimentIndex), arProbeSetsToProcess, pChipstream-&gt;getProbes());
<a name="l01639"></a>01639             <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;cancer&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;cancer&quot;</span>) == 2))
<a name="l01640"></a>01640             {
<a name="l01641"></a>01641                 engine.<a class="code" href="classCNAnalysisEngine.html#af2ca81fde28c5d90d4d7a43ee4cbe328" title="Process the experiment.">process</a>(*data.getExperiments()-&gt;getAt(iExperimentIndex), arProbeSetsToProcess);
<a name="l01642"></a>01642             }
<a name="l01643"></a>01643             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;log2ratio-text-output&quot;</span>)) {<a class="code" href="classCNCytoEngine.html#a4d2c9b853b543feeaa08b9aac07e4181" title="Ouptut the SNP data in ASCII text format.">writeOutputText</a>(*data.getExperiments()-&gt;getAt(iExperimentIndex), arProbeSetsToProcess);}
<a name="l01644"></a>01644             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;log2ratio-hdf5-output&quot;</span>)) {<a class="code" href="classCNCytoEngine.html#a7162e4a8d2324fc36ef18f66e706a9b5" title="Ouptut the SNP data in HDF5 fformat.">writeOutputHdf5</a>(*data.getExperiments()-&gt;getAt(iExperimentIndex), arProbeSetsToProcess);}
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646         <span class="keywordflow">else</span>
<a name="l01647"></a>01647         {
<a name="l01648"></a>01648             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iIndex = 0; (iIndex &lt; iProbeSetCount); iIndex++)
<a name="l01649"></a>01649             {
<a name="l01650"></a>01650                 <a class="code" href="classCNProbeSet.html" title="A class to store probe set data.">CNProbeSet</a>* pobjProbeSet = data.getProbeSetsAlternateSort()-&gt;getAt(iIndex);
<a name="l01651"></a>01651                 data.getAAlleleEstimates()-&gt;set(iExperimentIndex, iIndex, pobjProbeSet-&gt;getAAlleleSignal());
<a name="l01652"></a>01652                 data.getBAlleleEstimates()-&gt;set(iExperimentIndex, iIndex, pobjProbeSet-&gt;getBAlleleSignal());
<a name="l01653"></a>01653                 data.getGenotypeCalls()-&gt;set(iExperimentIndex, iIndex, pobjProbeSet-&gt;getGenotypeCall());
<a name="l01654"></a>01654             }
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656     }
<a name="l01657"></a>01657     <span class="keyword">delete</span> pChipstream;
<a name="l01658"></a>01658 
<a name="l01659"></a>01659     <span class="keywordflow">if</span> (bAnalysis)
<a name="l01660"></a>01660     {
<a name="l01661"></a>01661         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>))
<a name="l01662"></a>01662         {
<a name="l01663"></a>01663             data.<a class="code" href="classCNLog2RatioData.html#aa2ac281f90626048a718c0deccba50db" title="Dump the QC metrics into the copynumber report file.">dumpCyto2Report</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>));
<a name="l01664"></a>01664         }
<a name="l01665"></a>01665         <span class="keywordflow">else</span>
<a name="l01666"></a>01666         {
<a name="l01667"></a>01667             data.<a class="code" href="classCNLog2RatioData.html#aa2ac281f90626048a718c0deccba50db" title="Dump the QC metrics into the copynumber report file.">dumpCyto2Report</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670     <span class="keywordflow">else</span>
<a name="l01671"></a>01671     {
<a name="l01672"></a>01672         data.<a class="code" href="classCNLog2RatioData.html#aadb1ae253facb3ba6bdf394e4ae2bdaa" title="Calculate the median singal for the log2 ratio model.">calculateMedianSignal</a>(0, iProbeSetCount);
<a name="l01673"></a>01673         data.<a class="code" href="classCNLog2RatioData.html#ac1c03578abe571e213745a085a101815" title="Calculate the median singals for the log2 ratio model.">calculateXYMedianSignal</a>(0, iProbeSetCount);
<a name="l01674"></a>01674         data.<a class="code" href="classCNLog2RatioData.html#a6f09d55e72a487848b95feeb3ec99f8a" title="Calculate the median singals for the log2 ratio model.">calculateMedianSignalsPerGenotype</a>(0, iProbeSetCount);
<a name="l01675"></a>01675 
<a name="l01676"></a>01676         <a class="code" href="classTmpFileFactory.html" title="Allocate temporary filenames and arrange to remove them when done.">TmpFileFactory</a> tempFactory;
<a name="l01677"></a>01677         tempFactory.<a class="code" href="classTmpFileFactory.html#a0c4ac0f09751f79adb32ddd8107e0ae4" title="Sets the directory in which the tmp files will be allocated. ///.">setTmpdir</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l01678"></a>01678         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strReferenceFile = tempFactory.<a class="code" href="classTmpFileFactory.html#a2fbad1f1c46aa89ccfdbb2b549f2ad85" title="Generate a name which does not exist in the filesystem. /// Does NOT remember to delete the filename ...">genFilename_basic</a>( <span class="stringliteral">&quot;CNReferenceNormals_&quot;</span>, <span class="stringliteral">&quot;.a5.tmp&quot;</span>);
<a name="l01679"></a>01679         data.<a class="code" href="classCNLog2RatioData.html#a336f2d8a1870247b2be8e0579b303b4c" title="Write the model file in text format.">writeCyto2ModelFile</a>(strReferenceFile);
<a name="l01680"></a>01680         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;copynumber-reference-file&quot;</span>, strReferenceFile);
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684 <span class="keywordtype">void</span> CNCytoEngine:: loadReferenceHeader(std::string strReferenceFileName)
<a name="l01685"></a>01685 {
<a name="l01686"></a>01686         <span class="keywordflow">try</span>
<a name="l01687"></a>01687         {
<a name="l01688"></a>01688             <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strHeaderLine;
<a name="l01689"></a>01689 
<a name="l01690"></a>01690             <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01691"></a>01691             file5.open(strReferenceFileName, affx::FILE5_OPEN_RO);
<a name="l01692"></a>01692             <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = NULL;
<a name="l01693"></a>01693             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l01694"></a>01694             {
<a name="l01695"></a>01695                 group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l01696"></a>01696             }
<a name="l01697"></a>01697             <span class="keywordflow">else</span>
<a name="l01698"></a>01698             {
<a name="l01699"></a>01699                 group5 = file5.openGroup(<span class="stringliteral">&quot;CopyNumber&quot;</span>, affx::FILE5_OPEN);
<a name="l01700"></a>01700             }
<a name="l01701"></a>01701             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703             <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01704"></a>01704             {
<a name="l01705"></a>01705                 tsv5-&gt;get(0, 0, &amp;strHeaderLine);
<a name="l01706"></a>01706                 m_vCNReferenceHeader.push_back(strHeaderLine);
<a name="l01707"></a>01707             }
<a name="l01708"></a>01708             tsv5-&gt;close();
<a name="l01709"></a>01709             <span class="keyword">delete</span> tsv5;
<a name="l01710"></a>01710 
<a name="l01711"></a>01711             group5-&gt;close();
<a name="l01712"></a>01712             <span class="keyword">delete</span> group5;
<a name="l01713"></a>01713             file5.close();
<a name="l01714"></a>01714         }
<a name="l01715"></a>01715         <span class="keywordflow">catch</span>(...)
<a name="l01716"></a>01716         {
<a name="l01717"></a>01717                 <span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;Cannot open file: &quot;</span> + strReferenceFileName));
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719 }
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 
<a name="l01722"></a>01722 
<a name="l01723"></a>01723 <span class="comment"></span>
<a name="l01724"></a>01724 <span class="comment">/**</span>
<a name="l01725"></a>01725 <span class="comment">* @brief Call the geno-qc engine</span>
<a name="l01726"></a>01726 <span class="comment">*/</span>
<a name="l01727"></a><a class="code" href="classCNCytoEngine.html#a7b2d46809ff3497b68c8003a22bf990e">01727</a> <span class="keywordtype">void</span> <a class="code" href="classCNCytoEngine.html#a7b2d46809ff3497b68c8003a22bf990e" title="Call the geno-qc engine.">CNCytoEngine::callGenoQCEngine</a>()
<a name="l01728"></a>01728 {
<a name="l01729"></a>01729     <a class="code" href="classGenoQC.html" title="Object for generating chip qc statistics from a Encapsulates all the work of generating chip qc stats...">GenoQC</a> engine;
<a name="l01730"></a>01730     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;force&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;force&quot;</span>));
<a name="l01731"></a>01731     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>));
<a name="l01732"></a>01732     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;command-line&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;command-line&quot;</span>));
<a name="l01733"></a>01733     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;program-cvs-id&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-cvs-id&quot;</span>));
<a name="l01734"></a>01734     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;program-name&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-name&quot;</span>));
<a name="l01735"></a>01735     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;program-company&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-company&quot;</span>));
<a name="l01736"></a>01736     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;program-version&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-version&quot;</span>));
<a name="l01737"></a>01737     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;version-to-report&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-version&quot;</span>) + <span class="stringliteral">&quot; &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-name&quot;</span>));
<a name="l01738"></a>01738     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>));
<a name="l01739"></a>01739     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>));
<a name="l01740"></a>01740     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes-filtered&quot;</span>));
<a name="l01741"></a>01741     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes-filtered&quot;</span>));
<a name="l01742"></a>01742     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;qca-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qca-file&quot;</span>));
<a name="l01743"></a>01743     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;qcc-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qcc-file&quot;</span>));
<a name="l01744"></a>01744     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;out-file&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;geno-qc-file&quot;</span>));
<a name="l01745"></a>01745     std::vector&lt;std::string&gt; cels = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l01746"></a>01746     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>, cels);
<a name="l01747"></a>01747     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;female-thresh&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;female-gender-ratio-cutoff&quot;</span>));
<a name="l01748"></a>01748     engine.<a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;male-thresh&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;male-gender-ratio-cutoff&quot;</span>));
<a name="l01749"></a>01749     engine.<a class="code" href="classBaseEngine.html#aa6314624576726733233a660d2ab93db" title="Run the engine -- entry point to run the engine Will call Verbose::out() and Err::errAbort().">run</a>();
<a name="l01750"></a>01750 }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752 <span class="comment">// This method is called by ChAS without having called checkOptions.</span>
<a name="l01753"></a>01753 <span class="comment">// In short, best not to refer to Engine options/state in this method</span>
<a name="l01754"></a>01754 <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> CNCytoEngine::getAnnotationParameter(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strFileName, <span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strParameterName)
<a name="l01755"></a>01755 {
<a name="l01756"></a>01756     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strParameterValue;
<a name="l01757"></a>01757     <span class="keywordflow">if</span> (affx::File5_File::isHdf5file(strFileName))
<a name="l01758"></a>01758     {
<a name="l01759"></a>01759         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> str;
<a name="l01760"></a>01760         <span class="keywordflow">try</span>
<a name="l01761"></a>01761         {
<a name="l01762"></a>01762             <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01763"></a>01763             file5.open(strFileName, affx::FILE5_OPEN_RO);
<a name="l01764"></a>01764             <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5=NULL;
<a name="l01765"></a>01765 
<a name="l01766"></a>01766             <span class="keywordflow">if</span> (isValidReferenceFile(strFileName))
<a name="l01767"></a>01767             {
<a name="l01768"></a>01768                 <span class="keywordflow">if</span>(isCyto2Reference(strFileName))
<a name="l01769"></a>01769                 {
<a name="l01770"></a>01770                     group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l01771"></a>01771                 }
<a name="l01772"></a>01772                 <span class="keywordflow">else</span>
<a name="l01773"></a>01773                 {
<a name="l01774"></a>01774                     group5 = file5.openGroup(<span class="stringliteral">&quot;CopyNumber&quot;</span>, affx::FILE5_OPEN);
<a name="l01775"></a>01775                 }
<a name="l01776"></a>01776             }
<a name="l01777"></a>01777             <span class="keywordflow">else</span>
<a name="l01778"></a>01778             { 
<a name="l01779"></a>01779                    <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;An attempt was made to extract a parameter value from the CNReference file &quot;</span> + strFileName + <span class="stringliteral">&quot;.  The file is not a valid reference file.&quot;</span>); 
<a name="l01780"></a>01780             }
<a name="l01781"></a>01781 
<a name="l01782"></a>01782             <span class="keywordflow">if</span> (group5 != NULL)
<a name="l01783"></a>01783             {
<a name="l01784"></a>01784             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01785"></a>01785             <span class="keywordflow">if</span> (tsv5 != NULL)
<a name="l01786"></a>01786             {
<a name="l01787"></a>01787             <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01788"></a>01788             {
<a name="l01789"></a>01789                 tsv5-&gt;get(0, 0, &amp;str);
<a name="l01790"></a>01790                 <span class="keywordtype">int</span> iIndex = str.indexOf(<span class="stringliteral">&quot;=&quot;</span>);
<a name="l01791"></a>01791                 <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%&quot;</span> + strParameterName + <span class="stringliteral">&quot;=&quot;</span>))
<a name="l01792"></a>01792                 {
<a name="l01793"></a>01793                         strParameterValue = str.substring(iIndex + 1);
<a name="l01794"></a>01794                 }
<a name="l01795"></a>01795             }
<a name="l01796"></a>01796             tsv5-&gt;close();
<a name="l01797"></a>01797             <span class="keyword">delete</span> tsv5;
<a name="l01798"></a>01798             }
<a name="l01799"></a>01799             group5-&gt;close();
<a name="l01800"></a>01800             <span class="keyword">delete</span> group5;
<a name="l01801"></a>01801             }
<a name="l01802"></a>01802             file5.close();
<a name="l01803"></a>01803         } <span class="keywordflow">catch</span>(...) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;}
<a name="l01804"></a>01804     }
<a name="l01805"></a>01805     <span class="keywordflow">return</span> strParameterValue;
<a name="l01806"></a>01806 }
<a name="l01807"></a>01807 <span class="comment"></span>
<a name="l01808"></a>01808 <span class="comment">/**</span>
<a name="l01809"></a>01809 <span class="comment"> * @brief Return the annotation file names</span>
<a name="l01810"></a>01810 <span class="comment"> * @param const AffxString&amp; - The name of the reference file</span>
<a name="l01811"></a>01811 <span class="comment"> * @param AffxString&amp; - The name of the snp annotation file to return</span>
<a name="l01812"></a>01812 <span class="comment"> * @param AffxString&amp; - The name of the cn annotation file to return</span>
<a name="l01813"></a>01813 <span class="comment"> * @return bool - true if successful</span>
<a name="l01814"></a>01814 <span class="comment"> */</span>
<a name="l01815"></a><a class="code" href="classCNCytoEngine.html#a00093f795f6818963406c14e66ba1b67">01815</a> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> <a class="code" href="classCNCytoEngine.html#a00093f795f6818963406c14e66ba1b67" title="Return the annotation file names.">CNCytoEngine::getAnnotationFileName</a>(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strFileName)
<a name="l01816"></a>01816 {
<a name="l01817"></a>01817     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strAnnotationFileName;
<a name="l01818"></a>01818     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strOldAnnotationFileName;
<a name="l01819"></a>01819     <span class="keywordflow">if</span> (affx::File5_File::isHdf5file(strFileName))
<a name="l01820"></a>01820     {
<a name="l01821"></a>01821         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> str;
<a name="l01822"></a>01822         <span class="keywordflow">try</span>
<a name="l01823"></a>01823         {
<a name="l01824"></a>01824             <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01825"></a>01825             file5.open(strFileName, affx::FILE5_OPEN_RO);
<a name="l01826"></a>01826             <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = NULL;
<a name="l01827"></a>01827             <span class="keywordflow">if</span> (isCyto2Reference(strFileName))
<a name="l01828"></a>01828             {
<a name="l01829"></a>01829                 group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l01830"></a>01830             }
<a name="l01831"></a>01831             <span class="keywordflow">else</span>
<a name="l01832"></a>01832             {
<a name="l01833"></a>01833                 group5 = file5.openGroup(<span class="stringliteral">&quot;CopyNumber&quot;</span>, affx::FILE5_OPEN);
<a name="l01834"></a>01834             }
<a name="l01835"></a>01835             <span class="keywordflow">if</span> (group5 != NULL)
<a name="l01836"></a>01836             {
<a name="l01837"></a>01837             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01838"></a>01838             <span class="keywordflow">if</span> (tsv5 != NULL)
<a name="l01839"></a>01839             {
<a name="l01840"></a>01840             <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01841"></a>01841             {
<a name="l01842"></a>01842                 tsv5-&gt;get(0, 0, &amp;str);
<a name="l01843"></a>01843                 <span class="keywordtype">int</span> iIndex = str.indexOf(<span class="stringliteral">&quot;=&quot;</span>);<span class="comment"></span>
<a name="l01844"></a>01844 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01845"></a>01845 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-option-annotation-file=&quot;</span>)) {strAnnotationFileName = str.substring(iIndex + 1);}
<a name="l01846"></a>01846                 <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-annotation-file=&quot;</span>)) {strAnnotationFileName = str.substring(iIndex + 1);}
<a name="l01847"></a>01847                 <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-netaffx-snp-annotation-file=&quot;</span>)) {strOldAnnotationFileName = str.substring(iIndex + 1);}
<a name="l01848"></a>01848             }
<a name="l01849"></a>01849             tsv5-&gt;close();
<a name="l01850"></a>01850             <span class="keyword">delete</span> tsv5;
<a name="l01851"></a>01851             }
<a name="l01852"></a>01852             group5-&gt;close();
<a name="l01853"></a>01853             <span class="keyword">delete</span> group5;
<a name="l01854"></a>01854             }
<a name="l01855"></a>01855             file5.close();
<a name="l01856"></a>01856         } <span class="keywordflow">catch</span>(...) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;}
<a name="l01857"></a>01857     }
<a name="l01858"></a>01858     <span class="keywordflow">if</span> ((strAnnotationFileName == <span class="stringliteral">&quot;&quot;</span>) &amp;&amp; (strOldAnnotationFileName != <span class="stringliteral">&quot;&quot;</span>))
<a name="l01859"></a>01859     {
<a name="l01860"></a>01860         strAnnotationFileName = strOldAnnotationFileName;
<a name="l01861"></a>01861     }
<a name="l01862"></a>01862     <span class="keywordflow">return</span> strAnnotationFileName;
<a name="l01863"></a>01863 }
<a name="l01864"></a>01864 <span class="comment"></span>
<a name="l01865"></a>01865 <span class="comment">/**</span>
<a name="l01866"></a>01866 <span class="comment"> * @brief Return the normalization types</span>
<a name="l01867"></a>01867 <span class="comment"> * @param const AffxString&amp; - The name of the reference file</span>
<a name="l01868"></a>01868 <span class="comment"> * @param int&amp; - The normalization type</span>
<a name="l01869"></a>01869 <span class="comment"> * @param bool&amp; - The adapter normalization</span>
<a name="l01870"></a>01870 <span class="comment"> * @param bool&amp; - The marker normalization</span>
<a name="l01871"></a>01871 <span class="comment"> * @param int&amp; - The number of samples</span>
<a name="l01872"></a>01872 <span class="comment"> * @return bool - true if successful</span>
<a name="l01873"></a>01873 <span class="comment"> */</span>
<a name="l01874"></a><a class="code" href="classCNCytoEngine.html#a49f6b27ac1f1ce3eb78a57f14e75bfec">01874</a> <span class="keywordtype">bool</span> <a class="code" href="classCNCytoEngine.html#a49f6b27ac1f1ce3eb78a57f14e75bfec" title="Return the normalization types.">CNCytoEngine::getNormalizationTypes</a>(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strFileName, <span class="keywordtype">int</span>&amp; iNormalizationType, <span class="keywordtype">bool</span>&amp; bAdapterNormalization, <span class="keywordtype">int</span>&amp; iSampleCount)
<a name="l01875"></a>01875 {
<a name="l01876"></a>01876     <span class="keywordtype">bool</span> bSuccessful = <span class="keyword">false</span>;
<a name="l01877"></a>01877     <a class="code" href="classAffxByteArray.html" title="A class for managing large byte arrays.">AffxByteArray</a> ba;
<a name="l01878"></a>01878     <span class="keywordflow">if</span> (affx::File5_File::isHdf5file(strFileName))
<a name="l01879"></a>01879     {
<a name="l01880"></a>01880         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> str;
<a name="l01881"></a>01881         <span class="keywordflow">try</span>
<a name="l01882"></a>01882         {
<a name="l01883"></a>01883             <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01884"></a>01884             file5.open(strFileName, affx::FILE5_OPEN_RO);
<a name="l01885"></a>01885             <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = NULL;
<a name="l01886"></a>01886             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l01887"></a>01887             {
<a name="l01888"></a>01888                 group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l01889"></a>01889             }
<a name="l01890"></a>01890             <span class="keywordflow">else</span>
<a name="l01891"></a>01891             {
<a name="l01892"></a>01892                 group5 = file5.openGroup(<span class="stringliteral">&quot;CopyNumber&quot;</span>, affx::FILE5_OPEN);
<a name="l01893"></a>01893             }
<a name="l01894"></a>01894             <span class="keywordflow">if</span> (group5 != NULL)
<a name="l01895"></a>01895             {
<a name="l01896"></a>01896             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01897"></a>01897             <span class="keywordflow">if</span> (tsv5 != NULL)
<a name="l01898"></a>01898             {
<a name="l01899"></a>01899             <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01900"></a>01900             {
<a name="l01901"></a>01901                 tsv5-&gt;get(0, 0, &amp;str);
<a name="l01902"></a>01902                 <span class="keywordtype">int</span> iIndex = str.indexOf(<span class="stringliteral">&quot;=&quot;</span>);
<a name="l01903"></a>01903 <span class="comment"></span>
<a name="l01904"></a>01904 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01905"></a>01905 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-option-normalization-type=&quot;</span>))
<a name="l01906"></a>01906                 {
<a name="l01907"></a>01907                     iNormalizationType =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));
<a name="l01908"></a>01908                 }<span class="comment"></span>
<a name="l01909"></a>01909 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01910"></a>01910 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-state-sample-count=&quot;</span>))
<a name="l01911"></a>01911                 {
<a name="l01912"></a>01912                     iSampleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));
<a name="l01913"></a>01913                 }<span class="comment"></span>
<a name="l01914"></a>01914 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01915"></a>01915 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-option-adapter-type-normalization=&quot;</span>))
<a name="l01916"></a>01916                 {
<a name="l01917"></a>01917                     ba.assign(str.substring(iIndex + 1));
<a name="l01918"></a>01918                     bAdapterNormalization = ba.parsebool();
<a name="l01919"></a>01919                 }
<a name="l01920"></a>01920 <span class="comment"></span>
<a name="l01921"></a>01921 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l01922"></a>01922 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-normalization-type=&quot;</span>))
<a name="l01923"></a>01923                 {
<a name="l01924"></a>01924                     iNormalizationType =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));
<a name="l01925"></a>01925                 }<span class="comment"></span>
<a name="l01926"></a>01926 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l01927"></a>01927 <span class="comment"></span>                <span class="keywordflow">if</span> ((str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-celFileCount=&quot;</span>)) ||
<a name="l01928"></a>01928                     (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-sample-count=&quot;</span>)) )
<a name="l01929"></a>01929                 {
<a name="l01930"></a>01930                     iSampleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));
<a name="l01931"></a>01931                 }<span class="comment"></span>
<a name="l01932"></a>01932 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l01933"></a>01933 <span class="comment"></span>                <span class="keywordflow">if</span> ((str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-adapter-normalization=&quot;</span>)) ||
<a name="l01934"></a>01934                     (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-adapter-type-normalization=&quot;</span>)))
<a name="l01935"></a>01935                 {
<a name="l01936"></a>01936                     ba.assign(str.substring(iIndex + 1));
<a name="l01937"></a>01937                     bAdapterNormalization = ba.parsebool();
<a name="l01938"></a>01938                 }
<a name="l01939"></a>01939             }
<a name="l01940"></a>01940             tsv5-&gt;close();
<a name="l01941"></a>01941             <span class="keyword">delete</span> tsv5;
<a name="l01942"></a>01942             }
<a name="l01943"></a>01943             group5-&gt;close();
<a name="l01944"></a>01944             <span class="keyword">delete</span> group5;
<a name="l01945"></a>01945             }
<a name="l01946"></a>01946             file5.close();
<a name="l01947"></a>01947             bSuccessful = <span class="keyword">true</span>;
<a name="l01948"></a>01948         } <span class="keywordflow">catch</span>(...) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950     <span class="keywordflow">return</span> bSuccessful;
<a name="l01951"></a>01951 }
<a name="l01952"></a>01952 <span class="comment"></span>
<a name="l01953"></a>01953 <span class="comment">/**</span>
<a name="l01954"></a>01954 <span class="comment"> * @brief Return the reference gender counts</span>
<a name="l01955"></a>01955 <span class="comment"> * @param const AffxString&amp; - The name of the reference file</span>
<a name="l01956"></a>01956 <span class="comment"> * @param int&amp; - The reference male count</span>
<a name="l01957"></a>01957 <span class="comment"> * @param int&amp; - The reference female count</span>
<a name="l01958"></a>01958 <span class="comment"> * @param int&amp; - The reference unknown gender count</span>
<a name="l01959"></a>01959 <span class="comment"> * @return bool - true if successful</span>
<a name="l01960"></a>01960 <span class="comment"> */</span>
<a name="l01961"></a><a class="code" href="classCNCytoEngine.html#a3331607930ac293781fb924dc033b7f8">01961</a> <span class="keywordtype">bool</span> <a class="code" href="classCNCytoEngine.html#a3331607930ac293781fb924dc033b7f8" title="Return the reference gender counts.">CNCytoEngine::getReferenceGenderCounts</a>(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strFileName, <span class="keywordtype">int</span>&amp; iReferenceMaleCount, <span class="keywordtype">int</span>&amp; iReferenceFemaleCount, <span class="keywordtype">int</span>&amp; iReferenceUnknownCount)
<a name="l01962"></a>01962 {
<a name="l01963"></a>01963     iReferenceMaleCount = -1;
<a name="l01964"></a>01964     iReferenceFemaleCount = -1;
<a name="l01965"></a>01965     iReferenceUnknownCount = -1;
<a name="l01966"></a>01966     <span class="keywordtype">bool</span> bSuccessful = <span class="keyword">false</span>;
<a name="l01967"></a>01967     <span class="keywordflow">if</span> (affx::File5_File::isHdf5file(strFileName))
<a name="l01968"></a>01968     {
<a name="l01969"></a>01969         <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> str;
<a name="l01970"></a>01970         <span class="keywordflow">try</span>
<a name="l01971"></a>01971         {
<a name="l01972"></a>01972             <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l01973"></a>01973             file5.open(strFileName, affx::FILE5_OPEN_RO);
<a name="l01974"></a>01974             <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = NULL;
<a name="l01975"></a>01975             <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l01976"></a>01976             {
<a name="l01977"></a>01977                 group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l01978"></a>01978             }
<a name="l01979"></a>01979             <span class="keywordflow">else</span>
<a name="l01980"></a>01980             {
<a name="l01981"></a>01981                 group5 = file5.openGroup(<span class="stringliteral">&quot;CopyNumber&quot;</span>, affx::FILE5_OPEN);
<a name="l01982"></a>01982             }
<a name="l01983"></a>01983             <span class="keywordflow">if</span> (group5 != NULL)
<a name="l01984"></a>01984             {
<a name="l01985"></a>01985             <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;Parameters&quot;</span>, affx::FILE5_OPEN);
<a name="l01986"></a>01986             <span class="keywordflow">if</span> (tsv5 != NULL)
<a name="l01987"></a>01987             {
<a name="l01988"></a>01988             <span class="keywordflow">while</span> (tsv5-&gt;nextLine() == affx::FILE5_OK)
<a name="l01989"></a>01989             {
<a name="l01990"></a>01990                 tsv5-&gt;get(0, 0, &amp;str);
<a name="l01991"></a>01991                 <span class="keywordtype">int</span> iIndex = str.indexOf(<span class="stringliteral">&quot;=&quot;</span>);
<a name="l01992"></a>01992 <span class="comment"></span>
<a name="l01993"></a>01993 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01994"></a>01994 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-male-sample-count=&quot;</span>)) {iReferenceMaleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}<span class="comment"></span>
<a name="l01995"></a>01995 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01996"></a>01996 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-female-sample-count=&quot;</span>)) {iReferenceFemaleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}<span class="comment"></span>
<a name="l01997"></a>01997 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons, favoring state over option?</span>
<a name="l01998"></a>01998 <span class="comment"></span>                <span class="keywordflow">if</span> (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-unknown-sample-count=&quot;</span>)) {iReferenceUnknownCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 <span class="comment"></span>
<a name="l02001"></a>02001 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l02002"></a>02002 <span class="comment"></span>                <span class="keywordflow">if</span> ((str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-ReferenceMaleCount=&quot;</span>)) || (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-male-sample-count=&quot;</span>))) {iReferenceMaleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}<span class="comment"></span>
<a name="l02003"></a>02003 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l02004"></a>02004 <span class="comment"></span>                <span class="keywordflow">if</span> ((str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-ReferenceFemaleCount=&quot;</span>)) || (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-female-sample-count=&quot;</span>))) {iReferenceFemaleCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}<span class="comment"></span>
<a name="l02005"></a>02005 <span class="comment">                ///@todo AW: should this be &quot;state&quot; not &quot;option&quot;? Do we need to handle both for compatability reasons?</span>
<a name="l02006"></a>02006 <span class="comment"></span>                <span class="keywordflow">if</span> ((str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-opt-ReferenceUnknownCount=&quot;</span>)) || (str.startsWith(<span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-state-reference-unknown-sample-count=&quot;</span>))) {iReferenceUnknownCount =<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int."> ::getInt</a>(str.substring(iIndex + 1));}
<a name="l02007"></a>02007             }
<a name="l02008"></a>02008             tsv5-&gt;close();
<a name="l02009"></a>02009             <span class="keyword">delete</span> tsv5;
<a name="l02010"></a>02010             }
<a name="l02011"></a>02011             group5-&gt;close();
<a name="l02012"></a>02012             <span class="keyword">delete</span> group5;
<a name="l02013"></a>02013             }
<a name="l02014"></a>02014             file5.close();
<a name="l02015"></a>02015             <span class="keywordflow">if</span> (iReferenceMaleCount != -1) {bSuccessful = <span class="keyword">true</span>;}
<a name="l02016"></a>02016         } <span class="keywordflow">catch</span>(...) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l02017"></a>02017     }
<a name="l02018"></a>02018     <span class="keywordflow">return</span> bSuccessful;
<a name="l02019"></a>02019 }
<a name="l02020"></a>02020 <span class="comment"></span>
<a name="l02021"></a>02021 <span class="comment">/**</span>
<a name="l02022"></a>02022 <span class="comment"> * @brief Calculate the genders of the specified samples (cel files)</span>
<a name="l02023"></a>02023 <span class="comment"> */</span>
<a name="l02024"></a><a class="code" href="classCNCytoEngine.html#a75edd342e8dd57109c0b74e048a8ef1f">02024</a> <span class="keywordtype">void</span> <a class="code" href="classCNCytoEngine.html#a75edd342e8dd57109c0b74e048a8ef1f" title="Calculate the genders of the specified samples (cel files).">CNCytoEngine::calculateGenders</a>(<a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>&amp; data)
<a name="l02025"></a>02025 {
<a name="l02026"></a>02026     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: Performing a preliminary gender check.&quot;</span>);
<a name="l02027"></a>02027     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l02028"></a>02028     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;female-gender-ratio-cutoff\t&quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;female-gender-ratio-cutoff&quot;</span>));
<a name="l02029"></a>02029     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;male-gender-ratio-cutoff\t&quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;male-gender-ratio-cutoff&quot;</span>));
<a name="l02030"></a>02030     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l02031"></a>02031     std::vector&lt;std::string&gt; celFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l02032"></a>02032 
<a name="l02033"></a>02033     std::vector&lt; std::vector&lt;probeid_t&gt; &gt; chrXProbes;
<a name="l02034"></a>02034     std::vector&lt; std::vector&lt;probeid_t&gt; &gt; chrYProbes;
<a name="l02035"></a>02035     loadProbes(data, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>), <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>), chrXProbes, chrYProbes);
<a name="l02036"></a>02036     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrX-probes-filtered&quot;</span>, saveProbes(<span class="stringliteral">&quot;chrX-probes&quot;</span>, chrXProbes));
<a name="l02037"></a>02037     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrY-probes-filtered&quot;</span>, saveProbes(<span class="stringliteral">&quot;chrY-probes&quot;</span>, chrYProbes));
<a name="l02038"></a>02038     <a class="code" href="classCnProbeGenderCelListener.html" title="Class for determining gender from a cel set of cel files.">CnProbeGenderCelListener</a> objGenderCaller(chrXProbes, chrYProbes, <a class="code" href="classOptions.html#a8b119de0194389e5e91d09520df211d9" title="Get the integer value of an option.">getOptDouble</a>(<span class="stringliteral">&quot;female-gender-ratio-cutoff&quot;</span>), <a class="code" href="classOptions.html#a8b119de0194389e5e91d09520df211d9" title="Get the integer value of an option.">getOptDouble</a>(<span class="stringliteral">&quot;male-gender-ratio-cutoff&quot;</span>));
<a name="l02039"></a>02039     <a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html">affymetrix_fusion_io::FusionCELData</a> cel;
<a name="l02040"></a>02040     <span class="keywordtype">int</span> iUnknownCount = 0;
<a name="l02041"></a>02041     <span class="keywordtype">int</span> iMaleCount = 0;
<a name="l02042"></a>02042     <span class="keywordtype">int</span> iFemaleCount = 0;
<a name="l02043"></a>02043     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiCelFileIndex = 0; (uiCelFileIndex &lt; celFiles.size()); uiCelFileIndex++)
<a name="l02044"></a>02044     {
<a name="l02045"></a>02045         cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#af43c5c7a95f9f535883c1ddda0bea057">SetFileName</a>(celFiles[uiCelFileIndex].c_str());
<a name="l02046"></a>02046         <span class="keywordflow">if</span> (!cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#afb44820c729a78caa986e598716c802c">Read</a>()) {error(<span class="stringliteral">&quot;Cannot read cel file for gender calling: &quot;</span> + celFiles[uiCelFileIndex]);}
<a name="l02047"></a>02047 
<a name="l02048"></a>02048         <span class="comment">// Check for bad cel files.</span>
<a name="l02049"></a>02049         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiRowCount = cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#a027ef23b1537af387ac91d2e81496e01">GetRows</a>();
<a name="l02050"></a>02050         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiColCount = cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#a9036f2c16066af20c4058b993eb83fbf">GetCols</a>();
<a name="l02051"></a>02051         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probe-rows-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(uiRowCount));
<a name="l02052"></a>02052         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probe-columns-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(uiColCount));
<a name="l02053"></a>02053         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiCount = uiRowCount * uiColCount;
<a name="l02054"></a>02054         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probe-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(uiCount));
<a name="l02055"></a>02055         <span class="keywordtype">float</span> fMin = 1000000;
<a name="l02056"></a>02056         <span class="keywordtype">float</span> fMax = 0;
<a name="l02057"></a>02057                 <span class="keywordtype">int</span> maxWarnings = 3;
<a name="l02058"></a>02058         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iProbeIndex = 0; iProbeIndex &lt; uiCount; iProbeIndex++)
<a name="l02059"></a>02059         {
<a name="l02060"></a>02060             <span class="keywordtype">float</span> fIntensity = cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#a76d2432b4075dbb9f00a1cf306a3a614">GetIntensity</a>(iProbeIndex);
<a name="l02061"></a>02061             <span class="keywordflow">if</span> (fIntensity == 0)
<a name="l02062"></a>02062             {
<a name="l02063"></a>02063                           <span class="keywordflow">if</span>(maxWarnings &gt; 0)
<a name="l02064"></a>02064                             {
<a name="l02065"></a>02065                               <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;CEL file contains zero intensity values:\t&quot;</span> + celFiles[uiCelFileIndex]);
<a name="l02066"></a>02066                               maxWarnings--;
<a name="l02067"></a>02067                             }
<a name="l02068"></a>02068                           <span class="keywordflow">continue</span>;
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fIntensity &lt; 0)
<a name="l02071"></a>02071             {
<a name="l02072"></a>02072                 <span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;CEL file contains negative intensity values:\t&quot;</span> + celFiles[uiCelFileIndex]));
<a name="l02073"></a>02073             }
<a name="l02074"></a>02074             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">double</span>)fIntensity != (<span class="keywordtype">double</span>)fIntensity)
<a name="l02075"></a>02075             {
<a name="l02076"></a>02076                 <span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;CEL file contains NaN intensity values:\t&quot;</span> + celFiles[uiCelFileIndex]));
<a name="l02077"></a>02077             }
<a name="l02078"></a>02078             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classUtil.html#a66b3f27deb315aab108936d0830c6991" title="Wrapper for different version of isnan() on different systems.">Util::isFinite</a>(fIntensity))
<a name="l02079"></a>02079             {
<a name="l02080"></a>02080                 <span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;CEL file contains infinite intensity values:\t&quot;</span> + celFiles[uiCelFileIndex]));
<a name="l02081"></a>02081             }
<a name="l02082"></a>02082                      fMin = Min(fMin, fIntensity);
<a name="l02083"></a>02083             fMax = <a class="code" href="affy-base-types_8h.html#a4886a8f966a69949cefc46a6a3468006">Max</a>(fMax, fIntensity);
<a name="l02084"></a>02084         }
<a name="l02085"></a>02085 <span class="comment">//        Verbose::out(1, ::getDouble(fMin, 6) + &quot;\t&quot; + ::getDouble(fMax, 6));</span>
<a name="l02086"></a>02086 
<a name="l02087"></a>02087         objGenderCaller.<a class="code" href="classCnProbeGenderCelListener.html#a26b29708ac9822a17767b68bcf89ba1a" title="Process another cel files worth of data.">newChip</a>(&amp;cel);
<a name="l02088"></a>02088         cel.<a class="code" href="classaffymetrix__fusion__io_1_1FusionCELData.html#ae5e091bf0e0549f45f45ba55221fea31">Close</a>();
<a name="l02089"></a>02089                 
<a name="l02090"></a>02090         data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;setRawIntensityRatioGender(objGenderCaller.<a class="code" href="classCnProbeGenderCelListener.html#a21bdb5903ae5ecb1f8e763369d282a45" title="Get the last gender called.">getLastGender</a>());
<a name="l02091"></a>02091         data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;setRawIntensityRatio(objGenderCaller.getLastRatio());
<a name="l02092"></a>02092         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)))
<a name="l02093"></a>02093         {
<a name="l02094"></a>02094             data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;<a class="code" href="classCNExperiment.html#a65d96e65a2367ddd584d7d88c93b74dc" title="Set the gender for the sample using the affx gender code.">setCNCallGender</a>(objGenderCaller.<a class="code" href="classCnProbeGenderCelListener.html#a21bdb5903ae5ecb1f8e763369d282a45" title="Get the last gender called.">getLastGender</a>());
<a name="l02095"></a>02095             data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;setCNCallGenderRatio(objGenderCaller.getLastRatio());
<a name="l02096"></a>02096         }
<a name="l02097"></a>02097         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;CNCytoEngine::useReference(...)\t&quot;</span> + data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;getExperimentName() + <span class="stringliteral">&quot;\tRawIntensityRatio\t&quot;</span> +<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double."> ::getDouble</a>(data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;getRawIntensityRatio(), 6) + <span class="stringliteral">&quot;\t&quot;</span> + ((data.getExperiments()-&gt;getAt(uiCelFileIndex)-&gt;getRawIntensityRatioGender() == <span class="stringliteral">&quot;male&quot;</span>) ? <span class="stringliteral">&quot;XY&quot;</span> : <span class="stringliteral">&quot;XX&quot;</span>));
<a name="l02098"></a>02098 
<a name="l02099"></a>02099         <span class="keywordtype">float</span> fRatio = objGenderCaller.getLastRatio();
<a name="l02100"></a>02100         <span class="keywordflow">switch</span>(objGenderCaller.<a class="code" href="classCnProbeGenderCelListener.html#a21bdb5903ae5ecb1f8e763369d282a45" title="Get the last gender called.">getLastGender</a>())
<a name="l02101"></a>02101         {
<a name="l02102"></a>02102         <span class="keywordflow">case</span> <a class="code" href="namespaceaffx.html#a1c064510a1a9f30814f840025d73d669afdfe578a9e9044b7b274b736ed341a81" title="Has XY chromosomes.">affx::Male</a>: iMaleCount++; <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Sample &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a3bfc6fcf2404cad091f4bc4433ba4ee3" title="Converts a string with commas into an unsigned int.">getUnsignedInt</a>(uiCelFileIndex + 1) + <span class="stringliteral">&quot;:\t&quot;</span> + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(celFiles[uiCelFileIndex]) + <span class="stringliteral">&quot;\tMale\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(fRatio, 6)); <span class="keywordflow">break</span>;
<a name="l02103"></a>02103         <span class="keywordflow">case</span> <a class="code" href="namespaceaffx.html#a1c064510a1a9f30814f840025d73d669ad5afd116ccd5bf71e27bab31a23fac97" title="Has XX chromosomes.">affx::Female</a>: iFemaleCount++; <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Sample &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a3bfc6fcf2404cad091f4bc4433ba4ee3" title="Converts a string with commas into an unsigned int.">getUnsignedInt</a>(uiCelFileIndex + 1) + <span class="stringliteral">&quot;:\t&quot;</span> + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(celFiles[uiCelFileIndex]) + <span class="stringliteral">&quot;\tFemale\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(fRatio, 6)); <span class="keywordflow">break</span>;
<a name="l02104"></a>02104         <span class="keywordflow">default</span>: iUnknownCount++; <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Sample &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a3bfc6fcf2404cad091f4bc4433ba4ee3" title="Converts a string with commas into an unsigned int.">getUnsignedInt</a>(uiCelFileIndex + 1) + <span class="stringliteral">&quot;:\t&quot;</span> + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(celFiles[uiCelFileIndex]) + <span class="stringliteral">&quot;\tUnknown\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(fRatio, 6));
<a name="l02105"></a>02105         }
<a name="l02106"></a>02106     }
<a name="l02107"></a>02107     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l02108"></a>02108     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: The cel file input contains &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iFemaleCount) + <span class="stringliteral">&quot; female, &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iMaleCount) + <span class="stringliteral">&quot; male, and &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iUnknownCount) + <span class="stringliteral">&quot; unknown genders.&quot;</span>);
<a name="l02109"></a>02109     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;create-reference&quot;</span>))
<a name="l02110"></a>02110     {
<a name="l02111"></a>02111         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-male-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iMaleCount));
<a name="l02112"></a>02112         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-female-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iFemaleCount));
<a name="l02113"></a>02113         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-unknown-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iUnknownCount));
<a name="l02114"></a>02114         <span class="keywordtype">int</span> iSampleCount = iMaleCount + iFemaleCount + iUnknownCount;
<a name="l02115"></a>02115         <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iSampleCount));
<a name="l02116"></a>02116 
<a name="l02117"></a>02117         <span class="keywordflow">if</span> (iSampleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference will be based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-sample-count&quot;</span>) + <span class="stringliteral">&quot; samples.&quot;</span>);}
<a name="l02118"></a>02118         <span class="keywordflow">if</span> (iMaleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-male-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference will be based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-male-sample-count&quot;</span>) + <span class="stringliteral">&quot; male samples.&quot;</span>);}
<a name="l02119"></a>02119         <span class="keywordflow">if</span> (iFemaleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-female-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference will be based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-female-sample-count&quot;</span>) + <span class="stringliteral">&quot; female samples.&quot;</span>);}
<a name="l02120"></a>02120     }
<a name="l02121"></a>02121     <span class="keywordflow">else</span>
<a name="l02122"></a>02122     {
<a name="l02123"></a>02123         <span class="keywordtype">int</span> iReferenceMaleCount = 0;
<a name="l02124"></a>02124         <span class="keywordtype">int</span> iReferenceFemaleCount = 0;
<a name="l02125"></a>02125         <span class="keywordtype">int</span> iReferenceUnknownCount = 0;
<a name="l02126"></a>02126         <span class="keywordflow">if</span> (<a class="code" href="classCNCytoEngine.html#a3331607930ac293781fb924dc033b7f8" title="Return the reference gender counts.">getReferenceGenderCounts</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-file&quot;</span>), iReferenceMaleCount, iReferenceFemaleCount, iReferenceUnknownCount))
<a name="l02127"></a>02127         {
<a name="l02128"></a>02128             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-male-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceMaleCount));
<a name="l02129"></a>02129             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-female-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceFemaleCount));
<a name="l02130"></a>02130             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-unknown-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceUnknownCount));
<a name="l02131"></a>02131             <span class="keywordtype">int</span> iSampleCount = iReferenceMaleCount + iReferenceFemaleCount + iReferenceUnknownCount;
<a name="l02132"></a>02132             <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;reference-sample-count&quot;</span>, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iSampleCount));
<a name="l02133"></a>02133             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;MAJOR PROGRESS UPDATE: The reference input is based on &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceFemaleCount) + <span class="stringliteral">&quot; female, &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceMaleCount) + <span class="stringliteral">&quot; male, and &quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(iReferenceUnknownCount) + <span class="stringliteral">&quot; unknown genders.&quot;</span>);
<a name="l02134"></a>02134             <span class="keywordflow">if</span> (iSampleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference is based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-sample-count&quot;</span>) + <span class="stringliteral">&quot; samples.&quot;</span>);}
<a name="l02135"></a>02135             <span class="keywordflow">if</span> (iReferenceMaleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-male-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference is based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-male-sample-count&quot;</span>) + <span class="stringliteral">&quot; male samples.&quot;</span>);}
<a name="l02136"></a>02136             <span class="keywordflow">if</span> (iReferenceFemaleCount &lt; <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;recommended-reference-female-sample-count&quot;</span>)) {<a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;WARNING: Reference is based on less than &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;recommended-reference-female-sample-count&quot;</span>) + <span class="stringliteral">&quot; female samples.&quot;</span>);}
<a name="l02137"></a>02137             <span class="keywordflow">if</span> (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>))
<a name="l02138"></a>02138             {
<a name="l02139"></a>02139                 <span class="keywordflow">if</span> ((iMaleCount &gt; 0) &amp;&amp; (iReferenceMaleCount == 0))
<a name="l02140"></a>02140                 {
<a name="l02141"></a>02141                     error(<span class="stringliteral">&quot;Reference input is not based on any male samples.&quot;</span>);
<a name="l02142"></a>02142                 }
<a name="l02143"></a>02143                 <span class="keywordflow">if</span> ((iFemaleCount &gt; 0) &amp;&amp; (iReferenceFemaleCount == 0))
<a name="l02144"></a>02144                 {
<a name="l02145"></a>02145                     error(<span class="stringliteral">&quot;Reference input is not based on any female samples.&quot;</span>);
<a name="l02146"></a>02146                 }
<a name="l02147"></a>02147             }
<a name="l02148"></a>02148         }
<a name="l02149"></a>02149     }
<a name="l02150"></a>02150 }
<a name="l02151"></a>02151 <span class="comment"></span>
<a name="l02152"></a>02152 <span class="comment">/**</span>
<a name="l02153"></a>02153 <span class="comment"> * @brief Ouptut the SNP data in ASCII text format.</span>
<a name="l02154"></a>02154 <span class="comment"> * @param int - The experiment index to process.</span>
<a name="l02155"></a>02155 <span class="comment"> * @return bool - true if successful</span>
<a name="l02156"></a>02156 <span class="comment"> */</span>
<a name="l02157"></a><a class="code" href="classCNCytoEngine.html#a4d2c9b853b543feeaa08b9aac07e4181">02157</a> <span class="keywordtype">bool</span> <a class="code" href="classCNCytoEngine.html#a4d2c9b853b543feeaa08b9aac07e4181" title="Ouptut the SNP data in ASCII text format.">CNCytoEngine::writeOutputText</a>(<a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>&amp; objExperiment, <a class="code" href="classCNProbeSetArray.html" title="A vector of ProbeSet Pointers.">CNProbeSetArray</a>&amp; vProbeSets)
<a name="l02158"></a>02158 {
<a name="l02159"></a>02159     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3, <span class="stringliteral">&quot;CNCytoEngine::writeOutputText&quot;</span>);
<a name="l02160"></a>02160     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strFileName;
<a name="l02161"></a>02161     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l02162"></a>02162     {
<a name="l02163"></a>02163       strFileName = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>)+<span class="stringliteral">&quot;.&quot;</span>+objExperiment.getExperimentName()+<span class="stringliteral">&quot;.txt&quot;</span>);
<a name="l02164"></a>02164     }
<a name="l02165"></a>02165     <span class="keywordflow">else</span>
<a name="l02166"></a>02166     {
<a name="l02167"></a>02167       strFileName = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),objExperiment.getExperimentName()+<span class="stringliteral">&quot;.txt&quot;</span>);
<a name="l02168"></a>02168     }
<a name="l02169"></a>02169     <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a> tsv;
<a name="l02170"></a>02170     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order. ///.">addHeader</a>(<span class="stringliteral">&quot;guid&quot;</span>, <a class="code" href="classaffxutil_1_1Guid.html#a2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>());
<a name="l02171"></a>02171 
<a name="l02172"></a>02172 
<a name="l02173"></a>02173     <span class="comment">// dump options.</span>
<a name="l02174"></a>02174     std::vector&lt;std::string&gt; optionNames;
<a name="l02175"></a>02175     getOptionNames(optionNames,1);
<a name="l02176"></a>02176     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; optionNames.size(); i++) {
<a name="l02177"></a>02177       std::vector&lt;std::string&gt; vals = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(optionNames[i],1);
<a name="l02178"></a>02178       <span class="keywordflow">if</span> (vals.size() &gt; 1) {
<a name="l02179"></a>02179         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt; vals.size(); j++) {
<a name="l02180"></a>02180           tsv.<a class="code" href="classaffx_1_1TsvFile.html#a11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order. ///.">addHeader</a>(<span class="stringliteral">&quot;affymetrix-algorithm-param-apt-&quot;</span> + optionNames[i] + <span class="stringliteral">&quot;-&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(j+1), vals[j]);
<a name="l02181"></a>02181         }
<a name="l02182"></a>02182       }
<a name="l02183"></a>02183       <span class="keywordflow">else</span> {
<a name="l02184"></a>02184         tsv.<a class="code" href="classaffx_1_1TsvFile.html#a11a4bb7b3c796316bc5b758f42229557" title="Add a key-value to the headers plus its sort order. ///.">addHeader</a>(<span class="stringliteral">&quot;affymetrix-algorithm-param-apt-&quot;</span> + optionNames[i],  <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(optionNames[i],1));
<a name="l02185"></a>02185       }
<a name="l02186"></a>02186     }
<a name="l02187"></a>02187     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a1903489904b4e2f8f2a262b8f10cdb0e" title="Set the options up for &amp;quot;tsv&amp;quot; format and write the tsv-v1 header ///.">writeTsv_v1</a>(strFileName);
<a name="l02188"></a>02188     
<a name="l02189"></a>02189     <span class="comment">// Normally we don&#39;t have tables concatenated in this fashion.</span>
<a name="l02190"></a>02190     <span class="comment">// There is a header row, record row, header row, records.</span>
<a name="l02191"></a>02191     <span class="comment">// TSV does not support this so just write out the ad hoc lines. </span>
<a name="l02192"></a>02192     std::stringstream lineSStr;
<a name="l02193"></a>02193     lineSStr &lt;&lt; <span class="stringliteral">&quot;experiment\tMadDiffCN\tIqr\tMeanAbsRle\tMedianAutosomeMedian\tGender\tGCCorrectionSize&quot;</span> &lt;&lt; std::endl;
<a name="l02194"></a>02194     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed ///.">write_str</a>(lineSStr.str());
<a name="l02195"></a>02195     lineSStr.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l02196"></a>02196     lineSStr &lt;&lt; objExperiment.getExperimentName() + <span class="stringliteral">&quot;\t&quot;</span> +<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double."> ::getDouble</a>(objExperiment.getMadDiffCN(), 6) + <span class="stringliteral">&quot;\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(objExperiment.getIqr(), 6) + <span class="stringliteral">&quot;\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(objExperiment.getMeanAbsRle(), 6) + <span class="stringliteral">&quot;\t&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(objExperiment.getMedianAutosomeMedian(), 6) + <span class="stringliteral">&quot;\t&quot;</span> + objExperiment.getCNCallGender() + <span class="stringliteral">&quot;\t&quot;</span> +<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double."> ::getDouble</a>(objExperiment.getGCCorrectionMetric(), 6) &lt;&lt; std::endl;
<a name="l02197"></a>02197     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed ///.">write_str</a>(lineSStr.str());
<a name="l02198"></a>02198     lineSStr.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l02199"></a>02199     lineSStr &lt;&lt; <span class="stringliteral">&quot;probeset_id\tChromosome\tPosition\tLog2Ratio\tAllelicDifference\tGenotypeCall\tGenotypeConfidence\tChrXPar1\tChrXPar2&quot;</span> &lt;&lt; std::endl;
<a name="l02200"></a>02200     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a55e3144665df17dedeefcadd28d9201b" title="Write a string to the output stream, quoting if needed ///.">write_str</a>(lineSStr.str());
<a name="l02201"></a>02201 
<a name="l02202"></a>02202     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iProbeSetIndex = 0, iCidx = 0; (iProbeSetIndex &lt; vProbeSets.getCount()); iProbeSetIndex++, iCidx=0) {
<a name="l02203"></a>02203       <a class="code" href="classCNProbeSet.html" title="A class to store probe set data.">CNProbeSet</a>* pobjProbeSet = vProbeSets.getAt(iProbeSetIndex);
<a name="l02204"></a>02204       tsv.set(0, iCidx++, pobjProbeSet-&gt;getProbeSetName());
<a name="l02205"></a>02205       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(pobjProbeSet-&gt;getChromosome()));
<a name="l02206"></a>02206       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>((<span class="keywordtype">int</span>)pobjProbeSet-&gt;getPosition()));
<a name="l02207"></a>02207       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(pobjProbeSet-&gt;getLog2Ratio(), 10));
<a name="l02208"></a>02208       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(pobjProbeSet-&gt;getAllelicDifference(), 10));
<a name="l02209"></a>02209       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>((<span class="keywordtype">int</span>)pobjProbeSet-&gt;getGenotypeCall()));
<a name="l02210"></a>02210       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#a4e40c31006c5b45e47ea0240921b98b2" title="Converts a string with commas into a double.">getDouble</a>(pobjProbeSet-&gt;getGenotypeConfidence(), 10));
<a name="l02211"></a>02211       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>((<span class="keywordtype">int</span>)pobjProbeSet-&gt;isPseudoAutosomalRegion()));
<a name="l02212"></a>02212       tsv.set(0, iCidx++, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l02213"></a>02213       tsv.set(0, iCidx++, ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(pobjProbeSet-&gt;getGCBinIndex()));
<a name="l02214"></a>02214       tsv.<a class="code" href="classaffx_1_1TsvFile.html#a2a459be42bea9ea3f180773370ec0de7" title="Write a level of data to the file. ///.">writeLevel</a>(0);
<a name="l02215"></a>02215     }
<a name="l02216"></a>02216 
<a name="l02217"></a>02217     tsv.<a class="code" href="classaffx_1_1TsvFile.html#a6a397412f48d477d0e87b00f914d06f7" title="Closes the file and clears bindings and other info.">clear</a>();
<a name="l02218"></a>02218     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02219"></a>02219 }
<a name="l02220"></a>02220 <span class="comment"></span>
<a name="l02221"></a>02221 <span class="comment">/**</span>
<a name="l02222"></a>02222 <span class="comment"> * @brief Ouptut the SNP data in HDF5 fformat.</span>
<a name="l02223"></a>02223 <span class="comment"> * @param int - The experiment index to process.</span>
<a name="l02224"></a>02224 <span class="comment"> * @return bool - true if successful</span>
<a name="l02225"></a>02225 <span class="comment"> */</span>
<a name="l02226"></a><a class="code" href="classCNCytoEngine.html#a7162e4a8d2324fc36ef18f66e706a9b5">02226</a> <span class="keywordtype">bool</span> <a class="code" href="classCNCytoEngine.html#a7162e4a8d2324fc36ef18f66e706a9b5" title="Ouptut the SNP data in HDF5 fformat.">CNCytoEngine::writeOutputHdf5</a>(<a class="code" href="classCNExperiment.html" title="A class for storing CNExperiment data.">CNExperiment</a>&amp; objExperiment, <a class="code" href="classCNProbeSetArray.html" title="A vector of ProbeSet Pointers.">CNProbeSetArray</a>&amp; vProbeSets)
<a name="l02227"></a>02227 {
<a name="l02228"></a>02228     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3, <span class="stringliteral">&quot;CNCytoEngine::writeOutputHdf5&quot;</span>);
<a name="l02229"></a>02229     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strFileName;
<a name="l02230"></a>02230     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l02231"></a>02231     {
<a name="l02232"></a>02232       strFileName = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>)+<span class="stringliteral">&quot;.&quot;</span>+objExperiment.getExperimentName()+<span class="stringliteral">&quot;.a5&quot;</span>);
<a name="l02233"></a>02233     }
<a name="l02234"></a>02234     <span class="keywordflow">else</span>
<a name="l02235"></a>02235     {
<a name="l02236"></a>02236       strFileName = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),objExperiment.getExperimentName()+<span class="stringliteral">&quot;.a5&quot;</span>);
<a name="l02237"></a>02237     }
<a name="l02238"></a>02238     <span class="keywordflow">try</span>
<a name="l02239"></a>02239     {
<a name="l02240"></a>02240         <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l02241"></a>02241         file5.open(strFileName, affx::FILE5_REPLACE);
<a name="l02242"></a>02242 
<a name="l02243"></a>02243         <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = file5.openTsv(<span class="stringliteral">&quot;CNLog2Ratio_Parameters&quot;</span>, affx::FILE5_REPLACE);
<a name="l02244"></a>02244         tsv5-&gt;defineColumn(0, 0, <span class="stringliteral">&quot;Parameter&quot;</span>, affx::FILE5_DTYPE_STRING, 1024);
<a name="l02245"></a>02245         tsv5-&gt;set_string(0, 0, <span class="stringliteral">&quot;#%guid=&quot;</span> + <a class="code" href="classaffxutil_1_1Guid.html#a2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>()); tsv5-&gt;writeLevel(0);
<a name="l02246"></a>02246 
<a name="l02247"></a>02247         <span class="comment">// dump options.</span>
<a name="l02248"></a>02248         vector&lt;string&gt; optionNames;
<a name="l02249"></a>02249         getOptionNames(optionNames,1);
<a name="l02250"></a>02250         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; optionNames.size(); i++) {
<a name="l02251"></a>02251             std::vector&lt;std::string&gt; vals = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(optionNames[i],1);
<a name="l02252"></a>02252             <span class="keywordflow">if</span> (vals.size() &gt; 1)
<a name="l02253"></a>02253             {
<a name="l02254"></a>02254                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt; vals.size(); j++)
<a name="l02255"></a>02255                 {
<a name="l02256"></a>02256                     tsv5-&gt;set_string(0, 0, <span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-&quot;</span> + optionNames[i] + <span class="stringliteral">&quot;-&quot;</span> + ::<a class="code" href="AffxConv_8cpp.html#ab7d46fb769602a66d9e19f96e792498d" title="Converts a string with commas into an int.">getInt</a>(j+1) + <span class="stringliteral">&quot;=&quot;</span> + vals[j]); tsv5-&gt;writeLevel(0);
<a name="l02257"></a>02257                 }
<a name="l02258"></a>02258             }
<a name="l02259"></a>02259             <span class="keywordflow">else</span>
<a name="l02260"></a>02260             {
<a name="l02261"></a>02261                 tsv5-&gt;set_string(0, 0, <span class="stringliteral">&quot;#%affymetrix-algorithm-param-apt-&quot;</span> + optionNames[i] + <span class="stringliteral">&quot;=&quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(optionNames[i],1)); tsv5-&gt;writeLevel(0);
<a name="l02262"></a>02262             }
<a name="l02263"></a>02263         }
<a name="l02264"></a>02264 <span class="comment"></span>
<a name="l02265"></a>02265 <span class="comment">        ///@todo aw: should we dump state too?</span>
<a name="l02266"></a>02266 <span class="comment"></span>
<a name="l02267"></a>02267         tsv5-&gt;close();
<a name="l02268"></a>02268         <span class="keyword">delete</span> tsv5;
<a name="l02269"></a>02269 
<a name="l02270"></a>02270         tsv5 = file5.openTsv(<span class="stringliteral">&quot;CNLog2Ratio_Experiments&quot;</span>, affx::FILE5_REPLACE);
<a name="l02271"></a>02271         tsv5-&gt;defineColumn(0, 0, <span class="stringliteral">&quot;experiment&quot;</span>, affx::FILE5_DTYPE_STRING, objExperiment.getExperimentName().length());
<a name="l02272"></a>02272         tsv5-&gt;defineColumn(0, 1, <span class="stringliteral">&quot;MadDiffCN&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02273"></a>02273         tsv5-&gt;defineColumn(0, 2, <span class="stringliteral">&quot;Iqr&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02274"></a>02274         tsv5-&gt;defineColumn(0, 3, <span class="stringliteral">&quot;MeanAbsRle&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02275"></a>02275         tsv5-&gt;defineColumn(0, 4, <span class="stringliteral">&quot;MedianAutosomeMedian&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02276"></a>02276         tsv5-&gt;defineColumn(0, 5, <span class="stringliteral">&quot;Gender&quot;</span>, affx::FILE5_DTYPE_STRING, 20);
<a name="l02277"></a>02277         tsv5-&gt;defineColumn(0, 6, <span class="stringliteral">&quot;GCCorrectionSize&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02278"></a>02278         tsv5-&gt;set_string(0, 0, objExperiment.getExperimentName());
<a name="l02279"></a>02279         tsv5-&gt;set_d(0, 1, objExperiment.getMadDiffCN());
<a name="l02280"></a>02280         tsv5-&gt;set_d(0, 2, objExperiment.getIqr());
<a name="l02281"></a>02281         tsv5-&gt;set_d(0, 3, objExperiment.getMeanAbsRle());
<a name="l02282"></a>02282         tsv5-&gt;set_d(0, 4, objExperiment.getMedianAutosomeMedian());
<a name="l02283"></a>02283         tsv5-&gt;set_string(0, 5, objExperiment.getCNCallGender());
<a name="l02284"></a>02284         tsv5-&gt;set_d(0, 6, objExperiment.getGCCorrectionMetric());
<a name="l02285"></a>02285         tsv5-&gt;writeLevel(0);
<a name="l02286"></a>02286         tsv5-&gt;close();
<a name="l02287"></a>02287         <span class="keyword">delete</span> tsv5;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         <span class="keywordtype">int</span> iMaxProbeSetNameLength = 0;
<a name="l02290"></a>02290         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iProbeSetIndex = 0; (iProbeSetIndex &lt; vProbeSets.getCount()); iProbeSetIndex++)
<a name="l02291"></a>02291         {
<a name="l02292"></a>02292             <a class="code" href="classCNProbeSet.html" title="A class to store probe set data.">CNProbeSet</a>* pobjProbeSet = vProbeSets.getAt(iProbeSetIndex);
<a name="l02293"></a>02293             iMaxProbeSetNameLength = <a class="code" href="affy-base-types_8h.html#a4886a8f966a69949cefc46a6a3468006">Max</a>(iMaxProbeSetNameLength, (<span class="keywordtype">int</span>)pobjProbeSet-&gt;getProbeSetName().length());
<a name="l02294"></a>02294         }
<a name="l02295"></a>02295         tsv5 = file5.openTsv(<span class="stringliteral">&quot;CNLog2Ratio_&quot;</span> + objExperiment.getExperimentName(), affx::FILE5_REPLACE);
<a name="l02296"></a>02296         tsv5-&gt;defineColumn(0, 0, <span class="stringliteral">&quot;probeset_id&quot;</span>, affx::FILE5_DTYPE_STRING, iMaxProbeSetNameLength);
<a name="l02297"></a>02297         tsv5-&gt;defineColumn(0, 1, <span class="stringliteral">&quot;Chromosome&quot;</span>, affx::FILE5_DTYPE_INT, 0);
<a name="l02298"></a>02298         tsv5-&gt;defineColumn(0, 2, <span class="stringliteral">&quot;Position&quot;</span>, affx::FILE5_DTYPE_INT, 0);
<a name="l02299"></a>02299         tsv5-&gt;defineColumn(0, 3, <span class="stringliteral">&quot;Log2Ratio&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02300"></a>02300         tsv5-&gt;defineColumn(0, 4, <span class="stringliteral">&quot;AllelicDifference&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02301"></a>02301         tsv5-&gt;defineColumn(0, 5, <span class="stringliteral">&quot;GenotypeCall&quot;</span>, affx::FILE5_DTYPE_INT, 0);
<a name="l02302"></a>02302         tsv5-&gt;defineColumn(0, 6, <span class="stringliteral">&quot;GenotypeConfidence&quot;</span>, affx::FILE5_DTYPE_DOUBLE, 0);
<a name="l02303"></a>02303         tsv5-&gt;defineColumn(0, 7, <span class="stringliteral">&quot;ChrXPar1&quot;</span>, affx::FILE5_DTYPE_INT, 0);
<a name="l02304"></a>02304         tsv5-&gt;defineColumn(0, 8, <span class="stringliteral">&quot;ChrXPar2&quot;</span>, affx::FILE5_DTYPE_INT, 0);
<a name="l02305"></a>02305         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iProbeSetIndex = 0; (iProbeSetIndex &lt; vProbeSets.getCount()); iProbeSetIndex++)
<a name="l02306"></a>02306         {
<a name="l02307"></a>02307             <a class="code" href="classCNProbeSet.html" title="A class to store probe set data.">CNProbeSet</a>* pobjProbeSet = vProbeSets.getAt(iProbeSetIndex);
<a name="l02308"></a>02308             tsv5-&gt;set_string(0, 0, pobjProbeSet-&gt;getProbeSetName());
<a name="l02309"></a>02309             tsv5-&gt;set_i(0, 1, (<span class="keywordtype">int</span>)pobjProbeSet-&gt;getChromosome());
<a name="l02310"></a>02310             tsv5-&gt;set_i(0, 2, pobjProbeSet-&gt;getPosition());
<a name="l02311"></a>02311             tsv5-&gt;set_d(0, 3, pobjProbeSet-&gt;getLog2Ratio());
<a name="l02312"></a>02312             tsv5-&gt;set_d(0, 4, pobjProbeSet-&gt;getAllelicDifference());
<a name="l02313"></a>02313             tsv5-&gt;set_i(0, 5, (<span class="keywordtype">int</span>)pobjProbeSet-&gt;getGenotypeCall());
<a name="l02314"></a>02314             tsv5-&gt;set_d(0, 6, pobjProbeSet-&gt;getGenotypeConfidence());
<a name="l02315"></a>02315             tsv5-&gt;set_i(0, 7, (pobjProbeSet-&gt;isPseudoAutosomalRegion() ? 1 : 0));
<a name="l02316"></a>02316             tsv5-&gt;set_i(0, 8, 0);
<a name="l02317"></a>02317             tsv5-&gt;writeLevel(0);
<a name="l02318"></a>02318         }
<a name="l02319"></a>02319         tsv5-&gt;close();
<a name="l02320"></a>02320         <span class="keyword">delete</span> tsv5;
<a name="l02321"></a>02321         file5.close();
<a name="l02322"></a>02322     } <span class="keywordflow">catch</span>(...) {<span class="keywordflow">throw</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a>(<span class="stringliteral">&quot;Cannot open file: &quot;</span> + strFileName));}
<a name="l02323"></a>02323     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02324"></a>02324 }
<a name="l02325"></a>02325 <span class="keywordtype">bool</span> CNCytoEngine::isDualNormalizeReference(<span class="keyword">const</span> std::string&amp; strReferenceFileName)
<a name="l02326"></a>02326 {
<a name="l02327"></a>02327     <span class="keywordtype">int</span> i = 0;
<a name="l02328"></a>02328     <span class="keywordtype">int</span> j = 0;
<a name="l02329"></a>02329     <span class="keywordflow">try</span>    {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;CopyNumber&quot;</span>, <span class="stringliteral">&quot;SketchSNP&quot;</span>);}
<a name="l02330"></a>02330     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02331"></a>02331     <span class="keywordflow">try</span>    {j = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;Cyto2&quot;</span>, <span class="stringliteral">&quot;SketchSNP&quot;</span>);}
<a name="l02332"></a>02332     <span class="keywordflow">catch</span> (...) {j = 0;}
<a name="l02333"></a>02333     <span class="keywordflow">return</span> (i &gt; 0 || j &gt; 0);
<a name="l02334"></a>02334 }
<a name="l02335"></a>02335 
<a name="l02336"></a>02336 <span class="keywordtype">bool</span> CNCytoEngine::isCN5Reference(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strReferenceFileName)
<a name="l02337"></a>02337 {
<a name="l02338"></a>02338     <span class="keywordtype">int</span> i = 0;
<a name="l02339"></a>02339     <span class="keywordflow">try</span>    {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;CopyNumber&quot;</span>, <span class="stringliteral">&quot;Reference&quot;</span>);}
<a name="l02340"></a>02340     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02341"></a>02341     <span class="keywordflow">return</span> (i &gt; 0);
<a name="l02342"></a>02342 }
<a name="l02343"></a>02343 
<a name="l02344"></a>02344 <span class="comment">// This method is called by ChAS without having called checkOptions.</span>
<a name="l02345"></a>02345 <span class="comment">// In short, best not to refer to Engine options/state in this method</span>
<a name="l02346"></a>02346 <span class="keywordtype">bool</span> CNCytoEngine::isCyto2Reference(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strReferenceFileName)
<a name="l02347"></a>02347 {
<a name="l02348"></a>02348     <span class="keywordtype">int</span> i = 0;
<a name="l02349"></a>02349     <span class="keywordflow">try</span> {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;Cyto2&quot;</span>, <span class="stringliteral">&quot;MedianSignals&quot;</span>);}
<a name="l02350"></a>02350     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02351"></a>02351     <span class="keywordflow">return</span> (i &gt; 0);
<a name="l02352"></a>02352 }
<a name="l02353"></a>02353 
<a name="l02354"></a>02354 <span class="keywordtype">bool</span> CNCytoEngine::isValidReferenceFile(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strReferenceFileName)
<a name="l02355"></a>02355 {
<a name="l02356"></a>02356     <span class="keywordflow">return</span> isCyto2Reference(strReferenceFileName) || isCN5Reference(strReferenceFileName);
<a name="l02357"></a>02357 }
<a name="l02358"></a>02358 
<a name="l02359"></a>02359 <span class="comment">// Check the chip type</span>
<a name="l02360"></a>02360 <span class="keywordtype">void</span> CNCytoEngine::checkChipType()
<a name="l02361"></a>02361 {
<a name="l02362"></a>02362     <a class="code" href="AptTypes_8h.html#a6b6d41ded05bd1136b17fa18be0d744f" title="For row and column indexes.">colrow_t</a> numRows, numCols;
<a name="l02363"></a>02363     <span class="keywordtype">int</span> probeCount,  probeSetCount;
<a name="l02364"></a>02364     vector&lt;string&gt; chipTypes;
<a name="l02365"></a>02365 
<a name="l02366"></a>02366     std::string strCdfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l02367"></a>02367     std::string strSpfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l02368"></a>02368     <span class="keywordflow">if</span>(strCdfFile != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l02369"></a>02369           <a class="code" href="classEngineUtil.html#ade4ca714ab18a0ec35750acb9223cb4f" title="Open up a cdf file and get the chip type (i.e.">EngineUtil::getCdfChipType</a>(chipTypes, numRows, numCols, probeCount, probeSetCount, strCdfFile);
<a name="l02370"></a>02370         }
<a name="l02371"></a>02371         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strSpfFile != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l02372"></a>02372           <a class="code" href="classEngineUtil.html#a983c94e51a248918b98899f262f3e11a" title="Open up a spf (simple probe format) file and read the valid chiptypes (i.e.">EngineUtil::getSpfChipType</a>(chipTypes, numRows, numCols, probeCount, probeSetCount, strSpfFile);
<a name="l02373"></a>02373         }
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;num-rows&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(numRows));
<a name="l02376"></a>02376     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;num-cols&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(numCols));
<a name="l02377"></a>02377     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probe-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(probeCount));
<a name="l02378"></a>02378     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probeset-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(probeSetCount));
<a name="l02379"></a>02379 
<a name="l02380"></a>02380         <span class="keywordflow">if</span> (!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;force&quot;</span>)) {
<a name="l02381"></a>02381                 std::vector&lt;std::string&gt; cels = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l02382"></a>02382                 <a class="code" href="classEngineUtil.html#a952a57d44838690761d2f0bd28cd7a16" title="Check to make sure all the cel files are compatible with the chiptypes supported and number or probes...">EngineUtil::checkCelChipTypes</a>(chipTypes, probeCount, cels, numRows, numCols);
<a name="l02383"></a>02383                 <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {<a class="code" href="classEngineUtil.html#a44f506207f128da78d1c8ba67ab47de2" title="Check chip types in TSV file against those in vector.">EngineUtil::checkTsvFileChipType</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes&quot;</span>), chipTypes);}
<a name="l02384"></a>02384                 <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {<a class="code" href="classEngineUtil.html#a44f506207f128da78d1c8ba67ab47de2" title="Check chip types in TSV file against those in vector.">EngineUtil::checkTsvFileChipType</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes&quot;</span>), chipTypes);}
<a name="l02385"></a>02385         }
<a name="l02386"></a>02386 }
<a name="l02387"></a>02387 
<a name="l02388"></a>02388 <span class="keywordtype">bool</span> CNCytoEngine::isCyto2SnpReference(<span class="keyword">const</span> <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a>&amp; strReferenceFileName)
<a name="l02389"></a>02389 {
<a name="l02390"></a>02390     <span class="keywordtype">int</span> i = 0;
<a name="l02391"></a>02391     <span class="keywordflow">try</span> {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;SNPReference&quot;</span>, <span class="stringliteral">&quot;SNPReference&quot;</span>);}
<a name="l02392"></a>02392     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02393"></a>02393     <span class="keywordflow">return</span> (i &gt; 0);
<a name="l02394"></a>02394     <span class="keywordflow">try</span> {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;SNPReference&quot;</span>, <span class="stringliteral">&quot;EMSNParameters&quot;</span>);}
<a name="l02395"></a>02395     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02396"></a>02396     <span class="keywordflow">return</span> (i &gt; 0);
<a name="l02397"></a>02397     <span class="keywordflow">try</span> {i = <a class="code" href="classaffx_1_1File5__Tsv.html#a70d378884ad8debef8c9e7200263fb67" title="Look inside the file and get the count of rows of a tsv ///.">affx::File5_Tsv::getFileTsvLineCount</a>(strReferenceFileName, <span class="stringliteral">&quot;SNPReference&quot;</span>, <span class="stringliteral">&quot;EMSNArray&quot;</span>);}
<a name="l02398"></a>02398     <span class="keywordflow">catch</span> (...) {i = 0;}
<a name="l02399"></a>02399     <span class="keywordflow">return</span> (i &gt; 0);
<a name="l02400"></a>02400 }
<a name="l02401"></a>02401 
<a name="l02402"></a>02402 <span class="keywordtype">void</span> CNCytoEngine::explain() {
<a name="l02403"></a>02403     <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> factory;
<a name="l02404"></a>02404     std::vector&lt;SelfDoc&gt;docs = factory.getDocs();
<a name="l02405"></a>02405 
<a name="l02406"></a>02406     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l02407"></a>02407     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; docs.size(); i++)
<a name="l02408"></a>02408     {
<a name="l02409"></a>02409         <span class="keywordflow">if</span>(docs[i].getDocName() == <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;explain&quot;</span>))
<a name="l02410"></a>02410         {
<a name="l02411"></a>02411             found = <span class="keyword">true</span>;
<a name="l02412"></a>02412             <a class="code" href="classSelfDoc.html#a99b47e52dc1c81e34a79ed5f71ac55ef" title="Write out a self documenter name, description, and all of its parameters.">SelfDoc::printExplanation</a>(docs[i],cout);
<a name="l02413"></a>02413             <span class="keywordflow">break</span>;
<a name="l02414"></a>02414         }
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416     <span class="keywordflow">if</span> (!found) {
<a name="l02417"></a>02417         cout &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;explain&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;&#39; is not a valid analysis method name&quot;</span> &lt;&lt; endl;
<a name="l02418"></a>02418     }
<a name="l02419"></a>02419     docs.clear();
<a name="l02420"></a>02420 }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422 <span class="keywordtype">void</span> CNCytoEngine::extraHelp() {
<a name="l02423"></a>02423     <a class="code" href="classCNAnalysisMethodFactory.html" title="A factory class for making copy number analysis methodss based on a string representation.">CNAnalysisMethodFactory</a> factory;
<a name="l02424"></a>02424     printStandardMethods(cout);
<a name="l02425"></a>02425     <a class="code" href="classEngineUtil.html#ac60d1bb1a13c6bb184c42089ac962095" title="Print out a header and then a series of self documenting objects.">EngineUtil::printSelfDocs</a>(<span class="stringliteral">&quot;Data transformations:&quot;</span>, factory.getDocs());
<a name="l02426"></a>02426 }
<a name="l02427"></a>02427 
<a name="l02428"></a>02428 <span class="keywordtype">bool</span> CNCytoEngine::predictedIntensitiesExist(<span class="keyword">const</span> <span class="keywordtype">string</span> strInputReferenceFileName){
<a name="l02429"></a>02429 
<a name="l02430"></a>02430         <span class="keywordtype">bool</span> bExists = <span class="keyword">true</span>;
<a name="l02431"></a>02431     <a class="code" href="classaffx_1_1File5__File.html">affx::File5_File</a> file5;
<a name="l02432"></a>02432     <a class="code" href="classaffx_1_1File5__Group.html">affx::File5_Group</a>* group5 = NULL;
<a name="l02433"></a>02433     <a class="code" href="classaffx_1_1File5__Tsv.html">affx::File5_Tsv</a>* tsv5 = NULL;
<a name="l02434"></a>02434     <span class="keywordflow">if</span>(  file5.open(strInputReferenceFileName, affx::FILE5_OPEN_RO) != affx::FILE5_OK)
<a name="l02435"></a>02435     {
<a name="l02436"></a>02436         <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open the --input-reference-file &quot;</span> + strInputReferenceFileName);
<a name="l02437"></a>02437                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02438"></a>02438     }
<a name="l02439"></a>02439     <span class="keywordflow">else</span>
<a name="l02440"></a>02440     {
<a name="l02441"></a>02441 
<a name="l02442"></a>02442         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)))
<a name="l02443"></a>02443         {
<a name="l02444"></a>02444             group5 = file5.openGroup(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN);
<a name="l02445"></a>02445             <span class="keywordflow">if</span>( group5-&gt;open(<span class="stringliteral">&quot;Cyto2&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l02446"></a>02446             {
<a name="l02447"></a>02447                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group Cyto2 the reference input file&quot;</span> + strInputReferenceFileName + <span class="stringliteral">&quot;. Possibly an invalid input reference file.&quot;</span> );
<a name="l02448"></a>02448                 <span class="keyword">delete</span> group5;
<a name="l02449"></a>02449                                 file5.close();
<a name="l02450"></a>02450                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02451"></a>02451             } 
<a name="l02452"></a>02452         }
<a name="l02453"></a>02453         <span class="keywordflow">else</span>
<a name="l02454"></a>02454         {
<a name="l02455"></a>02455             group5 = file5.openGroup(<span class="stringliteral">&quot;CN5&quot;</span>, affx::FILE5_OPEN);
<a name="l02456"></a>02456             <span class="keywordflow">if</span>( group5-&gt;open(<span class="stringliteral">&quot;CN5&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l02457"></a>02457             {
<a name="l02458"></a>02458                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open group CN5 in the input reference file &quot;</span> + strInputReferenceFileName + <span class="stringliteral">&quot;. Possibly an invalid input reference file.&quot;</span> );
<a name="l02459"></a>02459                 <span class="keyword">delete</span> group5;
<a name="l02460"></a>02460                                 file5.close();
<a name="l02461"></a>02461                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02462"></a>02462             } 
<a name="l02463"></a>02463         }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465         <span class="keywordflow">if</span> ((<a class="code" href="classOptions.html#a400b67224caf01af079f1709e0e868f4" title="Check to see if an option is defined.">isOptDefined</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)) &amp;&amp; (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>)))
<a name="l02466"></a>02466         {
<a name="l02467"></a>02467             tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;ProbeEffects&quot;</span>, affx::FILE5_OPEN);
<a name="l02468"></a>02468             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;ProbeEffects&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l02469"></a>02469             {
<a name="l02470"></a>02470                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open the ProbeEffects section in the input reference file &quot;</span> + strInputReferenceFileName + <span class="stringliteral">&quot; . Possibly an invalid inut reference file.&quot;</span>);
<a name="l02471"></a>02471                                 <span class="keyword">delete</span> tsv5;
<a name="l02472"></a>02472                                 tsv5 = NULL;
<a name="l02473"></a>02473                                 bExists = <span class="keyword">false</span>;
<a name="l02474"></a>02474             }
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476         <span class="keywordflow">else</span>
<a name="l02477"></a>02477         {
<a name="l02478"></a>02478             tsv5 = group5-&gt;openTsv(<span class="stringliteral">&quot;CN5.plier.feature-response&quot;</span>, affx::FILE5_OPEN);
<a name="l02479"></a>02479             <span class="keywordflow">if</span>( tsv5-&gt;open(<span class="stringliteral">&quot;CN5.plier.feature-response&quot;</span>, affx::FILE5_OPEN)!= affx::FILE5_OK)
<a name="l02480"></a>02480             {
<a name="l02481"></a>02481                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;Could not open the CN.plier.feature-response section in the input reference file &quot;</span> + strInputReferenceFileName + <span class="stringliteral">&quot; . Possibly an invalid inut reference file.&quot;</span>);
<a name="l02482"></a>02482                                 <span class="keyword">delete</span> tsv5;
<a name="l02483"></a>02483                                 tsv5 = NULL;               
<a name="l02484"></a>02484                                 bExists = <span class="keyword">false</span>;
<a name="l02485"></a>02485             }
<a name="l02486"></a>02486         }
<a name="l02487"></a>02487                 <span class="keywordflow">if</span> (tsv5 != NULL)
<a name="l02488"></a>02488                 {
<a name="l02489"></a>02489                         <span class="keywordflow">if</span> (tsv5-&gt;getColumnCount(0) &lt; 6) 
<a name="l02490"></a>02490                         {
<a name="l02491"></a>02491                                 <a class="code" href="classVerbose.html#a34e1d936178741eeb78de93c5497e1b8" title="Print a warning message.">Verbose::warn</a>(1, <span class="stringliteral">&quot;The input reference file &quot;</span> + strInputReferenceFileName  + <span class="stringliteral">&quot; does not contain pdnn predicted intensities.&quot;</span>);
<a name="l02492"></a>02492                                  bExists = <span class="keyword">false</span>;
<a name="l02493"></a>02493                         }
<a name="l02494"></a>02494                         tsv5-&gt;close();
<a name="l02495"></a>02495                         <span class="keyword">delete</span> tsv5;
<a name="l02496"></a>02496                 }
<a name="l02497"></a>02497                 group5-&gt;close();
<a name="l02498"></a>02498                 <span class="keyword">delete</span> group5;
<a name="l02499"></a>02499                 file5.close();
<a name="l02500"></a>02500     }
<a name="l02501"></a>02501     <span class="keywordflow">return</span> bExists;
<a name="l02502"></a>02502 }
<a name="l02503"></a>02503 
<a name="l02504"></a>02504 <span class="keywordtype">void</span> CNCytoEngine::checkConsistency(<span class="keyword">const</span> vector&lt;string&gt;&amp; analysis) {
<a name="l02505"></a>02505     <span class="comment">// Disallow cn-state and cn-cyto2 specified together</span>
<a name="l02506"></a>02506     <span class="keywordtype">bool</span> cn_state_present = <span class="keyword">false</span>;
<a name="l02507"></a>02507     <span class="keywordtype">bool</span> cn_cyto2_present = <span class="keyword">false</span>;
<a name="l02508"></a>02508     <span class="keyword">const</span> <span class="keywordtype">string</span> cnState = <span class="stringliteral">&quot;cn-state&quot;</span>;
<a name="l02509"></a>02509     <span class="keyword">const</span> <span class="keywordtype">string</span> cnCyto2 = <span class="stringliteral">&quot;cn-cyto2&quot;</span>;
<a name="l02510"></a>02510     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; analysis.size(); i++) {
<a name="l02511"></a>02511         <span class="keywordflow">if</span> (analysis[i].find(cnState) != string::npos) {
<a name="l02512"></a>02512             cn_state_present = <span class="keyword">true</span>;
<a name="l02513"></a>02513         }
<a name="l02514"></a>02514         <span class="keywordflow">if</span> (analysis[i].find(cnCyto2) != string::npos) {
<a name="l02515"></a>02515             cn_cyto2_present = <span class="keyword">true</span>;
<a name="l02516"></a>02516         }
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518     <span class="keywordflow">if</span> (cn_state_present &amp;&amp; cn_cyto2_present) {
<a name="l02519"></a>02519         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Analysis strings &#39;cn-state&#39; and &#39;cn-cyto2&#39; cannot be specified together.&quot;</span>);
<a name="l02520"></a>02520     }
<a name="l02521"></a>02521 
<a name="l02522"></a>02522     <span class="comment">// Disallow allele-peaks when cyto2=false and</span>
<a name="l02523"></a>02523     <span class="comment">// allelic-difference/allelic-difference-CytoScan when cyto2=true.</span>
<a name="l02524"></a>02524     <span class="keywordtype">string</span> wrongStr;
<a name="l02525"></a>02525     <span class="keyword">const</span> <span class="keywordtype">bool</span> cyto2flag = <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cyto2&quot;</span>);
<a name="l02526"></a>02526     <span class="keywordflow">if</span> (cyto2flag) {
<a name="l02527"></a>02527         wrongStr = <span class="stringliteral">&quot;allelic-difference&quot;</span>;
<a name="l02528"></a>02528     } <span class="keywordflow">else</span> {
<a name="l02529"></a>02529         wrongStr = <span class="stringliteral">&quot;allele-peaks&quot;</span>;
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; analysis.size(); i++) {
<a name="l02532"></a>02532         <span class="keywordflow">if</span> (analysis[i].find(wrongStr) != string::npos) {
<a name="l02533"></a>02533             error(<span class="stringliteral">&quot;&#39;&quot;</span> + wrongStr + <span class="stringliteral">&quot;&#39; analysis cannot be run when the cyto2 input parameter is set to &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(cyto2flag) + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l02534"></a>02534         }
<a name="l02535"></a>02535     }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537     <span class="comment">// Disallow allelic-difference and allelic-difference-CytoScan together</span>
<a name="l02538"></a>02538     <span class="keyword">const</span> <span class="keywordtype">string</span> adStr = <span class="stringliteral">&quot;allelic-difference&quot;</span>;
<a name="l02539"></a>02539     <span class="keywordflow">if</span> (!cyto2flag) {
<a name="l02540"></a>02540         <span class="keywordtype">int</span> iCount = 0;
<a name="l02541"></a>02541         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; analysis.size(); i++) {
<a name="l02542"></a>02542             <span class="keywordflow">if</span> (analysis[i].find(adStr) != string::npos) {
<a name="l02543"></a>02543                 iCount++;
<a name="l02544"></a>02544             }
<a name="l02545"></a>02545         }
<a name="l02546"></a>02546         <span class="keywordflow">if</span> (iCount &gt; 1) {
<a name="l02547"></a>02547             error(<span class="stringliteral">&quot;&#39;&quot;</span> + adStr + <span class="stringliteral">&quot;&#39; analysis cannot be specified more than once.&quot;</span>);
<a name="l02548"></a>02548         }
<a name="l02549"></a>02549     }
<a name="l02550"></a>02550 }
<a name="l02551"></a>02551 
<a name="l02552"></a>02552 <span class="keywordtype">void</span> CNCytoEngine::loadProbes(<a class="code" href="classCNLog2RatioData.html" title="A class to the log2 ratio data as used by the log2 ratio engine.">CNLog2RatioData</a>&amp; data, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; chrXProbeFile, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; chrYProbeFile,
<a name="l02553"></a>02553                   std::vector&lt; std::vector&lt;probeid_t&gt; &gt;&amp; chrXProbes, 
<a name="l02554"></a>02554                   std::vector&lt; std::vector&lt;probeid_t&gt; &gt;&amp; chrYProbes)
<a name="l02555"></a>02555 {
<a name="l02556"></a>02556     <span class="keywordflow">if</span> (chrXProbeFile.empty())
<a name="l02557"></a>02557         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No chrX probe id file specified. Unable to filter chrXProbeFile probes.&quot;</span>);
<a name="l02558"></a>02558 
<a name="l02559"></a>02559     <span class="keywordflow">if</span> (chrYProbeFile.empty())
<a name="l02560"></a>02560         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No chrY probe id file specified. Unable to filter chrYProbeFile probes.&quot;</span>);
<a name="l02561"></a>02561 
<a name="l02562"></a>02562     <a class="code" href="classEngineUtil.html#a8f1cf737be93b760c7fd4d4e45e97c1d" title="Read in a file of probe IDs.">EngineUtil::readProbeFile</a>(chrXProbes, chrXProbeFile);
<a name="l02563"></a>02563     <a class="code" href="classEngineUtil.html#a8f1cf737be93b760c7fd4d4e45e97c1d" title="Read in a file of probe IDs.">EngineUtil::readProbeFile</a>(chrYProbes, chrYProbeFile);
<a name="l02564"></a>02564 
<a name="l02565"></a>02565         <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cytoscan-hd&quot;</span>))
<a name="l02566"></a>02566         {
<a name="l02567"></a>02567                 <span class="comment">// Filter the chrX and chrY probes to those that are members of probe sets where the processFlag &gt; 0            </span>
<a name="l02568"></a>02568                 std::map&lt;unsigned int, CNProbeSet*&gt; mapProbeSets;
<a name="l02569"></a>02569                 <a class="code" href="classCNProbeSet.html" title="A class to store probe set data.">CNProbeSet</a>* p = NULL;
<a name="l02570"></a>02570                 <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> layout;              
<a name="l02571"></a>02571                 <span class="keywordtype">string</span> strCdfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l02572"></a>02572                 <span class="keywordtype">string</span> strSpfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l02573"></a>02573                 <span class="keywordflow">if</span> (!strCdfFile.empty()) {layout.<a class="code" href="classChipLayout.html#a13aad6c63375822f6a407f1328e500de" title="Open a file and parse the probe sets.">openCdfAll</a>(strCdfFile);}
<a name="l02574"></a>02574                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strSpfFile.empty()) {layout.openSpfAll(strSpfFile);}
<a name="l02575"></a>02575                 <span class="keywordflow">else</span> {<a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No cdf-file or spf-file specified&quot;</span>);}
<a name="l02576"></a>02576                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiProbeID = 0;
<a name="l02577"></a>02577                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iProbeSetIndex = 0; (iProbeSetIndex &lt;data.getProbeSets()-&gt;getCount()); iProbeSetIndex++) 
<a name="l02578"></a>02578                 {
<a name="l02579"></a>02579                         p = data.getProbeSets()-&gt;getAt(iProbeSetIndex);
<a name="l02580"></a>02580                         <a class="code" href="classProbeListPacked.html">ProbeListPacked</a> pList = layout.<a class="code" href="classChipLayout.html#ae465f92816b1c9983a45d1f73293cc7b" title="Find a probe set using the name as a key.">getProbeListByName</a>(p-&gt;getProbeSetName());
<a name="l02581"></a>02581                         <span class="keywordflow">if</span> (!pList.isNull())
<a name="l02582"></a>02582                         {
<a name="l02583"></a>02583                                 <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a>* ps = <a class="code" href="classProbeListFactory.html#aaed559bbfe723ed4fe225f805a2411e8">ProbeListFactory::asProbeSet</a>(pList);
<a name="l02584"></a>02584                                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iAtomIndex = 0; (iAtomIndex &lt; ps-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.size()); iAtomIndex++) 
<a name="l02585"></a>02585                                 {
<a name="l02586"></a>02586                                         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iProbeIndex = 0; (iProbeIndex &lt; ps-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>[iAtomIndex]-&gt;probes.size()); iProbeIndex++) 
<a name="l02587"></a>02587                                         {
<a name="l02588"></a>02588                                                 uiProbeID = (ps-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>[iAtomIndex]-&gt;probes[iProbeIndex]-&gt;id + 1);
<a name="l02589"></a>02589                                                 mapProbeSets.insert(std::pair &lt;unsigned int, CNProbeSet*&gt;(uiProbeID, p));
<a name="l02590"></a>02590                                         }
<a name="l02591"></a>02591                                 }
<a name="l02592"></a>02592                                 <span class="keyword">delete</span> ps;
<a name="l02593"></a>02593                         }
<a name="l02594"></a>02594                 }
<a name="l02595"></a>02595 
<a name="l02596"></a>02596                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; chrXProbes.size(); ++i)
<a name="l02597"></a>02597                 {
<a name="l02598"></a>02598                         vector&lt;probeid_t&gt;::iterator it = chrXProbes[i].begin();
<a name="l02599"></a>02599                         <span class="keywordflow">while</span> (it != chrXProbes[i].end()) 
<a name="l02600"></a>02600                         {
<a name="l02601"></a>02601                                 <span class="keywordflow">if</span> (mapProbeSets.find(*it + 1) == mapProbeSets.end()) {chrXProbes[i].erase(it); <span class="keywordflow">continue</span>;}
<a name="l02602"></a>02602                                 it++;
<a name="l02603"></a>02603                         }
<a name="l02604"></a>02604                 }
<a name="l02605"></a>02605                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; chrYProbes.size(); ++i)
<a name="l02606"></a>02606                 {
<a name="l02607"></a>02607                         vector&lt;probeid_t&gt;::iterator it = chrYProbes[i].begin();
<a name="l02608"></a>02608                         <span class="keywordflow">while</span> (it != chrYProbes[i].end()) 
<a name="l02609"></a>02609                         {
<a name="l02610"></a>02610                                 <span class="keywordflow">if</span> (mapProbeSets.find(*it + 1) == mapProbeSets.end()) {chrYProbes[i].erase(it); <span class="keywordflow">continue</span>;}
<a name="l02611"></a>02611                                 it++;
<a name="l02612"></a>02612                         }
<a name="l02613"></a>02613                 }
<a name="l02614"></a>02614         }
<a name="l02615"></a>02615 }
<a name="l02616"></a>02616 
<a name="l02617"></a>02617 <span class="keywordtype">string</span> CNCytoEngine::saveProbes(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; basename, vector&lt; vector&lt;probeid_t&gt; &gt;&amp; chrProbes)
<a name="l02618"></a>02618 {
<a name="l02619"></a>02619     <span class="comment">// Create temp name</span>
<a name="l02620"></a>02620     <a class="code" href="classTmpFileFactory.html" title="Allocate temporary filenames and arrange to remove them when done.">TmpFileFactory</a> tempFactory;
<a name="l02621"></a>02621     tempFactory.<a class="code" href="classTmpFileFactory.html#a0c4ac0f09751f79adb32ddd8107e0ae4" title="Sets the directory in which the tmp files will be allocated. ///.">setTmpdir</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l02622"></a>02622     <a class="code" href="classAffxString.html" title="A class derived from std::string.">AffxString</a> strProbeFile = tempFactory.<a class="code" href="classTmpFileFactory.html#a2fbad1f1c46aa89ccfdbb2b549f2ad85" title="Generate a name which does not exist in the filesystem. /// Does NOT remember to delete the filename ...">genFilename_basic</a>(basename, <span class="stringliteral">&quot;.tmp&quot;</span>);
<a name="l02623"></a>02623 
<a name="l02624"></a>02624     <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a> *tsv = <span class="keyword">new</span> <a class="code" href="classaffx_1_1TsvFile.html" title="A class for reading and writing Tab Seperated Value (TSV) files. /// See the TsvFile format document ...">affx::TsvFile</a>;
<a name="l02625"></a>02625     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0,0,<span class="stringliteral">&quot;probe_id&quot;</span>, affx::TSV_TYPE_INT);
<a name="l02626"></a>02626 
<a name="l02627"></a>02627     <span class="keywordtype">bool</span> channelCol = <span class="keyword">false</span>;
<a name="l02628"></a>02628     <span class="keywordflow">if</span> (chrProbes.size() &gt; 1)
<a name="l02629"></a>02629     {
<a name="l02630"></a>02630         tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0,1,<span class="stringliteral">&quot;channel&quot;</span>, affx::TSV_TYPE_INT);
<a name="l02631"></a>02631         channelCol = <span class="keyword">true</span>;
<a name="l02632"></a>02632     }
<a name="l02633"></a>02633 
<a name="l02634"></a>02634     tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a607cbaf58e6e0772ef7d2aaee277c552" title="open the file for writing in &amp;quot;v2&amp;quot; format. ///">writeTsv</a>(strProbeFile);
<a name="l02635"></a>02635 
<a name="l02636"></a>02636     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> channelIdx = 0; channelIdx &lt; chrProbes.size(); ++channelIdx)
<a name="l02637"></a>02637     {
<a name="l02638"></a>02638         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iIndex = 0; iIndex &lt; chrProbes[channelIdx].size(); ++iIndex)
<a name="l02639"></a>02639         {
<a name="l02640"></a>02640             tsv-&gt;set(0,0,<a class="code" href="ProbeSet_8h.html#a240e586bbac5903f1ec755bc2c71ff0b" title="Add 1 to everthing bigger than -1.">FROM_ZEROBASED</a>(chrProbes[channelIdx][iIndex]));
<a name="l02641"></a>02641             <span class="keywordflow">if</span> (channelCol == <span class="keyword">true</span>)
<a name="l02642"></a>02642             {
<a name="l02643"></a>02643                 tsv-&gt;set(0,1,channelIdx);
<a name="l02644"></a>02644             }
<a name="l02645"></a>02645             tsv-&gt;<a class="code" href="classaffx_1_1TsvFile.html#a2a459be42bea9ea3f180773370ec0de7" title="Write a level of data to the file. ///.">writeLevel</a>(0);
<a name="l02646"></a>02646         }
<a name="l02647"></a>02647     }
<a name="l02648"></a>02648     <span class="keyword">delete</span> tsv;
<a name="l02649"></a>02649     <span class="keywordflow">return</span> strProbeFile;
<a name="l02650"></a>02650 }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652 <span class="keywordtype">void</span> CNCytoEngine::removeTempProbeFiles()
<a name="l02653"></a>02653 {
<a name="l02654"></a>02654     <a class="code" href="classFs.html#a6b8f232817f933a42c21edde6ea55a3a" title="An error if it doesnt exist.">Fs::rm</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrX-probes-filtered&quot;</span>), <span class="keyword">false</span>);
<a name="l02655"></a>02655     <a class="code" href="classFs.html#a6b8f232817f933a42c21edde6ea55a3a" title="An error if it doesnt exist.">Fs::rm</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chrY-probes-filtered&quot;</span>), <span class="keyword">false</span>);
<a name="l02656"></a>02656     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrX-probes-filtered&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02657"></a>02657     <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chrY-probes-filtered&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02658"></a>02658 }
<a name="l02659"></a>02659 
<a name="l02660"></a>02660 
<a name="l02661"></a>02661 
<a name="l02662"></a>02662 
<a name="l02663"></a>02663 
<a name="l02664"></a>02664 
<a name="l02665"></a>02665 
<a name="l02666"></a>02666 
<a name="l02667"></a>02667 
<a name="l02668"></a>02668 
<a name="l02669"></a>02669 
<a name="l02670"></a>02670 
<a name="l02671"></a>02671 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 23 2016 12:58:57 for Affymetrix Power Tools by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
