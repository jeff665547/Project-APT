<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Affymetrix Power Tools: chipstream/apt-data-step/ProbesetSummarizeStageEngine.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_fa2ccd765111060c049013d9614ef4eb.html">chipstream</a>      </li>
      <li><a class="el" href="dir_b379270f4bb7b3a87e1d36dd419dfb96.html">apt-data-step</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>ProbesetSummarizeStageEngine.cpp</h1>  </div>
</div>
<div class="contents">
<a href="ProbesetSummarizeStageEngine_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">////////////////////////////////////////////////////////////////</span>
<a name="l00002"></a>00002 <span class="comment"></span><span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2005 Affymetrix, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// This program is free software; you can redistribute it and/or modify </span>
<a name="l00006"></a>00006 <span class="comment">// it under the terms of the GNU General Public License (version 2) as </span>
<a name="l00007"></a>00007 <span class="comment">// published by the Free Software Foundation.</span>
<a name="l00008"></a>00008 <span class="comment">// </span>
<a name="l00009"></a>00009 <span class="comment">// This program is distributed in the hope that it will be useful, </span>
<a name="l00010"></a>00010 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<a name="l00011"></a>00011 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </span>
<a name="l00012"></a>00012 <span class="comment">// General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment">// </span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU General Public License </span>
<a name="l00015"></a>00015 <span class="comment">// along with this program;if not, write to the </span>
<a name="l00016"></a>00016 <span class="comment">// </span>
<a name="l00017"></a>00017 <span class="comment">// Free Software Foundation, Inc., </span>
<a name="l00018"></a>00018 <span class="comment">// 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00019"></a>00019 <span class="comment">//</span><span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">////////////////////////////////////////////////////////////////</span>
<a name="l00021"></a>00021 <span class="comment"></span><span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">/**</span>
<a name="l00023"></a>00023 <span class="comment"> * @file   ProbesetSummarizeStageEngine.cpp</span>
<a name="l00024"></a>00024 <span class="comment"> * @author Chuck Sugnet</span>
<a name="l00025"></a>00025 <span class="comment"> * @date   Mon Oct 24 12:21:35 2005</span>
<a name="l00026"></a>00026 <span class="comment"> * </span>
<a name="l00027"></a>00027 <span class="comment"> * @brief  Program for summarizing probeset results from the command line. Requires</span>
<a name="l00028"></a>00028 <span class="comment"> * three main inputs: 1) layout file decribing individual probes and their grouping into </span>
<a name="l00029"></a>00029 <span class="comment"> * probe sets. 2) clf file telling where probes are located on chip. 3) Data input files,</span>
<a name="l00030"></a>00030 <span class="comment"> * usually cel files.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * @todo runImp is getting long, time to refactor.</span>
<a name="l00033"></a>00033 <span class="comment"> * @todo Windows documentation and example quantification method.</span>
<a name="l00034"></a>00034 <span class="comment"> * @todo Figure out what debugging information necessary for remote troubleshooting and include it somewhere.</span>
<a name="l00035"></a>00035 <span class="comment"> * @todo Enable quantile normalization withing groups and median normalization across groups.</span>
<a name="l00036"></a>00036 <span class="comment"> * @todo DABG flag for -logP output</span>
<a name="l00037"></a>00037 <span class="comment"> * @todo Only read in required columns from map files.</span>
<a name="l00038"></a>00038 <span class="comment"> * @todo For QC Reports: consider making the P-value threshold for detection configurable</span>
<a name="l00039"></a>00039 <span class="comment"> *       from the command line, with the default set from the pgf file.</span>
<a name="l00040"></a>00040 <span class="comment"> */</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;chipstream/apt-data-step/ProbesetSummarizeStageEngine.h&quot;</span>
<a name="l00044"></a>00044 <span class="comment">//</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="CelReader_8h.html" title="Class for reading cel files and passing the data to memory representation and analysis objects...">chipstream/CelReader.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;chipstream/CelStatListener.h&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="DiskIntensityMart_8h.html" title="Class for encapsulating microarray data and storing it on disk in a reasonable way to reduce memory i...">chipstream/DiskIntensityMart.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="EngineUtil_8h.html" title="Some common functions that application executables make use of.">chipstream/EngineUtil.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;chipstream/MetaProbeset.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;chipstream/SpfReader.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;chipstream/ProbeListFactory.h&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodExprCCCHPReport_8h.html" title="Class for reporting results of quantification methods.">chipstream/QuantMethodExprCCCHPReport.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodExprCHPReport_8h.html" title="Class for reporting results of quantification methods.">chipstream/QuantMethodExprCHPReport.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodExprChipSummary_8h.html" title="Summarize basic statistics on the performance of a particular summarization or detection method acros...">chipstream/QuantMethodExprChipSummary.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodMultiDataCCCHPReport_8h.html" title="Reporter for genotyping probe sets that outputs chp files. There is one CC CHP file produced for each...">chipstream/QuantMethodMultiDataCCCHPReport.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodRunReport_8h.html" title="Summarize and output basic statistics on the performance of a particular summarization or detection m...">chipstream/QuantMethodRunReport.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="QuantMethodSamplerReport_8h.html" title="Class for reporting qc stats to a file.">chipstream/QuantMethodSamplerReport.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="ChipStreamFactory_8h.html" title="Factory class for making chip streams based on a string representation.">chipstream/ChipStreamFactory.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;chipstream/DataStore.h&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;chipstream/PsBoard.h&quot;</span>
<a name="l00061"></a>00061 <span class="comment">//</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="ExceptionBase_8h.html">calvin_files/exception/src/ExceptionBase.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="FusionCELData_8h.html">calvin_files/fusion/src/FusionCELData.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="StringUtils_8h.html">calvin_files/utils/src/StringUtils.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="ClfFile_8h.html" title="Headers for the CLF file class Read the ClfFile format  for an overview.">file/TsvFile/ClfFile.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="TsvFile_8h.html" title="Headers for the TsvFile classes.">file/TsvFile/TsvFile.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="Fs_8h.html" title="///">util/Fs.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="comment">//</span>
<a name="l00070"></a>00070 <span class="comment">//#include &quot;newmat.h&quot;</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">//</span>
<a name="l00073"></a>00073 <span class="keyword">using namespace </span>std;
<a name="l00074"></a>00074 <span class="keyword">using namespace </span>affymetrix_fusion_io;
<a name="l00075"></a>00075 <span class="keyword">using namespace </span>affymetrix_calvin_utilities;
<a name="l00076"></a>00076 <span class="keyword">using namespace </span>affymetrix_calvin_io;
<a name="l00077"></a>00077 <span class="keyword">using namespace </span>affymetrix_calvin_exceptions;
<a name="l00078"></a>00078 <span class="keyword">using namespace </span>affx;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <a class="code" href="classProbesetSummarizeStageEngine_1_1Reg.html">ProbesetSummarizeStageEngine::Reg</a> <a class="code" href="classProbesetSummarizeStageEngine.html#a52c14a78925f7d9003a525e541b94ae4">ProbesetSummarizeStageEngine::reg</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classProbesetSummarizeStageEngine.html#ae9e5d1658f7209c57eb65662c083ff58">00082</a> <a class="code" href="classProbesetSummarizeStageEngine.html">ProbesetSummarizeStageEngine</a> * <a class="code" href="classProbesetSummarizeStageEngine.html#ae9e5d1658f7209c57eb65662c083ff58">ProbesetSummarizeStageEngine::FromBase</a>(<a class="code" href="classBaseEngine.html" title="Base class for analysis engines.">BaseEngine</a> *engine)
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084         <span class="keywordflow">if</span> (engine != NULL &amp;&amp; engine-&gt;getEngineName() == ProbesetSummarizeStageEngine::EngineName())
<a name="l00085"></a>00085                 <span class="keywordflow">return</span> (<a class="code" href="classProbesetSummarizeStageEngine.html">ProbesetSummarizeStageEngine</a> *)engine;
<a name="l00086"></a>00086         <span class="keywordflow">return</span> NULL;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classProbesetSummarizeStageEngine.html#a19c5be19c9b938079e5754a69f1dfa31">00089</a> <a class="code" href="classProbesetSummarizeStageEngine.html#a19c5be19c9b938079e5754a69f1dfa31" title="Constructor.">ProbesetSummarizeStageEngine::ProbesetSummarizeStageEngine</a>() {
<a name="l00090"></a>00090     m_a5_global_input_file = NULL;
<a name="l00091"></a>00091     m_a5_global_input_group = NULL;
<a name="l00092"></a>00092     m_a5_global_output_file = NULL;
<a name="l00093"></a>00093     m_a5_global_output_group = NULL;
<a name="l00094"></a>00094     defineStdMethods();
<a name="l00095"></a>00095     defineOptions();
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="classProbesetSummarizeStageEngine.html#a7f5d93fd70e6f901b63d9e7b915b56fb">00098</a> <a class="code" href="classProbesetSummarizeStageEngine.html#a7f5d93fd70e6f901b63d9e7b915b56fb" title="Destructor.">ProbesetSummarizeStageEngine::~ProbesetSummarizeStageEngine</a>() {
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::defineStdMethods() {
<a name="l00102"></a>00102     m_stdMethods[<span class="stringliteral">&quot;plier-gcbg&quot;</span>] = <span class="stringliteral">&quot;quant-norm.sketch=0.bioc=false,pm-gcbg,plier&quot;</span>;
<a name="l00103"></a>00103     m_stdMethods[<span class="stringliteral">&quot;plier-mm&quot;</span>] = <span class="stringliteral">&quot;quant-norm.sketch=0.bioc=false,pm-mm,plier&quot;</span>;
<a name="l00104"></a>00104     m_stdMethods[<span class="stringliteral">&quot;rma&quot;</span>] = <span class="stringliteral">&quot;rma-bg,quant-norm.sketch=0.usepm=true.bioc=true,pm-only,med-polish&quot;</span>;
<a name="l00105"></a>00105     m_stdMethods[<span class="stringliteral">&quot;plier-gcbg-sketch&quot;</span>] = <span class="stringliteral">&quot;quant-norm.sketch=-1.bioc=false,pm-gcbg,plier&quot;</span>;
<a name="l00106"></a>00106     m_stdMethods[<span class="stringliteral">&quot;plier-mm-sketch&quot;</span>] = <span class="stringliteral">&quot;quant-norm.sketch=-1.bioc=false,pm-mm,plier&quot;</span>;
<a name="l00107"></a>00107     m_stdMethods[<span class="stringliteral">&quot;rma-sketch&quot;</span>] = <span class="stringliteral">&quot;rma-bg,quant-norm.sketch=-1.usepm=true.bioc=true,pm-only,med-polish&quot;</span>;
<a name="l00108"></a>00108     m_stdMethods[<span class="stringliteral">&quot;dabg&quot;</span>] = <span class="stringliteral">&quot;pm-only,dabg&quot;</span>;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::defineOptions() {
<a name="l00112"></a>00112   defineOptionSection(<span class="stringliteral">&quot;Input Options&quot;</span>);
<a name="l00113"></a>00113   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cel-files&quot;</span>, PgOpt::STRING_OPT,
<a name="l00114"></a>00114                      <span class="stringliteral">&quot;Text file specifying cel files to process, one per line with the first line being &#39;cel_files&#39;.&quot;</span>,
<a name="l00115"></a>00115                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00116"></a>00116   defineOption(<span class="stringliteral">&quot;d&quot;</span>, <span class="stringliteral">&quot;cdf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00117"></a>00117                      <span class="stringliteral">&quot;File defining probe sets. Use either --cdf-file, --spf-file, or --pgf-file and --clf-file. &quot;</span>
<a name="l00118"></a>00118                      <span class="stringliteral">&quot;Automatically sets --names.&quot;</span>,
<a name="l00119"></a>00119                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00120"></a>00120   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;spf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00121"></a>00121                      <span class="stringliteral">&quot;File defining probe sets in spf (simple probe format) which is like a text cdf file.&quot;</span>,
<a name="l00122"></a>00122                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00123"></a>00123   defineOption(<span class="stringliteral">&quot;p&quot;</span>, <span class="stringliteral">&quot;pgf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00124"></a>00124                      <span class="stringliteral">&quot;File defining probe sets.&quot;</span>,
<a name="l00125"></a>00125                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00126"></a>00126   defineOption(<span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;clf-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00127"></a>00127                      <span class="stringliteral">&quot;File defining x,y &lt;-&gt; probe id conversion. Required when using PGF file.&quot;</span>,
<a name="l00128"></a>00128                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00129"></a>00129   defineOption(<span class="stringliteral">&quot;b&quot;</span>, <span class="stringliteral">&quot;bgp-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00130"></a>00130                      <span class="stringliteral">&quot;File defining probes to be used for GC background.&quot;</span>,
<a name="l00131"></a>00131                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00132"></a>00132   defineOption(<span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;probeset-ids&quot;</span>, PgOpt::STRING_OPT,
<a name="l00133"></a>00133                      <span class="stringliteral">&quot;File specifying probe sets to summarize.&quot;</span>,
<a name="l00134"></a>00134                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00135"></a>00135   defineOption(<span class="stringliteral">&quot;m&quot;</span>, <span class="stringliteral">&quot;meta-probesets&quot;</span>, PgOpt::STRING_OPT,
<a name="l00136"></a>00136                      <span class="stringliteral">&quot;File containing meta probeset definitions. &quot;</span>
<a name="l00137"></a>00137                      <span class="stringliteral">&quot;File must contain a probeset_id column and a probeset_list column.&quot;</span>,
<a name="l00138"></a>00138                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00139"></a>00139   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-class-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00140"></a>00140                      <span class="stringliteral">&quot;File containing probe_id (1-based) of probes and a &#39;class&#39; designation. &quot;</span>
<a name="l00141"></a>00141                      <span class="stringliteral">&quot;Used to compute mean probe intensity by class for report file.&quot;</span>,
<a name="l00142"></a>00142                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00143"></a>00143   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;qc-probesets&quot;</span>, PgOpt::STRING_OPT,
<a name="l00144"></a>00144                      <span class="stringliteral">&quot;File with probeset_id(name) and group_name columns specifying subsets of probesets to compute qc stats for.&quot;</span>,
<a name="l00145"></a>00145                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00146"></a>00146   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;chip-type&quot;</span>, PgOpt::STRING_OPT,
<a name="l00147"></a>00147                    <span class="stringliteral">&quot;Chip types to check library and CEL files against. &quot;</span>
<a name="l00148"></a>00148                    <span class="stringliteral">&quot;Can be specified multiple times. &quot;</span>
<a name="l00149"></a>00149                    <span class="stringliteral">&quot;The first one is propigated as the chip type in the output files. &quot;</span>
<a name="l00150"></a>00150                    <span class="stringliteral">&quot;Warning, use of this option will override the usual check between chip types &quot;</span>
<a name="l00151"></a>00151                    <span class="stringliteral">&quot;found in the library files and cel files. You should use this option instead &quot;</span>
<a name="l00152"></a>00152                    <span class="stringliteral">&quot;of --force when possible. &quot;</span>,
<a name="l00153"></a>00153                    <span class="stringliteral">&quot;&quot;</span>);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   defineOptionSection(<span class="stringliteral">&quot;Output Options&quot;</span>);
<a name="l00156"></a>00156   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cc-chp-output&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00157"></a>00157                      <span class="stringliteral">&quot;Output results in directory called &#39;cc-chp&#39; under out-dir. &quot;</span>
<a name="l00158"></a>00158                      <span class="stringliteral">&quot;This makes one AGCC Expression CHP file per cel file analyzed.&quot;</span>,
<a name="l00159"></a>00159                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00160"></a>00160   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;xda-chp-output&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00161"></a>00161                      <span class="stringliteral">&quot;Output resulting calls in directory called &#39;chp&#39; under out-dir. &quot;</span>
<a name="l00162"></a>00162                      <span class="stringliteral">&quot;This makes one GCOS XDA CHP file per cel file analyzed.&quot;</span>,
<a name="l00163"></a>00163                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00164"></a>00164   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cc-md-chp-output&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00165"></a>00165                      <span class="stringliteral">&quot;Output resulting calls in directory called &#39;cc-md-chp&#39; under out-dir. &quot;</span>
<a name="l00166"></a>00166                      <span class="stringliteral">&quot;This makes one AGCC Multi Data CHP file per cel file analyzed.&quot;</span>,
<a name="l00167"></a>00167                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00168"></a>00168   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cc-chp-out-dir&quot;</span>, PgOpt::STRING_OPT,
<a name="l00169"></a>00169                      <span class="stringliteral">&quot;Over-ride the default location for chp output.&quot;</span>,
<a name="l00170"></a>00170                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00171"></a>00171   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;xda-chp-out-dir&quot;</span>, PgOpt::STRING_OPT,
<a name="l00172"></a>00172                      <span class="stringliteral">&quot;Over-ride the default location for chp output.&quot;</span>,
<a name="l00173"></a>00173                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00174"></a>00174   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cc-md-chp-out-dir&quot;</span>, PgOpt::STRING_OPT,
<a name="l00175"></a>00175                      <span class="stringliteral">&quot;Over-ride the default location for chp output.&quot;</span>,
<a name="l00176"></a>00176                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00177"></a>00177   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;subsample-report&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00178"></a>00178                      <span class="stringliteral">&quot;Output subsamples of the data intensities, summaries and residuals for error checking downstream.&quot;</span>,
<a name="l00179"></a>00179                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00180"></a>00180   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;report-file&quot;</span>, PgOpt::STRING_OPT,
<a name="l00181"></a>00181                      <span class="stringliteral">&quot;Over-ride the default report file name.&quot;</span>,
<a name="l00182"></a>00182                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   defineOptionSection(<span class="stringliteral">&quot;Analysis Options&quot;</span>);
<a name="l00185"></a>00185   defOptMult(<span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;analysis&quot;</span>, PgOpt::STRING_OPT,
<a name="l00186"></a>00186                    <span class="stringliteral">&quot;String representing analysis pathway desired. For example: &#39;quant-norm,pm-gcbg,plier&#39;. &quot;</span>
<a name="l00187"></a>00187                    <span class="stringliteral">&quot;Prepackaged analysis such as &#39;plier-gcbg-sketch&#39;, &#39;plier-gcbg&#39;, &#39;plier-mm-sketch&#39;, &quot;</span>
<a name="l00188"></a>00188                    <span class="stringliteral">&quot;&#39;plier-mm&#39;, &#39;rma-sketch&#39;, and &#39;rma&#39; can be specified. &quot;</span>
<a name="l00189"></a>00189                    <span class="stringliteral">&quot;Multiple analysis allowed at same time. &quot;</span>
<a name="l00190"></a>00190                    <span class="stringliteral">&quot;When using quantile normalization, you may need to use the sketch option &quot;</span>
<a name="l00191"></a>00191                    <span class="stringliteral">&quot;to avoid running out of memory.&quot;</span>,
<a name="l00192"></a>00192                    <span class="stringliteral">&quot;&quot;</span>);
<a name="l00193"></a>00193   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;summaries&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00194"></a>00194                      <span class="stringliteral">&quot;Output expression summaries in text table format.&quot;</span>,
<a name="l00195"></a>00195                      <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00196"></a>00196   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;feat-effects&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00197"></a>00197                      <span class="stringliteral">&quot;Output feature effects when available.&quot;</span>,
<a name="l00198"></a>00198                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00199"></a>00199   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;use-feat-eff&quot;</span>, PgOpt::STRING_OPT,
<a name="l00200"></a>00200                      <span class="stringliteral">&quot;File defining a plier feature effect for each probe. &quot;</span>
<a name="l00201"></a>00201                      <span class="stringliteral">&quot;Note that precomputed effects should only be used for an appropriately similar analysis &quot;</span>
<a name="l00202"></a>00202                      <span class="stringliteral">&quot;(i.e. feature effects for pm-only may be different than for pm-mm). &quot;</span>
<a name="l00203"></a>00203                      <span class="stringliteral">&quot;Currently a probe is expected to be in only a single probeset. &quot;</span>
<a name="l00204"></a>00204                      <span class="stringliteral">&quot;This option does not work for IterPlier or SEA.&quot;</span>,
<a name="l00205"></a>00205                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00206"></a>00206   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;feat-details&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00207"></a>00207                      <span class="stringliteral">&quot;Output probe by chip specific details (often residuals) when available.&quot;</span>,
<a name="l00208"></a>00208                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00209"></a>00209   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;target-sketch&quot;</span>, PgOpt::STRING_OPT,
<a name="l00210"></a>00210                      <span class="stringliteral">&quot;File specifying a target distribution to use for quantile normalization.&quot;</span>,
<a name="l00211"></a>00211                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00212"></a>00212   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;write-sketch&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00213"></a>00213                      <span class="stringliteral">&quot;Write the quantile normalization distribution (or sketch) to a file for reuse with target-sketch option. &quot;</span>
<a name="l00214"></a>00214                      <span class="stringliteral">&quot;WARNING: If more than one -a option generates a target sketch file, it is not deterministic which file &quot;</span>
<a name="l00215"></a>00215                      <span class="stringliteral">&quot;will be retained by the OS if the target sketch files have the same name.&quot;</span>,
<a name="l00216"></a>00216                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00217"></a>00217   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;reference-profile&quot;</span>,PgOpt::STRING_OPT,
<a name="l00218"></a>00218                         <span class="stringliteral">&quot;Reference profile&quot;</span>,
<a name="l00219"></a>00219                         <span class="stringliteral">&quot;&quot;</span>);
<a name="l00220"></a>00220   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;write-profile&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00221"></a>00221                         <span class="stringliteral">&quot;write reference profile.&quot;</span>,<span class="stringliteral">&quot;false&quot;</span>);
<a name="l00222"></a>00222   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;set-analysis-name&quot;</span>, PgOpt::STRING_OPT,
<a name="l00223"></a>00223                      <span class="stringliteral">&quot;Explicitly set the analysis name. &quot;</span>
<a name="l00224"></a>00224                      <span class="stringliteral">&quot;This affects output file names (ie prefix) and various meta info.&quot;</span>,
<a name="l00225"></a>00225                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00226"></a>00226   defineOption(<span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;precision&quot;</span>, PgOpt::INT_OPT,
<a name="l00227"></a>00227                      <span class="stringliteral">&quot;How many digits of precision to use after decimal.&quot;</span>,
<a name="l00228"></a>00228                      <span class="stringliteral">&quot;5&quot;</span>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230   defineOptionSection(<span class="stringliteral">&quot;Misc Options&quot;</span>);
<a name="l00231"></a>00231   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;explain&quot;</span>, PgOpt::STRING_OPT,
<a name="l00232"></a>00232                      <span class="stringliteral">&quot;Explain a particular operation (i.e. --explain rma-bg).&quot;</span>,
<a name="l00233"></a>00233                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   defineOptionSection(<span class="stringliteral">&quot;Advanced Options&quot;</span>);
<a name="l00236"></a>00236   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;kill-list&quot;</span>, PgOpt::STRING_OPT,
<a name="l00237"></a>00237                      <span class="stringliteral">&quot;Do not use the PM probes specified in file for computing results. &quot;</span>
<a name="l00238"></a>00238                      <span class="stringliteral">&quot;[experimental]&quot;</span>,
<a name="l00239"></a>00239                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   defineOptionSection(<span class="stringliteral">&quot;Execution Control Options&quot;</span>);
<a name="l00242"></a>00242   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;use-disk&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00243"></a>00243                      <span class="stringliteral">&quot;Store CEL intensities to be analyzed on disk.&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>);
<a name="l00244"></a>00244   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;disk-cache&quot;</span>, PgOpt::INT_OPT,
<a name="l00245"></a>00245                      <span class="stringliteral">&quot;Size of intensity memory cache in millions of intensities (when --use-disk=true).&quot;</span>,
<a name="l00246"></a>00246                      <span class="stringliteral">&quot;50&quot;</span>);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   defineOptionSection(<span class="stringliteral">&quot;A5 output options&quot;</span>);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-global-file&quot;</span>,PgOpt::STRING_OPT,
<a name="l00251"></a>00251                      <span class="stringliteral">&quot;Filename for the A5 global output file. &quot;</span>
<a name="l00252"></a>00252                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00253"></a>00253                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00254"></a>00254   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-global-file-no-replace&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00255"></a>00255                      <span class="stringliteral">&quot;Append or create rather than replace. &quot;</span>
<a name="l00256"></a>00256                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00257"></a>00257                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00258"></a>00258   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-group&quot;</span>,PgOpt::STRING_OPT,
<a name="l00259"></a>00259                      <span class="stringliteral">&quot;Group name where to put results in the A5 output files. &quot;</span>
<a name="l00260"></a>00260                      <span class="stringliteral">&quot;Defaults to &#39;/&#39;. &quot;</span>
<a name="l00261"></a>00261                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00262"></a>00262                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00263"></a>00263   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;a5-summaries&quot;</span>, PgOpt::BOOL_OPT,
<a name="l00264"></a>00264                      <span class="stringliteral">&quot;Output the summary values from the quantifcation method for each allele in A5 format. &quot;</span>
<a name="l00265"></a>00265                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00266"></a>00266                     <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00267"></a>00267   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-summaries-use-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00268"></a>00268                      <span class="stringliteral">&quot;Use the global A5 file for summaries. &quot;</span>
<a name="l00269"></a>00269                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00270"></a>00270                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00271"></a>00271   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00272"></a>00272                      <span class="stringliteral">&quot;Output feature effects in A5 format. &quot;</span>
<a name="l00273"></a>00273                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00274"></a>00274                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00275"></a>00275   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects-use-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00276"></a>00276                      <span class="stringliteral">&quot;Use the global A5 file for feature effects.&quot;</span>
<a name="l00277"></a>00277                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00278"></a>00278                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00279"></a>00279   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-details&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00280"></a>00280                      <span class="stringliteral">&quot;Output feature level residuals in A5 format. &quot;</span>
<a name="l00281"></a>00281                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00282"></a>00282                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00283"></a>00283   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-details-use-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00284"></a>00284                      <span class="stringliteral">&quot;Use the global A5 file for residuals. &quot;</span>
<a name="l00285"></a>00285                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00286"></a>00286                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00287"></a>00287   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00288"></a>00288                      <span class="stringliteral">&quot;Output normalization sketch in A5 format. &quot;</span>
<a name="l00289"></a>00289                      <span class="stringliteral">&quot;--write-sketch option will override this option. &quot;</span>
<a name="l00290"></a>00290                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00291"></a>00291                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00292"></a>00292   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch-use-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00293"></a>00293                      <span class="stringliteral">&quot;Put the sketch in the global A5 output file. &quot;</span>
<a name="l00294"></a>00294                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00295"></a>00295                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00296"></a>00296   
<a name="l00297"></a>00297   defineOptionSection(<span class="stringliteral">&quot;A5 input options&quot;</span>);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-global-input-file&quot;</span>,PgOpt::STRING_OPT,
<a name="l00300"></a>00300                      <span class="stringliteral">&quot;Filename for the group in the global input file.&quot;</span>
<a name="l00301"></a>00301                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00302"></a>00302                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00303"></a>00303   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-input-group&quot;</span>,PgOpt::STRING_OPT,
<a name="l00304"></a>00304                      <span class="stringliteral">&quot;Group name for input. Defaults to --a5-group or if that &quot;</span>
<a name="l00305"></a>00305                      <span class="stringliteral">&quot;is not set, then &#39;/&#39;. &quot;</span>
<a name="l00306"></a>00306                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00307"></a>00307                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch-input-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00310"></a>00310                      <span class="stringliteral">&quot;Read the sketch from the global A5 input file. &quot;</span>
<a name="l00311"></a>00311                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00312"></a>00312                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00313"></a>00313   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch-input-file&quot;</span>,PgOpt::STRING_OPT,
<a name="l00314"></a>00314                      <span class="stringliteral">&quot;Read the sketch from the an A5 input file. &quot;</span>
<a name="l00315"></a>00315                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00316"></a>00316                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00317"></a>00317   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch-input-group&quot;</span>,PgOpt::STRING_OPT,
<a name="l00318"></a>00318                      <span class="stringliteral">&quot;Group name to read the sketch from. Defaults to --a5-input-group. &quot;</span>
<a name="l00319"></a>00319                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00320"></a>00320                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00321"></a>00321   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-sketch-input-name&quot;</span>,PgOpt::STRING_OPT,
<a name="l00322"></a>00322                      <span class="stringliteral">&quot;The name of the data section. Defaults to &#39;target-sketch&#39;. &quot;</span>
<a name="l00323"></a>00323                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00324"></a>00324                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects-input-global&quot;</span>,PgOpt::BOOL_OPT,
<a name="l00327"></a>00327                      <span class="stringliteral">&quot;Read the feature effects global A5 input file. &quot;</span>
<a name="l00328"></a>00328                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00329"></a>00329                      <span class="stringliteral">&quot;false&quot;</span>);
<a name="l00330"></a>00330   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects-input-file&quot;</span>,PgOpt::STRING_OPT,
<a name="l00331"></a>00331                      <span class="stringliteral">&quot;Read the feature effects from the an A5 input file. &quot;</span>
<a name="l00332"></a>00332                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00333"></a>00333                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00334"></a>00334   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects-input-group&quot;</span>,PgOpt::STRING_OPT,
<a name="l00335"></a>00335                      <span class="stringliteral">&quot;Group name to read the feature effects from. Defaults to --a5-input-group. &quot;</span>
<a name="l00336"></a>00336                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00337"></a>00337                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00338"></a>00338   defineOption(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;a5-feature-effects-input-name&quot;</span>,PgOpt::STRING_OPT,
<a name="l00339"></a>00339                      <span class="stringliteral">&quot;The name of the data section. Defaults to XXX.feature-response &quot;</span>
<a name="l00340"></a>00340                      <span class="stringliteral">&quot;where XXX is the analysis name and quant method. IE &#39;brlmm-p.plier&#39;. &quot;</span>
<a name="l00341"></a>00341                      <span class="stringliteral">&quot;[Experimental]&quot;</span>,
<a name="l00342"></a>00342                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   defineOptionSection(<span class="stringliteral">&quot;Engine Options (Not used on command line)&quot;</span>);
<a name="l00345"></a>00345   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;cels&quot;</span>, PgOpt::STRING_OPT,
<a name="l00346"></a>00346                      <span class="stringliteral">&quot;Cel files to process.&quot;</span>,
<a name="l00347"></a>00347                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00348"></a>00348   defOptMult(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;result-files&quot;</span>, PgOpt::STRING_OPT,
<a name="l00349"></a>00349                      <span class="stringliteral">&quot;CHP file names to output. Must be paired with cels.&quot;</span>,
<a name="l00350"></a>00350                      <span class="stringliteral">&quot;&quot;</span>);
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::defineStates() {
<a name="l00354"></a>00354   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;num-rows&quot;</span>, PgOpt::INT_OPT,
<a name="l00355"></a>00355                      <span class="stringliteral">&quot;The number of rows on the chip.&quot;</span>,
<a name="l00356"></a>00356                      <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00357"></a>00357   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;num-cols&quot;</span>, PgOpt::INT_OPT,
<a name="l00358"></a>00358                      <span class="stringliteral">&quot;The number of cols on the chip.&quot;</span>,
<a name="l00359"></a>00359                      <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00360"></a>00360   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probe-count&quot;</span>, PgOpt::INT_OPT,
<a name="l00361"></a>00361                      <span class="stringliteral">&quot;The number of probes on the chip.&quot;</span>,
<a name="l00362"></a>00362                      <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00363"></a>00363   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;probeset-count&quot;</span>, PgOpt::INT_OPT,
<a name="l00364"></a>00364                      <span class="stringliteral">&quot;The number of probesets on the chip.&quot;</span>,
<a name="l00365"></a>00365                      <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00366"></a>00366   defineOption(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;channel-count&quot;</span>, PgOpt::INT_OPT,
<a name="l00367"></a>00367                      <span class="stringliteral">&quot;The number of data channels in the CEL file.&quot;</span>,
<a name="l00368"></a>00368                      <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::makeSpfFile(std::string inSpf, std::string outSpf, vector&lt;MetaProbeset *&gt; metaSets) {
<a name="l00373"></a>00373   <a class="code" href="classaffx_1_1SpfFile.html">SpfFile</a> tsv;
<a name="l00374"></a>00374   <span class="keywordtype">int</span> count = 0;
<a name="l00375"></a>00375   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;name&quot;</span>);
<a name="l00376"></a>00376   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l00377"></a>00377   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;num_blocks&quot;</span>);
<a name="l00378"></a>00378   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;block_sizes&quot;</span>);
<a name="l00379"></a>00379   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;block_annotations&quot;</span>);
<a name="l00380"></a>00380   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;num_match&quot;</span>);
<a name="l00381"></a>00381   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;num_probes&quot;</span>);
<a name="l00382"></a>00382   tsv.<a class="code" href="classaffx_1_1TsvFile.html#aadc22863a63b9c6588b0f2dc61875809" title="User methods.">defineColumn</a>(0, count++, <span class="stringliteral">&quot;probes&quot;</span>);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   tsv.<a class="code" href="classaffx_1_1TsvFile.html#a1903489904b4e2f8f2a262b8f10cdb0e" title="Set the options up for &amp;quot;tsv&amp;quot; format and write the tsv-v1 header ///.">writeTsv_v1</a>(outSpf);
<a name="l00385"></a>00385   map&lt;string,ProbeSet *&gt; psMap;
<a name="l00386"></a>00386   <a class="code" href="classSpfReader.html" title="Class for parsing the Simple Probe Format (SPF) text files.">SpfReader</a> reader;
<a name="l00387"></a>00387   reader.<a class="code" href="classSpfReader.html#aa5c0feca8fbd080ea2e96b7939cb4d30" title="Open a text file for reading.">openSpf</a>(inSpf);
<a name="l00388"></a>00388   <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *ps = reader.<a class="code" href="classSpfReader.html#a174f88a8e62ac55b1cc63bf6b6c15b9c" title="Read the next record.">readNextProbeSet</a>();
<a name="l00389"></a>00389   <span class="keywordtype">int</span> psCount = 0;
<a name="l00390"></a>00390   <span class="keywordflow">while</span>(ps != NULL) {
<a name="l00391"></a>00391     psMap[ps-&gt;<a class="code" href="classProbeSet.html#af10b2dac78a597ec736691302687c3f3" title="Name of probe set.">name</a>] = ps;
<a name="l00392"></a>00392     ps = reader.<a class="code" href="classSpfReader.html#a174f88a8e62ac55b1cc63bf6b6c15b9c" title="Read the next record.">readNextProbeSet</a>();
<a name="l00393"></a>00393     <span class="keywordflow">if</span>(ps != NULL &amp;&amp; ps-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.size() == 0) {
<a name="l00394"></a>00394       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No atoms for: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(ps-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.size()));
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396     psCount++;
<a name="l00397"></a>00397   }
<a name="l00398"></a>00398   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; metaSets.size(); i++) {
<a name="l00399"></a>00399     <a class="code" href="classMetaProbeset.html" title="Very basic class to store the meta probesets (groups of probesets) that a user specifies for analysis...">MetaProbeset</a> *meta = metaSets[i];
<a name="l00400"></a>00400     <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> metaPs;
<a name="l00401"></a>00401     metaPs.<a class="code" href="classProbeSet.html#af10b2dac78a597ec736691302687c3f3" title="Name of probe set.">name</a> = <a class="code" href="classUtil.html#a508b7aff9569ed929945d0d37eca384e" title="Create a copy of a string.">Util::cloneString</a>(meta-&gt;name);
<a name="l00402"></a>00402     metaPs.<a class="code" href="classProbeSet.html#a6d8ed948634c42033bd0c35d2640b274" title="How many groups (or blocks) are there? Used extensively in genotyping chips.">numGroups</a> = 1;
<a name="l00403"></a>00403     metaPs.<a class="code" href="classProbeSet.html#a23b9df97be8aacc01ad21642b8c966b9" title="Number of atoms in each group, used to get the offsets into the atoms vector.">atomsPerGroup</a>.push_back(0);
<a name="l00404"></a>00404     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> psIx = 0; psIx &lt; meta-&gt;probesets.size(); psIx++) {
<a name="l00405"></a>00405       <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *currentPs = psMap[meta-&gt;probesets[psIx]];
<a name="l00406"></a>00406       <span class="keywordflow">if</span>(currentPs == NULL) {
<a name="l00407"></a>00407         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2,<span class="stringliteral">&quot;Skipping probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta-&gt;probesets[psIx]) + <span class="stringliteral">&quot; in meta probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta-&gt;name) + <span class="stringliteral">&quot;. (Due to kill list?)&quot;</span>);
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409       <span class="keywordflow">else</span> {
<a name="l00410"></a>00410         metaPs.<a class="code" href="classProbeSet.html#aa3e4170184169cc3bee6d958d74940ba" title="What type of probeset is this?">psType</a> = currentPs-&gt;<a class="code" href="classProbeSet.html#aa3e4170184169cc3bee6d958d74940ba" title="What type of probeset is this?">psType</a>;
<a name="l00411"></a>00411         addProbeSet(&amp;metaPs, currentPs);
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <span class="keywordflow">if</span>(metaPs.<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.size() == 0) {
<a name="l00415"></a>00415       <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;Skipping meta probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(metaPs.<a class="code" href="classProbeSet.html#af10b2dac78a597ec736691302687c3f3" title="Name of probe set.">name</a>) + <span class="stringliteral">&quot; as it appears all probes have been removed.&quot;</span>);
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417     <span class="keywordflow">else</span> {
<a name="l00418"></a>00418       <a class="code" href="classChipLayout.html#a839b6673df17cb18880655b81c697e3b" title="Write out a single record to the tsv file supplied.">ChipLayout::writeSpfProbeSetRecord</a>(tsv, metaPs);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420     metaPs.<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.resize(0); <span class="comment">// Atom memory is owned in the map probesets</span>
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422   map&lt;string,ProbeSet *&gt;::iterator first;
<a name="l00423"></a>00423   <span class="keywordflow">for</span>(first = psMap.begin(); first != psMap.end(); first++) {
<a name="l00424"></a>00424     <span class="keyword">delete</span> first-&gt;second;
<a name="l00425"></a>00425   }
<a name="l00426"></a>00426   tsv.<a class="code" href="classaffx_1_1TsvFile.html#ae7932be2156c04a562f327b53833aed7" title="Close the file.">close</a>();
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment"></span>
<a name="l00431"></a>00431 <span class="comment">/** </span>
<a name="l00432"></a>00432 <span class="comment"> * Make sure that our options are sane.</span>
<a name="l00433"></a>00433 <span class="comment"> * </span>
<a name="l00434"></a>00434 <span class="comment"> * @param o - Options to be checked.</span>
<a name="l00435"></a>00435 <span class="comment"> */</span>
<a name="l00436"></a>00436 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::checkOptionsImp() {
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   defineStates();
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l00441"></a>00441   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l00442"></a>00442   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>);
<a name="l00443"></a>00443   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;clf-file&quot;</span>);
<a name="l00444"></a>00444   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;bgp-file&quot;</span>);
<a name="l00445"></a>00445   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>);
<a name="l00446"></a>00446   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>);
<a name="l00447"></a>00447   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;probe-class-file&quot;</span>);
<a name="l00448"></a>00448   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;qc-probesets&quot;</span>);
<a name="l00449"></a>00449   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;use-feat-eff&quot;</span>);
<a name="l00450"></a>00450   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;target-sketch&quot;</span>);
<a name="l00451"></a>00451   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;reference-profile&quot;</span>);
<a name="l00452"></a>00452   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;kill-list&quot;</span>);
<a name="l00453"></a>00453   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;a5-global-input-file&quot;</span>);
<a name="l00454"></a>00454   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;a5-sketch-input-file&quot;</span>);
<a name="l00455"></a>00455   <a class="code" href="classBaseEngine.html#a90a5cba41ed5a3fe1b2fb9dc2896c696" title="Swap the option value to include the full path if found.">setLibFileOpt</a>(<span class="stringliteral">&quot;a5-feature-effects-input-file&quot;</span>);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;explain&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) { explain(); exit(0); }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459   <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {<a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify an output directory.&quot;</span>);}
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) { <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>, <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),<span class="stringliteral">&quot;temp&quot;</span>)); }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462   <span class="keywordtype">bool</span> cdfMode = <span class="keyword">false</span>;
<a name="l00463"></a>00463   <span class="keywordtype">bool</span> pgfMode = <span class="keyword">false</span>;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span> || <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>) 
<a name="l00466"></a>00466       cdfMode = <span class="keyword">true</span>;
<a name="l00467"></a>00467   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00468"></a>00468       pgfMode = <span class="keyword">true</span>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470   <span class="keywordflow">if</span>(cdfMode &amp;&amp; pgfMode) {
<a name="l00471"></a>00471     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify only one layout spec: cdf, pgf/clf, or spf file.&quot;</span>);
<a name="l00472"></a>00472   }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   <span class="keywordtype">string</span> cdfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l00475"></a>00475   <span class="keywordtype">string</span> spfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l00476"></a>00476   <span class="keywordtype">string</span> pgfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>);
<a name="l00477"></a>00477   <span class="keywordtype">string</span> clfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;clf-file&quot;</span>);
<a name="l00478"></a>00478   <span class="keywordtype">string</span> bgpFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;bgp-file&quot;</span>);
<a name="l00479"></a>00479   <span class="keywordtype">string</span> killListFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;kill-list&quot;</span>);
<a name="l00480"></a>00480   vector&lt;string&gt; analysis = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;analysis&quot;</span>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482   <span class="comment">// Check that a global file was given if the user wants global a5 output</span>
<a name="l00483"></a>00483   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-global-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00484"></a>00484       vector&lt;string&gt; optionNames;
<a name="l00485"></a>00485       getOptionNames(optionNames);
<a name="l00486"></a>00486       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;optionNames.size(); i++) {
<a name="l00487"></a>00487           <span class="keywordtype">string</span> name = optionNames[i];
<a name="l00488"></a>00488           <span class="keywordflow">if</span>( name.find(<span class="stringliteral">&quot;use-global&quot;</span>) != name.npos ) {
<a name="l00489"></a>00489               <span class="keywordflow">if</span>( <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(name) ) {
<a name="l00490"></a>00490                   <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;--&quot;</span> + name + <span class="stringliteral">&quot; option given, but no global file. Must specify --a5-global-file.&quot;</span>);
<a name="l00491"></a>00491               }
<a name="l00492"></a>00492           }
<a name="l00493"></a>00493       }
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495   <span class="comment">// Check that a global input file was given if the user wants global a5 input</span>
<a name="l00496"></a>00496   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-global-input-file&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00497"></a>00497       vector&lt;string&gt; optionNames;
<a name="l00498"></a>00498       getOptionNames(optionNames);
<a name="l00499"></a>00499       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;optionNames.size(); i++) {
<a name="l00500"></a>00500           <span class="keywordtype">string</span> name = optionNames[i];
<a name="l00501"></a>00501           <span class="keywordflow">if</span>( name.find(<span class="stringliteral">&quot;input-global&quot;</span>) != name.npos ) {
<a name="l00502"></a>00502               <span class="keywordflow">if</span>( <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(name) ){
<a name="l00503"></a>00503                   <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;--&quot;</span> + name + <span class="stringliteral">&quot; option given, but no global input file. Must specify --a5-global-input-file.&quot;</span>);
<a name="l00504"></a>00504               }
<a name="l00505"></a>00505           }
<a name="l00506"></a>00506       }
<a name="l00507"></a>00507   }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="comment">// make sure global input and output files are different</span>
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-global-input-file&quot;</span>) == <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-global-file&quot;</span>))
<a name="l00511"></a>00511       <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-global-input-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00512"></a>00512           <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Unable to use the same A5 file for global input and output.&quot;</span>);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514   <span class="comment">/* Read in cel file list from other file if specified. */</span>
<a name="l00515"></a>00515   vector&lt;string&gt; celFiles;
<a name="l00516"></a>00516   EngineUtil::getCelFiles(celFiles, <span class="keyword">this</span>);
<a name="l00517"></a>00517   <span class="keywordflow">if</span>(celFiles.size() == 0)
<a name="l00518"></a>00518       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;No cel files specified.&quot;</span>);
<a name="l00519"></a>00519   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;cels&quot;</span>,celFiles);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   vector&lt;string&gt; resultFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>);
<a name="l00522"></a>00522   <span class="keywordflow">if</span>(resultFiles.size() &gt; 0) {
<a name="l00523"></a>00523       <span class="keywordflow">if</span>(celFiles.size() != resultFiles.size())
<a name="l00524"></a>00524         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;result-files option used but is not the same size as cel file listing&quot;</span>);
<a name="l00525"></a>00525       <span class="keywordtype">bool</span> ccOut = <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-chp-output&quot;</span>);
<a name="l00526"></a>00526       <span class="keywordtype">bool</span> mdOut = <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;md-chp-output&quot;</span>);
<a name="l00527"></a>00527       <span class="keywordtype">bool</span> xdaOut = <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>);
<a name="l00528"></a>00528       <span class="keywordflow">if</span>((ccOut &amp;&amp; mdOut) || (ccOut &amp;&amp; xdaOut) || (mdOut &amp;&amp; xdaOut)) 
<a name="l00529"></a>00529           <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;cannot use multiple CHP output formats with the result-files option&quot;</span>);
<a name="l00530"></a>00530   }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="keywordflow">if</span>((cdfMode) &amp;&amp; (cdfFile==<span class="stringliteral">&quot;&quot;</span> &amp;&amp; spfFile==<span class="stringliteral">&quot;&quot;</span>)) {
<a name="l00533"></a>00533     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify a layout file like cdf, spf, or pgf/clf files.&quot;</span>);
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535   <span class="keywordflow">if</span>((!cdfMode || pgfMode) &amp;&amp; <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>)) {
<a name="l00536"></a>00536     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must use a CDF file to generate an XDA CHP file.&quot;</span>);
<a name="l00537"></a>00537   }
<a name="l00538"></a>00538   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>)) {
<a name="l00539"></a>00539     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify a subset and XDA CHP output at same time. Must analyze all probesets for XDA CHP file output.&quot;</span>);
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541   <span class="keywordflow">if</span>(killListFile != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; !pgfMode &amp;&amp; cdfFile == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00542"></a>00542     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t use a kill list with spf file&quot;</span>);
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <span class="keywordflow">if</span>(killListFile != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>)) {
<a name="l00545"></a>00545     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify a kill list and XDA CHP output at same time.&quot;</span>);
<a name="l00546"></a>00546   }
<a name="l00547"></a>00547   <span class="keywordflow">if</span>(killListFile != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-md-chp-output&quot;</span>)) {
<a name="l00548"></a>00548     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify a kill list and Expression CC CHP output at same time.&quot;</span>);
<a name="l00549"></a>00549   }
<a name="l00550"></a>00550   <span class="keywordflow">if</span>(killListFile != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-chp-output&quot;</span>)) {
<a name="l00551"></a>00551     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify a kill list and Multi Data CC CHP output at same time.&quot;</span>);
<a name="l00552"></a>00552   }
<a name="l00553"></a>00553   <span class="keywordflow">if</span>(bgpFile!=<span class="stringliteral">&quot;&quot;</span> &amp;&amp; !pgfMode)
<a name="l00554"></a>00554     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can only use BGP file with PGF/CLF file. Not CDF or SPF.&quot;</span>);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556   <span class="comment">/* Some sanity checks. */</span>
<a name="l00557"></a>00557   <span class="keywordflow">if</span>(analysis.empty())
<a name="l00558"></a>00558       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify at least one analysis to preform.&quot;</span>);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00561"></a>00561       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify both probeset-ids and meta-probesets options.&quot;</span>);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563   <span class="comment">// Check chip types</span>
<a name="l00564"></a>00564   vector&lt;string&gt; chipTypesInLayout;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">/* Get the intial info about the chip and check cel files to make sure</span>
<a name="l00567"></a>00567 <span class="comment">     they match. */</span>
<a name="l00568"></a>00568   <a class="code" href="AptTypes_8h.html#a6b6d41ded05bd1136b17fa18be0d744f" title="For row and column indexes.">colrow_t</a> numRows = 0, numCols = 0;
<a name="l00569"></a>00569   <span class="keywordtype">int</span> probeCount = 0;
<a name="l00570"></a>00570   <span class="keywordtype">int</span> probeSetCount=0;
<a name="l00571"></a>00571   <span class="keywordtype">int</span> channelCount = 1;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="keywordflow">if</span>(cdfFile!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00574"></a>00574       <a class="code" href="classEngineUtil.html#ade4ca714ab18a0ec35750acb9223cb4f" title="Open up a cdf file and get the chip type (i.e.">EngineUtil::getCdfChipType</a>(chipTypesInLayout, numRows, numCols, probeCount, probeSetCount, cdfFile);
<a name="l00575"></a>00575   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(spfFile!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00576"></a>00576       <a class="code" href="classEngineUtil.html#a983c94e51a248918b98899f262f3e11a" title="Open up a spf (simple probe format) file and read the valid chiptypes (i.e.">EngineUtil::getSpfChipType</a>(chipTypesInLayout, numRows, numCols, probeCount, probeSetCount, spfFile);
<a name="l00577"></a>00577   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pgfMode) 
<a name="l00578"></a>00578       <a class="code" href="classEngineUtil.html#a8adfbeffd36db9cfb395df00d23a88d5" title="Open up a pgf and clf file pair and read the valid chiptypes (i.e.">EngineUtil::getPgfChipType</a>(chipTypesInLayout, numRows, numCols, probeCount, pgfFile, clfFile);
<a name="l00579"></a>00579   <span class="keywordflow">else</span>
<a name="l00580"></a>00580       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify a cdf file, spf file, or PGF and CLF files.&quot;</span>);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;num-rows&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(numRows));
<a name="l00583"></a>00583   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;num-cols&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(numCols));
<a name="l00584"></a>00584   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probe-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(probeCount));
<a name="l00585"></a>00585   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;probeset-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(probeSetCount));
<a name="l00586"></a>00586   <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;channel-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(channelCount));
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <span class="keywordflow">if</span>(chipTypesInLayout.empty() || chipTypesInLayout[0] == <span class="stringliteral">&quot;&quot;</span> || probeCount == 0) 
<a name="l00589"></a>00589       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Problem determining ChipType in file: &quot;</span> + 
<a name="l00590"></a>00590               ( cdfFile != <span class="stringliteral">&quot;&quot;</span> ? cdfFile : 
<a name="l00591"></a>00591                     ( spfFile != <span class="stringliteral">&quot;&quot;</span> ? spfFile : pgfFile + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;, &quot;</span>) + clfFile) 
<a name="l00592"></a>00592               ) );
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   <span class="comment">/* Did the user &quot;force&quot; a set of chip types via options? */</span>
<a name="l00595"></a>00595   vector&lt;string&gt; chipTypesSupplied = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;chip-type&quot;</span>);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 
<a name="l00598"></a>00598   <span class="comment">/* Figure out what chip type to report */</span>
<a name="l00599"></a>00599   <span class="keywordflow">if</span>(chipTypesSupplied.size() &gt; 0) {
<a name="l00600"></a>00600       <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chip-type&quot;</span>, chipTypesSupplied[0]);
<a name="l00601"></a>00601   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(chipTypesInLayout.size() &gt; 0) {
<a name="l00602"></a>00602       <a class="code" href="classOptions.html#aaf215b45e7097fcedae68c15073eb0f8" title="Set option value.">setOpt</a>(<span class="stringliteral">&quot;chip-type&quot;</span>, chipTypesInLayout[0]);
<a name="l00603"></a>00603   } <span class="keywordflow">else</span> {
<a name="l00604"></a>00604       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Unable to figure out a chip type.&quot;</span>);
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="comment">/* Do Chip Type Check */</span>
<a name="l00608"></a>00608   <span class="keywordflow">if</span>(!<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;force&quot;</span>)) {
<a name="l00609"></a>00609     <span class="keywordflow">if</span>(chipTypesSupplied.size() &gt; 0) {
<a name="l00610"></a>00610         <a class="code" href="classEngineUtil.html#a952a57d44838690761d2f0bd28cd7a16" title="Check to make sure all the cel files are compatible with the chiptypes supported and number or probes...">EngineUtil::checkCelChipTypes</a>(chipTypesSupplied, probeCount, celFiles, numRows, numCols);
<a name="l00611"></a>00611         <a class="code" href="classEngineUtil.html#a6b5c169d7d42f87da86f31f675df557a" title="Check to make sure that there is at least one match between the two vectors of chip types...">EngineUtil::checkChipTypeVectors</a>(chipTypesSupplied, chipTypesInLayout);
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613     <span class="keywordflow">else</span> {
<a name="l00614"></a>00614         <a class="code" href="classEngineUtil.html#a952a57d44838690761d2f0bd28cd7a16" title="Check to make sure all the cel files are compatible with the chiptypes supported and number or probes...">EngineUtil::checkCelChipTypes</a>(chipTypesInLayout, probeCount, celFiles, numRows, numCols);
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616   }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::initializeAsFactory(<a class="code" href="classAnalysisStreamFactory.html" title="Object for making new analysis streams from a text specification.">AnalysisStreamFactory</a> &amp;asFactory, <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> *layout) {
<a name="l00621"></a>00621   AnalysisStreamFactory::setupAnalysisStreamFactory(
<a name="l00622"></a>00622                                                     asFactory,
<a name="l00623"></a>00623                                                     m_a5_global_input_file,
<a name="l00624"></a>00624                                                     m_a5_global_input_group,
<a name="l00625"></a>00625                                                     m_a5_global_output_file,
<a name="l00626"></a>00626                                                     m_a5_global_output_group,
<a name="l00627"></a>00627                                                     <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>).size(),
<a name="l00628"></a>00628                                                     <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;probe-count&quot;</span>),
<a name="l00629"></a>00629                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>),
<a name="l00630"></a>00630                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;write-sketch&quot;</span>),
<a name="l00631"></a>00631                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;target-sketch&quot;</span>),
<a name="l00632"></a>00632 
<a name="l00633"></a>00633                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;write-profile&quot;</span>),
<a name="l00634"></a>00634                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-profile&quot;</span>),
<a name="l00635"></a>00635 
<a name="l00636"></a>00636                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-sketch&quot;</span>),
<a name="l00637"></a>00637                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-sketch-use-global&quot;</span>),
<a name="l00638"></a>00638 
<a name="l00639"></a>00639                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-sketch-input-global&quot;</span>),
<a name="l00640"></a>00640                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-sketch-input-file&quot;</span>),
<a name="l00641"></a>00641                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-sketch-input-name&quot;</span>),
<a name="l00642"></a>00642                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-sketch-input-group&quot;</span>),
<a name="l00643"></a>00643 
<a name="l00644"></a>00644                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;use-feat-eff&quot;</span>),
<a name="l00645"></a>00645                                                     <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-effects-input-global&quot;</span>),
<a name="l00646"></a>00646                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-feature-effects-input-file&quot;</span>),
<a name="l00647"></a>00647                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-feature-effects-input-name&quot;</span>),
<a name="l00648"></a>00648                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-feature-effects-input-group&quot;</span>),
<a name="l00649"></a>00649 
<a name="l00650"></a>00650                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-input-group&quot;</span>),
<a name="l00651"></a>00651                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;a5-group&quot;</span>),
<a name="l00652"></a>00652 
<a name="l00653"></a>00653                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>),<span class="comment"></span>
<a name="l00654"></a>00654 <span class="comment">                                                    ///@todo bit of a hack -- assumes a simple string search for med-polish or plier</span>
<a name="l00655"></a>00655 <span class="comment"></span>                                                    <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;analysis&quot;</span>)[0],
<a name="l00656"></a>00656 
<a name="l00657"></a>00657                                                     <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;bgp-file&quot;</span>),
<a name="l00658"></a>00658                                                     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// getOpt(&quot;annotation-file&quot;)</span>
<a name="l00659"></a>00659                                                     *layout
<a name="l00660"></a>00660                                                     );
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::setupMask(<a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> *layout, map&lt;<span class="keywordtype">string</span>, vector&lt;bool&gt; &gt; masks, <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> &amp;probeInfo) {
<a name="l00664"></a>00664   vector&lt;bool&gt; pmMask = layout-&gt;<a class="code" href="classChipLayout.html#a89a176316f133918aabd5c57cf7513dc" title="Get the perfect match probes of chip.">getPmProbeMask</a>();
<a name="l00665"></a>00665   masks[<span class="stringliteral">&quot;pm&quot;</span>] = pmMask;
<a name="l00666"></a>00666   
<a name="l00667"></a>00667   vector&lt;bool&gt; mmMask = layout-&gt;<a class="code" href="classChipLayout.html#acf692a48afbf6855003b04fd60105231" title="Get the perfect match probes of chip.">getMmProbeMask</a>();
<a name="l00668"></a>00668   <span class="keywordtype">int</span> mmCount = 0;
<a name="l00669"></a>00669   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;mmMask.size(); i++)
<a name="l00670"></a>00670     <span class="keywordflow">if</span>(mmMask[i])
<a name="l00671"></a>00671       mmCount++;
<a name="l00672"></a>00672   <span class="keywordflow">if</span>(mmCount &gt; 5000) {
<a name="l00673"></a>00673     masks[<span class="stringliteral">&quot;mm&quot;</span>] = mmMask;
<a name="l00674"></a>00674   }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676   <span class="keywordflow">if</span>(probeInfo.isSetProbeGcBgrd()) {
<a name="l00677"></a>00677     vector&lt;int&gt; gcControlProbes;
<a name="l00678"></a>00678     probeInfo.getGcControlProbes(gcControlProbes);
<a name="l00679"></a>00679     vector&lt;bool&gt; bgMask(pmMask.size(), <span class="keyword">false</span>);
<a name="l00680"></a>00680     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> probeIx = 0; probeIx != gcControlProbes.size(); probeIx++) {
<a name="l00681"></a>00681       bgMask[gcControlProbes[probeIx]] = <span class="keyword">true</span>;
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683     masks[<span class="stringliteral">&quot;bgrd&quot;</span>] = bgMask;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::readMetaProbesets(vector&lt;MetaProbeset *&gt; &amp;metaSets) {
<a name="l00689"></a>00689   <span class="keywordtype">bool</span> metaFile = <span class="keyword">false</span>;
<a name="l00690"></a>00690   <span class="keywordtype">string</span> fileName;
<a name="l00691"></a>00691   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00692"></a>00692     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Can&#39;t specify both probeset-ids and meta-probesets options.&quot;</span>);
<a name="l00693"></a>00693   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00694"></a>00694     fileName = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>); 
<a name="l00695"></a>00695     metaFile = <span class="keyword">true</span>;
<a name="l00696"></a>00696   }
<a name="l00697"></a>00697   <span class="keywordflow">else</span> {
<a name="l00698"></a>00698     fileName = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>);
<a name="l00699"></a>00699     metaFile = <span class="keyword">false</span>;
<a name="l00700"></a>00700   }
<a name="l00701"></a>00701   <a class="code" href="classMetaProbeset.html#a58917ef4bdbdf7d7390d33c6ef5dfc5c" title="Open a file that could be either a meta probesets file or a subset list of probesets and fill in the ...">MetaProbeset::readMetaProbesets</a>(fileName, metaFile, metaSets);
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::fillInLayout(<a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> **cLayout, <span class="keywordtype">string</span> &amp;spfFile, 
<a name="l00705"></a>00705                                                 <span class="keywordtype">string</span> &amp;spfFileOrig, vector&lt;MetaProbeset *&gt; &amp;metaSets,
<a name="l00706"></a>00706                                                 std::vector&lt;const char *&gt; &amp;probesetNames) {
<a name="l00707"></a>00707   <span class="keywordtype">string</span> metaSpfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) + <span class="stringliteral">&quot;/meta.temp.spf&quot;</span>;  
<a name="l00708"></a>00708   vector&lt;bool&gt; probeSubset;
<a name="l00709"></a>00709   *cLayout = <span class="keyword">new</span> <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a>();
<a name="l00710"></a>00710   <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> *layout = *cLayout;<span class="comment"></span>
<a name="l00711"></a>00711 <span class="comment">  ///@todo we only need this if pm-sum is used</span>
<a name="l00712"></a>00712 <span class="comment"></span>  layout-&gt;setNeedPmAlleleMatch(<span class="keyword">true</span>); 
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="keywordflow">if</span>(spfFile == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00715"></a>00715     spfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) + <span class="stringliteral">&quot;/temp.spf&quot;</span>;
<a name="l00716"></a>00716     layout-&gt;<a class="code" href="classChipLayout.html#a0b10d849da26399a8988ea184e2161b6" title="Set the name of the spf output file ///.">setSpfFileName</a>(spfFile);
<a name="l00717"></a>00717   }
<a name="l00718"></a>00718   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numRows = <a class="code" href="classConvert.html#ac012fd4fbad9f297e7d6dddf4049d0a9" title="Make an unsigned int from a c string or die trying.">Convert::toUnsignedInt</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;num-rows&quot;</span>));
<a name="l00719"></a>00719   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numCols = <a class="code" href="classConvert.html#ac012fd4fbad9f297e7d6dddf4049d0a9" title="Make an unsigned int from a c string or die trying.">Convert::toUnsignedInt</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;num-cols&quot;</span>)); 
<a name="l00720"></a>00720 
<a name="l00721"></a>00721   <span class="comment">// Load up probes to ignore</span>
<a name="l00722"></a>00722   probeidmap_t killList; <span class="comment">// map of probe IDs to exclude</span>
<a name="l00723"></a>00723   <span class="keywordtype">string</span> killListFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;kill-list&quot;</span>); 
<a name="l00724"></a>00724   <span class="keywordflow">if</span>(killListFile != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00725"></a>00725     <a class="code" href="classChipLayout.html#a70bd6b3376288c01eec760251fc86ece" title="Reads in probes to kill.">ChipLayout::fillInKillList</a>(killListFile, killList, numRows, numCols);
<a name="l00726"></a>00726   }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <span class="comment">// If we have a subset or meta probeset list then read it.</span>
<a name="l00729"></a>00729   <span class="keywordtype">bool</span> haveMetaProbeset = (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> || <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>); 
<a name="l00730"></a>00730   <span class="keywordflow">if</span>(haveMetaProbeset) {
<a name="l00731"></a>00731     readMetaProbesets(metaSets);
<a name="l00732"></a>00732   }
<a name="l00733"></a>00733   <span class="comment">// To satisfy the function signature we create an empty set of Probes.</span>
<a name="l00734"></a>00734   std::vector&lt;Probe *&gt; emptySetOfProbes;      
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;About to load chip layout.&quot;</span>);
<a name="l00737"></a>00737   <span class="comment">// will fill in metaSets if empty</span>
<a name="l00738"></a>00738   loadChipLayout( *layout, metaSets, killList, &amp;probesetNames,
<a name="l00739"></a>00739                   emptySetOfProbes, probeSubset, <span class="keyword">true</span>, <span class="keyword">false</span>); 
<a name="l00740"></a>00740   <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;Done loading chip layout.&quot;</span>);
<a name="l00741"></a>00741   <span class="keywordflow">if</span>(haveMetaProbeset) {
<a name="l00742"></a>00742     makeSpfFile(spfFile, metaSpfFile, metaSets);
<a name="l00743"></a>00743     <span class="keywordflow">if</span>(spfFile != spfFileOrig) {
<a name="l00744"></a>00744       <a class="code" href="classFs.html#a6b8f232817f933a42c21edde6ea55a3a" title="An error if it doesnt exist.">Fs::rm</a>(spfFile, <span class="keyword">false</span>); 
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746     spfFile = metaSpfFile; 
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::runChipStreamStage(<a class="code" href="classAnalysisStage.html">AnalysisStage</a> &amp;stage, <a class="code" href="classPsBoard.html">PsBoard</a> &amp;board, 
<a name="l00752"></a>00752                                                       <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> &amp;in, <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> &amp;out) {
<a name="l00753"></a>00753   <span class="comment">// Make the a legacy chipstream object from factory.</span>
<a name="l00754"></a>00754   <a class="code" href="classChipStreamFactory.html" title="Factory class for making chip streams based on a string representation.">ChipStreamFactory</a> csFactory;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   <span class="comment">//  stage.spec is something like &#39;quant-norm.sketch=0&#39;</span>
<a name="l00757"></a>00757   <a class="code" href="classChipStream.html" title="ChipStream - base class for objects that can initialize themselves one at a time and transform intens...">ChipStream</a> *trans = csFactory.<a class="code" href="classChipStreamFactory.html#a0e86349b0d69f3b5b381295724a0b3e5" title="Factory for making ChipStreams from a string description.">chipStreamForStringBoard</a>(board, stage.spec, stage.name);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <span class="comment">// Wrap the chipstream object as a data transform stage</span>
<a name="l00760"></a>00760   <a class="code" href="classChipStreamDataTransform.html" title="Wrapper for ChipStream objects that makes them into DataTransform objects.">ChipStreamDataTransform</a> *csStage = <span class="keyword">new</span> <a class="code" href="classChipStreamDataTransform.html" title="Wrapper for ChipStream objects that makes them into DataTransform objects.">ChipStreamDataTransform</a>(trans);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <span class="comment">// Do transformation and blackboard updates as necessary.</span>
<a name="l00763"></a>00763   csStage-&gt;<a class="code" href="classChipStreamDataTransform.html#a87010c69e83dc92338472a1328157e98" title="Core API.">transformData</a>(board, in, out);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="comment">// Cleanup</span>
<a name="l00766"></a>00766   <span class="keyword">delete</span> csStage;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::runQuantificationStage(<a class="code" href="classAnalysisStage.html">AnalysisStage</a> &amp;stage, <a class="code" href="classPsBoard.html">PsBoard</a> &amp;board, 
<a name="l00770"></a>00770                                                           <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> &amp;in,
<a name="l00771"></a>00771                                                           std::vector&lt;QuantMethodReport *&gt; &amp;reporters,
<a name="l00772"></a>00772                                                           <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> &amp;info, QuantMethodFactory::QuantType type,
<a name="l00773"></a>00773                                                           vector&lt;MetaProbeset *&gt; &amp;metaSets,
<a name="l00774"></a>00774                                                           <a class="code" href="classCelStatListener.html" title="Class for objects that need to actually access real cel file data.">CelStatListener</a> *celStats,
<a name="l00775"></a>00775                                                           <span class="keyword">const</span> std::string &amp;spfFile) {
<a name="l00776"></a>00776   
<a name="l00777"></a>00777   vector&lt;string&gt; words;
<a name="l00778"></a>00778   <a class="code" href="classUtil.html#ac0aefd5694432916da36f4f2cfe8bd76" title="Chop up a string into a vector of words.">Util::chopString</a>(stage.spec, <span class="charliteral">&#39;,&#39;</span>, words);
<a name="l00779"></a>00779   <span class="comment">// words[0] is pm adjuster specification (e.g. &#39;pm-only&#39;) </span>
<a name="l00780"></a>00780   <span class="comment">// and words[1] is quantification specification (e.g. &#39;med-polish)</span>
<a name="l00781"></a>00781   <a class="code" href="classQuantDataTransform.html">QuantDataTransform</a> quantify(type, board, reporters, words[0], words[1], spfFile);
<a name="l00782"></a>00782   <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *qMethod = NULL;
<a name="l00783"></a>00783   qMethod = quantify.getQuantMethod();
<a name="l00784"></a>00784   <span class="comment">// Load up reporters specified for this analysis</span>
<a name="l00785"></a>00785   setupReporters(reporters, info, qMethod, metaSets, celStats);
<a name="l00786"></a>00786   <span class="comment">// @todo - This bit about headers should probably be happening in the QuantDataTransform</span>
<a name="l00787"></a>00787   writeHeaders(in, qMethod, reporters, info);
<a name="l00788"></a>00788   board.set(<span class="stringliteral">&quot;num-probesets&quot;</span>, info.<a class="code" href="classAnalysisInfo.html#ac85efbbb6618cb87c39511af32c311a7" title="How many probesets are on the chip and in cdf file. This is /// critical as probesets must be the exa...">m_NumProbeSets</a>);
<a name="l00789"></a>00789   quantify.setReporters(reporters);
<a name="l00790"></a>00790   quantify.transformData(board, in, in);
<a name="l00791"></a>00791   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; reporters.size(); i++) {
<a name="l00792"></a>00792       reporters[i]-&gt;finish(*qMethod);
<a name="l00793"></a>00793   }
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795                                             
<a name="l00796"></a>00796 <span class="comment"></span>
<a name="l00797"></a>00797 <span class="comment">/** </span>
<a name="l00798"></a>00798 <span class="comment"> * @brief High level function to set up analysis streams and then</span>
<a name="l00799"></a>00799 <span class="comment"> * start the gears turning.</span>
<a name="l00800"></a>00800 <span class="comment"> * </span>
<a name="l00801"></a>00801 <span class="comment"> * @param asFactory - Object for making analysis streams.</span>
<a name="l00802"></a>00802 <span class="comment"> * @param errMsg - If there was a problem, error message gets filled in here.</span>
<a name="l00803"></a>00803 <span class="comment"> * @return true if successful, false otherwise.</span>
<a name="l00804"></a>00804 <span class="comment"> */</span>
<a name="l00805"></a>00805 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::runImp() {
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <span class="comment">// probeset names act as a common pool for a number of different</span>
<a name="l00808"></a>00808   <span class="comment">// things so we don&#39;t have to copy the relatively large (in RAM)</span>
<a name="l00809"></a>00809   <span class="comment">// probe names over and over. They are known to be used for the chp</span>
<a name="l00810"></a>00810   <span class="comment">// file writers and meta probesets, but may also be used for other</span>
<a name="l00811"></a>00811   <span class="comment">// things as time goes on. Change or delete them prematurely at your</span>
<a name="l00812"></a>00812   <span class="comment">// own risk.</span>
<a name="l00813"></a>00813   std::vector&lt;const char *&gt; probesetNames;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> *layout = NULL;
<a name="l00816"></a>00816   vector&lt;MetaProbeset *&gt; metaSets;
<a name="l00817"></a>00817   <span class="comment">//  vector&lt;AnalysisStreamExpression *&gt; analysisStreams;</span>
<a name="l00818"></a>00818   vector&lt;int&gt; probesetIds;
<a name="l00819"></a>00819   <a class="code" href="classProbeListFactory.html" title="A Factory for allocating and retrieving ProbeListPacked objects. /// It really should be called Probe...">ProbeListFactory</a> plFactory;
<a name="l00820"></a>00820   <span class="comment">//vector&lt;ProbeListPacked&gt; probeListVec;</span>
<a name="l00821"></a>00821   vector&lt;bool&gt; psToLoad;
<a name="l00822"></a>00822   <span class="comment">/* Define the currently hard-coded p-value threshold for detection, used</span>
<a name="l00823"></a>00823 <span class="comment">     by QC reporters.  Comment in sample-probe-summarize.pl: this should be</span>
<a name="l00824"></a>00824 <span class="comment">     configurable from the commandline and the default set from pgf file. */</span>
<a name="l00825"></a>00825 
<a name="l00826"></a>00826   <a class="code" href="classIntensityMart.html" title="IntensityMart.">IntensityMart</a> *iMart = NULL;
<a name="l00827"></a>00827   <span class="comment">/* Make the analysis pathways. */</span>
<a name="l00828"></a>00828         <a class="code" href="classAnalysisStreamExpression.html">AnalysisStreamExpression</a> *as = NULL;
<a name="l00829"></a>00829   <a class="code" href="classCelReader.html" title="Class for reading cel files and passing the data to memory representation and analysis objects...">CelReader</a> reader;
<a name="l00830"></a>00830   vector&lt;QuantMethodReport *&gt; reporters;
<a name="l00831"></a>00831   <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> *dStore = NULL;
<a name="l00832"></a>00832   <span class="keywordtype">int</span> stageIx = 0;
<a name="l00833"></a>00833   <span class="keywordtype">string</span> spfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);  
<a name="l00834"></a>00834   <span class="keywordtype">string</span> spfFileOrig = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>); 
<a name="l00835"></a>00835   <a class="code" href="classPsBoard.html">PsBoard</a> *board = <span class="keyword">new</span> <a class="code" href="classPsBoard.html">PsBoard</a>();
<a name="l00836"></a>00836   board-&gt;setOptions(<span class="keyword">this</span>);
<a name="l00837"></a>00837   <span class="keywordflow">try</span> { <span class="comment">// outer try for handling the exception.</span>
<a name="l00838"></a>00838     <span class="keywordflow">try</span> { <span class="comment">// inner try for memory clean up.</span>
<a name="l00839"></a>00839       <span class="keywordflow">if</span>(!Fs::isWriteableDir(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>))) 
<a name="l00840"></a>00840         <span class="keywordflow">if</span>(<a class="code" href="classFs.html#aea474e8df7665f070c5334fa322bd283" title="make all path of directories ///">Fs::mkdirPath</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>), <span class="keyword">false</span>) != APT_OK) 
<a name="l00841"></a>00841           <a class="code" href="Err_8h.html#a7e26a673d8901b5bc880dfab285f5309" title="Calls Err::apt_err_abort with the filename and linenumber set.">APT_ERR_ABORT</a>(<span class="stringliteral">&quot;Can&#39;t make or write to directory: &quot;</span> + <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>)); 
<a name="l00842"></a>00842         <span class="comment">//        board.setOptions(this);</span>
<a name="l00843"></a>00843         makeTempDir(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l00844"></a>00844 
<a name="l00845"></a>00845         <span class="comment">// Read in our spf/cdf/pgf files for probeset definitions</span>
<a name="l00846"></a>00846         fillInLayout(&amp;layout, spfFile, spfFileOrig, metaSets, probesetNames);
<a name="l00847"></a>00847         <span class="keywordtype">bool</span> haveMetaProbeset = (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> || <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>); 
<a name="l00848"></a>00848 
<a name="l00849"></a>00849         <span class="comment">// Get analysis descirption</span>
<a name="l00850"></a>00850         <span class="keywordtype">string</span> analysisString = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;analysis&quot;</span>); 
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         <span class="comment">// Setup the data store for intensities</span>
<a name="l00853"></a>00853         <span class="keywordtype">string</span> stageTemp = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;/stage-&quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(stageIx); 
<a name="l00854"></a>00854         dStore = <span class="keyword">new</span> <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a>(stageTemp);
<a name="l00855"></a>00855         vector&lt;int&gt; desiredOrder;
<a name="l00856"></a>00856         determineDesiredOrder(*layout, desiredOrder, haveMetaProbeset, metaSets);
<a name="l00857"></a>00857         dStore-&gt;<a class="code" href="classDataStore.html#a448b91bef58aadd3c8980110e4b53175" title="Set the probe order that things will be sorted on disk.">setProbeOrder</a>(desiredOrder);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859         <span class="comment">/* Setup the probe level annotations. */</span>
<a name="l00860"></a>00860         <span class="keywordtype">string</span> probeInfoTemp = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;/stage-probe-info&quot;</span>);
<a name="l00861"></a>00861         <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> probeInfo(probeInfoTemp);
<a name="l00862"></a>00862         probeInfo.<a class="code" href="classDataStore.html#a448b91bef58aadd3c8980110e4b53175" title="Set the probe order that things will be sorted on disk.">setProbeOrder</a>(desiredOrder);
<a name="l00863"></a>00863         probeInfo.<a class="code" href="classDataStore.html#ae289e3169e932efc1d1e329311588b58" title="Load up values from a ChipLayout object and place them on disk in store.">setValues</a>(*layout, *board);
<a name="l00864"></a>00864         board-&gt;setProbeInfo(&amp;probeInfo);
<a name="l00865"></a>00865          
<a name="l00866"></a>00866         <span class="comment">// If more sophisticated analysis more blackboard options as necessary anywhere in here...</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         <span class="comment">// Setup a listener for top level statistics</span>
<a name="l00869"></a>00869         map&lt;string, vector&lt;bool&gt; &gt; masks;
<a name="l00870"></a>00870         setupMask(layout, masks, probeInfo);
<a name="l00871"></a>00871         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probe-class-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00872"></a>00872             <a class="code" href="classEngineUtil.html#aa15f9212dcca07824198348e6679d2a9" title="Read in the probe class file.">EngineUtil::readProbeClassFile</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probe-class-file&quot;</span>), layout-&gt;<a class="code" href="classChipLayout.html#abedbffee7c6a978e3e5545d659a78ec7" title="Get the total number of probes on this chip.">getProbeCount</a>(), masks);
<a name="l00873"></a>00873         <a class="code" href="classCelStatListener.html" title="Class for objects that need to actually access real cel file data.">CelStatListener</a> celStats(masks);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="comment">// Figure out our analysis stages and setup our AnalysisInfo </span>
<a name="l00876"></a>00876         vector&lt;AnalysisStage&gt; stages = AnalysisStage::makeStages(analysisString, m_stdMethods);
<a name="l00877"></a>00877         <span class="keywordtype">string</span> analysisName = stages[0].name;
<a name="l00878"></a>00878         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; stages.size(); i++) {
<a name="l00879"></a>00879           analysisName = analysisName + <span class="stringliteral">&quot;.&quot;</span> + stages[i].name;
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881         std::string analysisGuid = <a class="code" href="classaffxutil_1_1Guid.html#a2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>();
<a name="l00882"></a>00882         <span class="keywordtype">string</span> qSpec = stages[stages.size()-1].spec;
<a name="l00883"></a>00883         qSpec = qSpec.substr(qSpec.find(<span class="stringliteral">&quot;,&quot;</span>) + 1);
<a name="l00884"></a>00884         <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> analInfo = makeAnalysisInfo(*layout, analysisName, metaSets, analysisGuid, 
<a name="l00885"></a>00885                                                  qSpec, QuantMethodFactory::Expression, *board);
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         <span class="comment">// Free up memory that is no longer needed - this frees up a lot of memory!</span>
<a name="l00888"></a>00888         <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(layout);
<a name="l00889"></a>00889 
<a name="l00890"></a>00890         <span class="comment">/* Set up the cel reader */</span>
<a name="l00891"></a>00891         vector&lt;string&gt; celFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>); 
<a name="l00892"></a>00892         reader.<a class="code" href="classIntensityReader.html#a0124349ddc9af057e80f05dcd9557deb" title="Set the names of the files to read data from.">setFiles</a>(celFiles);
<a name="l00893"></a>00893         reader.<a class="code" href="classCelReader.html#a22dff93eacaa5d3d46e9b001b9771638" title="Register a cel listener to see the cel file when it is read.">registerCelListener</a>(&amp;celStats);
<a name="l00894"></a>00894         reader.<a class="code" href="classCelReader.html#a22dff93eacaa5d3d46e9b001b9771638" title="Register a cel listener to see the cel file when it is read.">registerCelListener</a>(dStore);
<a name="l00895"></a>00895         reader.<a class="code" href="classCelReader.html#a9966a326c023b7048e732db3c657913f" title="Do the heavy lifting of reading data from the cel files and passing to all the streams and intensity ...">readFiles</a>();
<a name="l00896"></a>00896 
<a name="l00897"></a>00897         <span class="comment">// Make this a stage and update blackboard with raw intensities as example?</span>
<a name="l00898"></a>00898         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;After Reading Files&quot;</span>);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900         <span class="comment">/* Do our chipstream type data transformations */</span>
<a name="l00901"></a>00901         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Preprocessing cel file data&quot;</span>);
<a name="l00902"></a>00902         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; stages.size()  -1; i++) {
<a name="l00903"></a>00903           <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Doing stage: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(i) + <span class="stringliteral">&quot; &quot;</span> + stages[i].name);
<a name="l00904"></a>00904           <span class="keywordtype">string</span> nextStore = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;/stage-&quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(++stageIx);
<a name="l00905"></a>00905           <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> *out = <span class="keyword">new</span> <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a>(nextStore);
<a name="l00906"></a>00906           out-&gt;<a class="code" href="classDataStore.html#abf17dde5d58c057a8ee369a769adb233" title="Initialize values directly from another DataStore object.">initFromDataStore</a>(*dStore);
<a name="l00907"></a>00907           runChipStreamStage(stages[i], *board, *dStore, *out);
<a name="l00908"></a>00908           <a class="code" href="classDataStore.html" title="Class that stores data about probes and probesets out of core but loads into RAM as necessary for com...">DataStore</a> *toFree = dStore;
<a name="l00909"></a>00909           dStore = out;
<a name="l00910"></a>00910           <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(toFree);
<a name="l00911"></a>00911           <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Done.&quot;</span>);
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Done Preprocessing cel file data&quot;</span>);
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         <span class="comment">/* Do the summarization/quantification */</span>
<a name="l00916"></a>00916         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <span class="stringliteral">&quot;Processing probesets.&quot;</span>);
<a name="l00917"></a>00917         runQuantificationStage(stages[stages.size() -1], *board,
<a name="l00918"></a>00918                                *dStore, reporters, analInfo, QuantMethodFactory::Expression,
<a name="l00919"></a>00919                                metaSets, &amp;celStats, spfFile);
<a name="l00920"></a>00920         closeGlobalA5();
<a name="l00921"></a>00921         <span class="keywordflow">if</span>(spfFile != <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>))
<a name="l00922"></a>00922           <a class="code" href="classFs.html#a6b8f232817f933a42c21edde6ea55a3a" title="An error if it doesnt exist.">Fs::rm</a>(spfFile);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Done.&quot;</span>);
<a name="l00925"></a>00925     } <span class="comment">// inner try end</span>
<a name="l00926"></a>00926     <span class="keywordflow">catch</span>(...) {
<a name="l00927"></a>00927       <span class="keywordflow">for</span>(uint32_t setIx = 0; setIx &lt; metaSets.size(); setIx++) {
<a name="l00928"></a>00928         <span class="keyword">delete</span> metaSets[setIx];
<a name="l00929"></a>00929       }
<a name="l00930"></a>00930       metaSets.clear();
<a name="l00931"></a>00931       <span class="keywordflow">for</span>(uint32_t psIx = 0; psIx &lt; probesetNames.size(); psIx++) {
<a name="l00932"></a>00932         <a class="code" href="Util_8h.html#aaf8a1260bc5853179000feabfb97b294" title="delete function that deletes an array and sets the pointer to NULL.">FreezArray</a>(probesetNames[psIx]);
<a name="l00933"></a>00933       }
<a name="l00934"></a>00934       <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(as);
<a name="l00935"></a>00935       <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(layout);
<a name="l00936"></a>00936       <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(dStore);
<a name="l00937"></a>00937       iMart = NULL;
<a name="l00938"></a>00938       closeGlobalA5();
<a name="l00939"></a>00939       removeTempDir(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l00940"></a>00940 
<a name="l00941"></a>00941       <span class="comment">// re-throw the unchanged exception.</span>
<a name="l00942"></a>00942       <span class="keywordflow">throw</span>;
<a name="l00943"></a>00943     }
<a name="l00944"></a>00944   } <span class="comment">// end outer try</span>
<a name="l00945"></a>00945   <span class="comment">/* When things go wrong see if we can die gracefully here. */</span>
<a name="l00946"></a>00946   <span class="keywordflow">catch</span>(<a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a> &amp;e) {
<a name="l00947"></a>00947     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00948"></a>00948     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(e.<a class="code" href="classExcept.html#a6983a18bbb12fd78301d1ee77b2371ff" title="Standard what() call, just returns error message.">what</a>());
<a name="l00949"></a>00949   }
<a name="l00950"></a>00950   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::bad_alloc &amp;e) {
<a name="l00951"></a>00951     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00952"></a>00952     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Ran out of memory. &quot;</span>
<a name="l00953"></a>00953                   <span class="stringliteral">&quot;Try using quitting other applications.&quot;</span>);
<a name="l00954"></a>00954   }
<a name="l00955"></a>00955   <span class="keywordflow">catch</span>(<a class="code" href="classaffymetrix__calvin__exceptions_1_1CalvinException.html">CalvinException</a> &amp;ce) {
<a name="l00956"></a>00956     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00957"></a>00957     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Affymetrix GeneChip Command Console library has thrown an exception. &quot;</span>
<a name="l00958"></a>00958                   <span class="stringliteral">&quot;Description: &#39;&quot;</span> +StringUtils::ConvertWCSToMBS(ce.<a class="code" href="classaffymetrix__calvin__exceptions_1_1CalvinException.html#a24f3db249eaee80ba1010dcc9e4db3d2">Description</a>()) + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00959"></a>00959   }
<a name="l00960"></a>00960   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception &amp;e) {
<a name="l00961"></a>00961     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00962"></a>00962     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Exception caught. &quot;</span>
<a name="l00963"></a>00963                   <span class="stringliteral">&quot;Most problems with this program are memory related. &quot;</span>
<a name="l00964"></a>00964                   <span class="stringliteral">&quot;Message is: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.what()));
<a name="l00965"></a>00965   }
<a name="l00966"></a>00966   <span class="keywordflow">catch</span>(<span class="keyword">const</span> BaseException &amp;e) {
<a name="l00967"></a>00967     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00968"></a>00968     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;newmat issue: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(e.what()));
<a name="l00969"></a>00969   }
<a name="l00970"></a>00970   <span class="keywordflow">catch</span>(...) {
<a name="l00971"></a>00971     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(0,<span class="stringliteral">&quot;&quot;</span>);
<a name="l00972"></a>00972     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Unknown exception caught &quot;</span>
<a name="l00973"></a>00973                   <span class="stringliteral">&quot;(most problems with this program are memory related).&quot;</span>);
<a name="l00974"></a>00974   }
<a name="l00975"></a>00975   <span class="comment">// cleanup -- KEEP IN SYNC WITH MEMORY FREEZ ABOVE IN CATCH</span>
<a name="l00976"></a>00976   <span class="keywordflow">for</span>(uint32_t setIx = 0; setIx &lt; metaSets.size(); setIx++) {
<a name="l00977"></a>00977     <span class="keyword">delete</span> metaSets[setIx];
<a name="l00978"></a>00978   }
<a name="l00979"></a>00979   metaSets.clear();
<a name="l00980"></a>00980   <span class="keywordflow">for</span>(uint32_t psIx = 0; psIx &lt; probesetNames.size(); psIx++) {
<a name="l00981"></a>00981     <a class="code" href="Util_8h.html#aaf8a1260bc5853179000feabfb97b294" title="delete function that deletes an array and sets the pointer to NULL.">FreezArray</a>(probesetNames[psIx]);
<a name="l00982"></a>00982   }
<a name="l00983"></a>00983   <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(as);
<a name="l00984"></a>00984   <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(layout);
<a name="l00985"></a>00985   <a class="code" href="Util_8h.html#ad0787eda9709999bbd42dc11b21deb0d" title="delete function that deletes the pointer and sets it to NULL.">Freez</a>(dStore);
<a name="l00986"></a>00986   iMart = NULL;
<a name="l00987"></a>00987   removeTempDir(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 <span class="comment"></span>
<a name="l00990"></a>00990 <span class="comment">/** </span>
<a name="l00991"></a>00991 <span class="comment"> * @brief Write the headers for the various reports.</span>
<a name="l00992"></a>00992 <span class="comment"> * </span>
<a name="l00993"></a>00993 <span class="comment"> * @param layout - Probe and probe set info.</span>
<a name="l00994"></a>00994 <span class="comment"> * @param iMart - Memory reprentation of data.</span>
<a name="l00995"></a>00995 <span class="comment"> * @param analysis - Collection of all the analysis that we are going to run.</span>
<a name="l00996"></a>00996 <span class="comment"> * @param startTime - Time of the beginning of processing.</span>
<a name="l00997"></a>00997 <span class="comment"> */</span>
<a name="l00998"></a>00998 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::writeHeaders(<a class="code" href="classIntensityMart.html" title="IntensityMart.">IntensityMart</a> &amp;iMart,
<a name="l00999"></a>00999                                                 <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *qMethod,
<a name="l01000"></a>01000                                                 std::vector&lt;QuantMethodReport *&gt; &amp;reporters,
<a name="l01001"></a>01001                                                 <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> &amp;info) {
<a name="l01002"></a>01002     <span class="keywordtype">string</span> reportGuid = <a class="code" href="classaffxutil_1_1Guid.html#a2929c982cb9f3b5f6c5d7d818a8e6ac4">affxutil::Guid::GenerateNewGuid</a>();
<a name="l01003"></a>01003     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; reporters.size(); i++) {
<a name="l01004"></a>01004       reporters[i]-&gt;prepare(*qMethod, iMart);
<a name="l01005"></a>01005       reporters[i]-&gt;addStdHeaders(reporters[i],
<a name="l01006"></a>01006                                   <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>),
<a name="l01007"></a>01007                                   reportGuid,
<a name="l01008"></a>01008                                   <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;time-start&quot;</span>),
<a name="l01009"></a>01009                                   <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;command-line&quot;</span>),
<a name="l01010"></a>01010                                   <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;version-to-report&quot;</span>),
<a name="l01011"></a>01011                                   info);
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 <a class="code" href="classProbeSetGroup.html" title="Group of probe sets that should be processed as a single large probe set.">ProbeSetGroup</a> *ProbesetSummarizeStageEngine::makeProbesetGroupFromMeta(<a class="code" href="classMetaProbeset.html" title="Very basic class to store the meta probesets (groups of probesets) that a user specifies for analysis...">MetaProbeset</a> &amp;meta, <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> &amp;layout) {
<a name="l01017"></a>01017   <a class="code" href="classProbeSetGroup.html" title="Group of probe sets that should be processed as a single large probe set.">ProbeSetGroup</a> *group = <span class="keyword">new</span> <a class="code" href="classProbeSetGroup.html" title="Group of probe sets that should be processed as a single large probe set.">ProbeSetGroup</a>();
<a name="l01018"></a>01018   group-&gt;<a class="code" href="classProbeSetGroup.html#ac150e00a9271b7872e6be7f87f023e41" title="Should we try to free memory in destructor?">ownMem</a> = <span class="keyword">true</span>;
<a name="l01019"></a>01019   group-&gt;<a class="code" href="classProbeSetGroup.html#a0eb8ea2dfda45864880e0495539753db" title="Name of probe set group.">name</a> = <a class="code" href="classUtil.html#a508b7aff9569ed929945d0d37eca384e" title="Create a copy of a string.">Util::cloneString</a>(meta.name);
<a name="l01020"></a>01020   group-&gt;<a class="code" href="classProbeSetGroup.html#aa197d2e48f3c2e8ae67cc8f5d54735ac" title="Vector of probe set pointers.">probeSets</a>.resize(meta.probesets.size());
<a name="l01021"></a>01021   <span class="keywordtype">int</span> type = 0;
<a name="l01022"></a>01022   <span class="keywordtype">int</span> cnt = 0;
<a name="l01023"></a>01023   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> metaIx = 0; metaIx &lt; meta.probesets.size(); metaIx++) {
<a name="l01024"></a>01024     <a class="code" href="classProbeListPacked.html">ProbeListPacked</a> sub = layout.<a class="code" href="classChipLayout.html#ae465f92816b1c9983a45d1f73293cc7b" title="Find a probe set using the name as a key.">getProbeListByName</a>(meta.probesets[metaIx]);
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (sub.isNull()) {
<a name="l01026"></a>01026       <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2,<span class="stringliteral">&quot;Skipping probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta.probesets[metaIx]) + <span class="stringliteral">&quot; in meta probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta.name) + <span class="stringliteral">&quot;. (Due to kill list?)&quot;</span>);
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028     <span class="keywordflow">else</span> {
<a name="l01029"></a>01029         <span class="keywordflow">if</span>(cnt == 0) {
<a name="l01030"></a>01030             type = sub.get_type();
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032         <span class="keywordflow">if</span> (type != sub.get_type()) {
<a name="l01033"></a>01033             <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;For meta probeset id: &#39;&quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta.name) + <span class="stringliteral">&quot;&#39;. Can&#39;t combine different types of probesets.&quot;</span>);
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *ps = <a class="code" href="classProbeListFactory.html#aaed559bbfe723ed4fe225f805a2411e8">ProbeListFactory::asProbeSet</a>(sub);
<a name="l01036"></a>01036         group-&gt;<a class="code" href="classProbeSetGroup.html#aa197d2e48f3c2e8ae67cc8f5d54735ac" title="Vector of probe set pointers.">probeSets</a>[cnt] = ps;
<a name="l01037"></a>01037         cnt++;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040   <span class="keywordflow">if</span>(cnt &gt; 0) {
<a name="l01041"></a>01041     group-&gt;<a class="code" href="classProbeSetGroup.html#aa197d2e48f3c2e8ae67cc8f5d54735ac" title="Vector of probe set pointers.">probeSets</a>.resize(cnt);
<a name="l01042"></a>01042     <span class="keywordflow">return</span> group;
<a name="l01043"></a>01043   } <span class="keywordflow">else</span> {
<a name="l01044"></a>01044     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2,<span class="stringliteral">&quot;Skipping meta probeset probeset &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(meta.name) + <span class="stringliteral">&quot;. (Due to kill list?)&quot;</span>);
<a name="l01045"></a>01045     <span class="keyword">delete</span> group;
<a name="l01046"></a>01046     <span class="keywordflow">return</span> NULL;
<a name="l01047"></a>01047   }
<a name="l01048"></a>01048 }
<a name="l01049"></a>01049 <span class="comment"></span>
<a name="l01050"></a>01050 <span class="comment">/** </span>
<a name="l01051"></a>01051 <span class="comment"> * @brief Loop through the groups and do the requested analysis for</span>
<a name="l01052"></a>01052 <span class="comment"> * each one.</span>
<a name="l01053"></a>01053 <span class="comment"> * </span>
<a name="l01054"></a>01054 <span class="comment"> * @param layout - Probe and probe set info.</span>
<a name="l01055"></a>01055 <span class="comment"> * @param iMart - Memory reprentation of data.</span>
<a name="l01056"></a>01056 <span class="comment"> * @param psGroups - Groups of probe sets to be analyzed.</span>
<a name="l01057"></a>01057 <span class="comment"> * @param analysis - Analysis pathways to be computed.</span>
<a name="l01058"></a>01058 <span class="comment"> */</span>
<a name="l01059"></a>01059 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::doSummaries(<a class="code" href="classSpfReader.html" title="Class for parsing the Simple Probe Format (SPF) text files.">SpfReader</a> &amp;reader, <a class="code" href="classIntensityMart.html" title="IntensityMart.">IntensityMart</a> &amp;iMart,
<a name="l01060"></a>01060                                           <a class="code" href="classAnalysisStreamExpression.html">AnalysisStreamExpression</a> *analysis,
<a name="l01061"></a>01061                                           <span class="keywordtype">int</span> numPsSets) {
<a name="l01062"></a>01062   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dotMod = max(numPsSets/20, 1);
<a name="l01063"></a>01063   Verbose::progressBegin(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Processing Probesets&quot;</span>), 20, (<span class="keywordtype">int</span>)dotMod, numPsSets);
<a name="l01064"></a>01064   <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *ps = reader.<a class="code" href="classSpfReader.html#a174f88a8e62ac55b1cc63bf6b6c15b9c" title="Read the next record.">readNextProbeSet</a>();
<a name="l01065"></a>01065   <span class="keywordflow">while</span>(ps != NULL) {
<a name="l01066"></a>01066     <a class="code" href="classVerbose.html#ab28a28741a3ab2086099e2d66e920eb5" title="Print a dot out to let the user know we are still alive and making progress.">Verbose::progressStep</a>(1);
<a name="l01067"></a>01067     <a class="code" href="classProbeSetGroup.html" title="Group of probe sets that should be processed as a single large probe set.">ProbeSetGroup</a> psGroup(ps); 
<a name="l01068"></a>01068     analysis-&gt;<a class="code" href="classAnalysisStreamExpression.html#aa03d0268610a486eabc97f5d1d1ff585" title="Do the analysis for a particular group of probe sets.">doAnalysis</a>(psGroup, iMart, <span class="keyword">true</span>);
<a name="l01069"></a>01069     <span class="comment">// psGroup should delete the memory for ps...</span>
<a name="l01070"></a>01070     ps = reader.<a class="code" href="classSpfReader.html#a174f88a8e62ac55b1cc63bf6b6c15b9c" title="Read the next record.">readNextProbeSet</a>();
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072   Verbose::progressEnd(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Done.&quot;</span>));
<a name="l01073"></a>01073 }
<a name="l01074"></a>01074 <span class="comment"></span>
<a name="l01075"></a>01075 <span class="comment">/** </span>
<a name="l01076"></a>01076 <span class="comment"> * Set all of the probes in the psGroups file to be loaded.</span>
<a name="l01077"></a>01077 <span class="comment"> * </span>
<a name="l01078"></a>01078 <span class="comment"> * @param psGroups - Vector of probests containing probes to be set as true.</span>
<a name="l01079"></a>01079 <span class="comment"> * @param probeSubset - Bit vector in which probe ids should be set to true.</span>
<a name="l01080"></a>01080 <span class="comment"> */</span>
<a name="l01081"></a>01081 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::mergeProbeSubset(<span class="keyword">const</span> std::vector&lt;ProbeListPacked&gt; &amp;plVec, std::vector&lt;bool&gt; &amp;probeSubset) {
<a name="l01082"></a>01082   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> plIx = 0; plIx &lt; plVec.size(); plIx++) {
<a name="l01083"></a>01083     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pIx = 0; pIx &lt; plVec[plIx].probe_cnt(); pIx++) {
<a name="l01084"></a>01084       <span class="keywordtype">int</span> <span class="keywordtype">id</span> = plVec[plIx].get_probeId(pIx);
<a name="l01085"></a>01085       <span class="keywordflow">if</span>(<span class="keywordtype">id</span> != <a class="code" href="classProbeList.html#a0b73c6271b40b4cf1a6ec92d1b997559" title="use this symbolic value for the null probe.">ProbeList::null_probe</a>) {
<a name="l01086"></a>01086         probeSubset[id] = <span class="keyword">true</span>;
<a name="l01087"></a>01087       }
<a name="l01088"></a>01088     }
<a name="l01089"></a>01089   }
<a name="l01090"></a>01090 }
<a name="l01091"></a>01091 <span class="comment"></span>
<a name="l01092"></a>01092 <span class="comment">/** </span>
<a name="l01093"></a>01093 <span class="comment"> * Construct an object for output that contains the program an</span>
<a name="l01094"></a>01094 <span class="comment"> * algorithm information.</span>
<a name="l01095"></a>01095 <span class="comment"> * @param as - AnalysisStream to get information from.</span>
<a name="l01096"></a>01096 <span class="comment"> * @param layout - Layout to get information from.</span>
<a name="l01097"></a>01097 <span class="comment"> * @param metaSets - List of probeset names to output</span>
<a name="l01098"></a>01098 <span class="comment"> *</span>
<a name="l01099"></a>01099 <span class="comment"> * @return - Information for making CHP file.</span>
<a name="l01100"></a>01100 <span class="comment"> */</span>
<a name="l01101"></a>01101 <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> ProbesetSummarizeStageEngine::makeAnalysisInfo(<a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> &amp;layout, 
<a name="l01102"></a>01102                                                             <span class="keyword">const</span> std::string &amp;name,
<a name="l01103"></a>01103                                                             vector&lt;MetaProbeset *&gt; &amp;metaSets,
<a name="l01104"></a>01104                                                             <span class="keyword">const</span> std::string &amp;guid,
<a name="l01105"></a>01105                                                             <span class="keyword">const</span> std::string &amp;qSpec,
<a name="l01106"></a>01106                                                             QuantMethodFactory::QuantType type,
<a name="l01107"></a>01107                                                             <a class="code" href="classPsBoard.html">PsBoard</a> &amp;board
<a name="l01108"></a>01108                                                             ) {
<a name="l01109"></a>01109 
<a name="l01110"></a>01110   <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> info;
<a name="l01111"></a>01111   info.<a class="code" href="classAnalysisInfo.html#a302e3084afe43804e83c520b7beb463a" title="Number of expression probesets.">m_NumExpression</a> = layout.<a class="code" href="classChipLayout.html#acd976e4a3fa1141b5660ecab6f5c9b70" title="Number of expression probesets.">getNumExpressionPSets</a>();
<a name="l01112"></a>01112   info.<a class="code" href="classAnalysisInfo.html#a9a829523fde5f52310057a05b01ba601" title="Number of genotyping expression.">m_NumGenotyping</a> = layout.<a class="code" href="classChipLayout.html#acc2755565e72c8bcb52365c23572c216" title="Number of genotyping expression.">getNumGenotypeingPSets</a>();
<a name="l01113"></a>01113   info.<a class="code" href="classAnalysisInfo.html#a540d9d55c05541e8fbe95474d6dbb7fb" title="How many rows are on the grid of the chip.">m_NumRows</a> = layout.<a class="code" href="classChipLayout.html#a5b5ed8dcd11bdfbbecfbce63e2d0b342" title="Get the number of x counts.">getXCount</a>();
<a name="l01114"></a>01114   info.<a class="code" href="classAnalysisInfo.html#a39da235062cb23d7392f29cca25d8da7" title="How many columns are the grid of the chip.">m_NumCols</a> = layout.<a class="code" href="classChipLayout.html#ae602f7c506b7ae9355844f06267ff528" title="Get the number of y counts.">getYCount</a>();
<a name="l01115"></a>01115   info.<a class="code" href="classAnalysisInfo.html#ac85efbbb6618cb87c39511af32c311a7" title="How many probesets are on the chip and in cdf file. This is /// critical as probesets must be the exa...">m_NumProbeSets</a> = metaSets.size();
<a name="l01116"></a>01116   info.<a class="code" href="classAnalysisInfo.html#a1eaf6c81440945d17b192a9d7196e788" title="What type of chp file is this? For our purposes here it is genotyping.">m_ProbeSetType</a> = affxcdf::ExpressionProbeSetType;
<a name="l01117"></a>01117   info.<a class="code" href="classAnalysisInfo.html#a1c684133674d56f7588c24c56c6a4c75" title="Name of the analysis.">m_AnalysisName</a> = name;
<a name="l01118"></a>01118   info.<a class="code" href="classAnalysisInfo.html#a4e52df55ab7398557852b211c5a50d41" title="What algorithm are we reporting.">m_AlgName</a> = name;
<a name="l01119"></a>01119   info.<a class="code" href="classAnalysisInfo.html#ab9d3f400692f10270650ed0f02e8d2a0" title="GUID (global unique ID) associated with a specific analysis.">m_AnalysisGuid</a> = guid;
<a name="l01120"></a>01120   <a class="code" href="classQuantMethodFactory.html" title="Factory class for making chip streams based on a string representation.">QuantMethodFactory</a> qFactory(QuantMethodFactory::Expression);
<a name="l01121"></a>01121   <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *qMethod = qFactory.quantMethodForString(qSpec, board, type);
<a name="l01122"></a>01122   fillInAnalysisInfo(info, qMethod);
<a name="l01123"></a>01123   <span class="keyword">delete</span> qMethod;
<a name="l01124"></a>01124   <span class="comment">// If CHP Output, then we need list of probeset names to output</span>
<a name="l01125"></a>01125   <span class="comment">// Otherwise do not waste the memory</span>
<a name="l01126"></a>01126   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-md-chp-output&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-chp-output&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>)) {
<a name="l01127"></a>01127     vector&lt;const char *&gt; probesetNames;
<a name="l01128"></a>01128     probesetNames.reserve(metaSets.size());
<a name="l01129"></a>01129     vector&lt;MetaProbeset *&gt;::iterator mIx;
<a name="l01130"></a>01130     <span class="keywordflow">for</span>(mIx = metaSets.begin(); mIx != metaSets.end(); ++mIx) {
<a name="l01131"></a>01131         probesetNames.push_back((*mIx)-&gt;name);
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133     info.<a class="code" href="classAnalysisInfo.html#a21ab2fbfe201742b20f48ac42a12a07e" title="Vector of probeset names and groups as they should appear in the chp file. /// this memory is owned e...">m_ProbesetNames</a> = probesetNames;
<a name="l01134"></a>01134   }
<a name="l01135"></a>01135 
<a name="l01136"></a>01136   <span class="comment">// Sanity check</span>
<a name="l01137"></a>01137   <a class="code" href="classErr.html#ad1a633f602fe60689cdc12d9ca1842e9" title="errAbort based version of assert with an error message.">Err::check</a>(info.m_ParamValues.size() == info.<a class="code" href="classAnalysisInfo.html#ad48864dcd9e2e22d9d74dfbbb00fff04" title="These next two vectors are matched pairs, one contains the /// keys and the other the values...">m_ParamNames</a>.size(), 
<a name="l01138"></a>01138    
<a name="l01139"></a>01139           <span class="stringliteral">&quot;AnalysisInfo - Names and values out of sync.&quot;</span>);
<a name="l01140"></a>01140   <span class="keywordflow">return</span> info;
<a name="l01141"></a>01141 }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::addReporters_Expression(affx::TsvReport::TsvReportFmt_t report_format,
<a name="l01144"></a>01144                                                            std::vector&lt;QuantMethodReport *&gt; &amp;reporters, 
<a name="l01145"></a>01145                                                            <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a>&amp; info,
<a name="l01146"></a>01146                                                            <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *qMethod,
<a name="l01147"></a>01147                                                            <span class="keywordtype">int</span> precision) {
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     <a class="code" href="classQuantMethodExprReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprReport</a> *report = <span class="keyword">new</span> <a class="code" href="classQuantMethodExprReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprReport</a>(info.getNumCols());
<a name="l01150"></a>01150     report-&gt;m_qMethod=qMethod;
<a name="l01151"></a>01151     report-&gt;setIsHeaderBuffer(1);
<a name="l01152"></a>01152     report-&gt;setDirPath(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>));
<a name="l01153"></a>01153     report-&gt;setPrecision(precision);
<a name="l01154"></a>01154     report-&gt;m_summary_tsv_precision=precision;
<a name="l01155"></a>01155     report-&gt;m_feffects_tsv_precision=precision-1;
<a name="l01156"></a>01156     report-&gt;m_residuals_tsv_precision=precision;
<a name="l01157"></a>01157     report-&gt;setFileprefix(info.<a class="code" href="classAnalysisInfo.html#a1c684133674d56f7588c24c56c6a4c75" title="Name of the analysis.">m_AnalysisName</a>);
<a name="l01158"></a>01158     report-&gt;setFilename(<span class="stringliteral">&quot;QuantMethodExprReport-DEBUG&quot;</span>); <span class="comment">// filename not used -- for debugging</span>
<a name="l01159"></a>01159     report-&gt;setWriteOldStyleFeatureEffectsFile(<span class="keyword">false</span>);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="keywordflow">if</span>(report_format == affx::TsvReport::FMT_TSV) {
<a name="l01162"></a>01162         report-&gt;m_DoSummary=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;summaries&quot;</span>);
<a name="l01163"></a>01163         report-&gt;m_DoResiduals=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;feat-details&quot;</span>);
<a name="l01164"></a>01164         report-&gt;m_DoFeatureEffects=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;feat-effects&quot;</span>);
<a name="l01165"></a>01165     } <span class="keywordflow">else</span> {
<a name="l01166"></a>01166         report-&gt;m_DoSummary=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-summaries&quot;</span>);
<a name="l01167"></a>01167         report-&gt;m_DoResiduals=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-details&quot;</span>);
<a name="l01168"></a>01168         report-&gt;m_DoFeatureEffects=<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-effects&quot;</span>);
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-summaries-use-global&quot;</span>)) {
<a name="l01171"></a>01171             <span class="keywordflow">if</span>(m_a5_global_output_group == NULL)
<a name="l01172"></a>01172                 <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;--a5-summaries-use-global option given, but no global file. Must specify --a5-global-file.&quot;</span>);
<a name="l01173"></a>01173             report-&gt;m_summary_a5_group = m_a5_global_output_group;
<a name="l01174"></a>01174             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Using global A5 file for allele summary output.&quot;</span>);
<a name="l01175"></a>01175         }
<a name="l01176"></a>01176     
<a name="l01177"></a>01177         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-details-use-global&quot;</span>)) {
<a name="l01178"></a>01178             <span class="keywordflow">if</span>(m_a5_global_output_group == NULL)
<a name="l01179"></a>01179                 <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;--a5-feature-details-use-global option given, but no global file. Must specify --a5-global-file.&quot;</span>);
<a name="l01180"></a>01180             report-&gt;m_residuals_a5_group = m_a5_global_output_group;
<a name="l01181"></a>01181             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Using global A5 file for residuals output.&quot;</span>);
<a name="l01182"></a>01182         }
<a name="l01183"></a>01183     
<a name="l01184"></a>01184         <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-effects-use-global&quot;</span>)) {
<a name="l01185"></a>01185             <span class="keywordflow">if</span>(m_a5_global_output_group == NULL)
<a name="l01186"></a>01186                 <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;--a5-feature-effects-use-global option given, but no global file. Must specify --a5-global-file.&quot;</span>);
<a name="l01187"></a>01187             report-&gt;m_feffects_a5_group = m_a5_global_output_group;
<a name="l01188"></a>01188             <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1,<span class="stringliteral">&quot;Using global A5 file for feature effects output.&quot;</span>);
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190     }
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     report-&gt;setFormat(report_format);
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     report-&gt;<a class="code" href="classQuantMethodReport.html#acc296969ce5774f4479fc7275de753f0" title="Print a message out to the stream.">addStdHeaders</a>(report,
<a name="l01195"></a>01195                           <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>),
<a name="l01196"></a>01196                           info.<a class="code" href="classAnalysisInfo.html#ab9d3f400692f10270650ed0f02e8d2a0" title="GUID (global unique ID) associated with a specific analysis.">m_AnalysisGuid</a>,
<a name="l01197"></a>01197                           <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;time-start&quot;</span>),
<a name="l01198"></a>01198                           <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;command-line&quot;</span>),
<a name="l01199"></a>01199                           <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;version-to-report&quot;</span>),
<a name="l01200"></a>01200                           info);
<a name="l01201"></a>01201     reporters.push_back(report);
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 <span class="comment"></span>
<a name="l01204"></a>01204 <span class="comment">/** </span>
<a name="l01205"></a>01205 <span class="comment"> * Add the requested reporters for a given AnalysisStream.</span>
<a name="l01206"></a>01206 <span class="comment"> * </span>
<a name="l01207"></a>01207 <span class="comment"> * @param as - AnalysisStream that needs the reporters.</span>
<a name="l01208"></a>01208 <span class="comment"> * @param eMethod - Expression quantification method that is being used to summarize probesets in this AnalysisStream.</span>
<a name="l01209"></a>01209 <span class="comment"> * @param metaSets - list of probesets to output.</span>
<a name="l01210"></a>01210 <span class="comment"> * @param stats -</span>
<a name="l01211"></a>01211 <span class="comment"> */</span>
<a name="l01212"></a>01212 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::setupReporters(std::vector&lt;QuantMethodReport *&gt; &amp;reporters, 
<a name="l01213"></a>01213                                                   <a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> &amp;info,
<a name="l01214"></a>01214                                                   <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *eMethod, 
<a name="l01215"></a>01215                                                   vector&lt;MetaProbeset *&gt; &amp;metaSets,
<a name="l01216"></a>01216                                                   <a class="code" href="classCelStatListener.html" title="Class for objects that need to actually access real cel file data.">CelStatListener</a> *stats) {
<a name="l01217"></a>01217 
<a name="l01218"></a>01218   <span class="keywordtype">int</span> precision = <a class="code" href="classOptions.html#afcfab86e21cac5bba43e0858bd428e62" title="Get the integer value of an option.">getOptInt</a>(<span class="stringliteral">&quot;precision&quot;</span>);
<a name="l01219"></a>01219   <span class="keywordflow">if</span> (precision &gt; 16) {
<a name="l01220"></a>01220     precision = 16;
<a name="l01221"></a>01221     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;Changing precision for reports from &quot;</span>+ <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(precision) +<span class="stringliteral">&quot; to 16&quot;</span>);
<a name="l01222"></a>01222   }
<a name="l01223"></a>01223   <span class="keywordtype">string</span> outDir = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>);
<a name="l01224"></a>01224   vector&lt;string&gt; celFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226   <span class="comment">/* Add our primary text reporter. */</span>
<a name="l01227"></a>01227   <span class="keywordflow">if</span>(precision &lt; 0) {
<a name="l01228"></a>01228     precision = 0;
<a name="l01229"></a>01229     <span class="keywordflow">if</span>(eMethod-&gt;<a class="code" href="classQuantMethod.html#ab1b819505891590c9f3e57d9cc67d4de" title="What is the name of the quantification method?">getType</a>() == <span class="stringliteral">&quot;dabg&quot;</span>) {
<a name="l01230"></a>01230       precision = 5;
<a name="l01231"></a>01231     }
<a name="l01232"></a>01232   }
<a name="l01233"></a>01233   <span class="comment">// Add txt expression reporter</span>
<a name="l01234"></a>01234   <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;summaries&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;feat-effects&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;feat-details&quot;</span>)) {
<a name="l01235"></a>01235     addReporters_Expression(affx::TsvReport::FMT_TSV, reporters, info, eMethod, precision);
<a name="l01236"></a>01236   }
<a name="l01237"></a>01237   <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-summaries&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-effects&quot;</span>) || <a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;a5-feature-details&quot;</span>)) {
<a name="l01238"></a>01238     addReporters_Expression(affx::TsvReport::FMT_A5,reporters, info, eMethod, precision);
<a name="l01239"></a>01239   }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="keywordtype">bool</span> isDetection =eMethod-&gt;<a class="code" href="classQuantMethod.html#a2889dd697efae0503edd00e4087e991b" title="What type of quantification method is this? Summarization like plier detection like dabg...">getQuantType</a>() == QuantExprMethod::Detection;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243   <a class="code" href="classQuantMethodExprChipSummary.html" title="Summarize basic statistics on the performance of a particular summarization or detection method acros...">QuantMethodExprChipSummary</a> *runSummary = <span class="keyword">new</span> <a class="code" href="classQuantMethodExprChipSummary.html" title="Summarize basic statistics on the performance of a particular summarization or detection method acros...">QuantMethodExprChipSummary</a>(celFiles, isDetection, 0, 0.01, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qc-probesets&quot;</span>), metaSets);
<a name="l01244"></a>01244   runSummary-&gt;setFilename(<span class="stringliteral">&quot;runSummary&quot;</span>);
<a name="l01245"></a>01245   
<a name="l01246"></a>01246   <a class="code" href="classQuantMethodRunReport.html" title="Summarize and output basic statistics on the performance of a particular summarization or detection m...">QuantMethodRunReport</a> *runReport = <span class="keyword">new</span> <a class="code" href="classQuantMethodRunReport.html" title="Summarize and output basic statistics on the performance of a particular summarization or detection m...">QuantMethodRunReport</a>(celFiles);
<a name="l01247"></a>01247   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;report-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l01248"></a>01248       <span class="keywordtype">string</span> dir = <a class="code" href="classFs.html#a5308b59c6136f59d7f28947fcc0c6a71" title="just the dirname (will return &amp;quot;.&amp;quot; or &amp;quot;/&amp;quot; as well.) ///">Fs::dirname</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;report-file&quot;</span>));
<a name="l01249"></a>01249       <span class="keywordflow">if</span>(dir == <span class="stringliteral">&quot;&quot;</span>)
<a name="l01250"></a>01250           dir = outDir;
<a name="l01251"></a>01251       <span class="keywordtype">string</span> name = <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;report-file&quot;</span>));
<a name="l01252"></a>01252       runReport-&gt;setDirPath(dir);
<a name="l01253"></a>01253       runReport-&gt;setFilename(name);
<a name="l01254"></a>01254   } <span class="keywordflow">else</span> {
<a name="l01255"></a>01255       runReport-&gt;setDirPath(outDir);
<a name="l01256"></a>01256       runReport-&gt;setFilename(info.<a class="code" href="classAnalysisInfo.html#a1c684133674d56f7588c24c56c6a4c75" title="Name of the analysis.">m_AnalysisName</a>+<span class="stringliteral">&quot;.report&quot;</span>);
<a name="l01257"></a>01257   }
<a name="l01258"></a>01258   runReport-&gt;setFormat(affx::TsvReport::FMT_TSV);
<a name="l01259"></a>01259   runReport-&gt;setPrecision(6);
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   runReport-&gt;<a class="code" href="classQuantMethodRunReport.html#a29cbe5e522c6b3f7be86ae6ec6757ab1" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(stats));
<a name="l01262"></a>01262   runReport-&gt;<a class="code" href="classQuantMethodRunReport.html#a29cbe5e522c6b3f7be86ae6ec6757ab1" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(runSummary));
<a name="l01263"></a>01263 
<a name="l01264"></a>01264   set&lt;string&gt; group;
<a name="l01265"></a>01265   set&lt;uint32_t&gt; groupId;
<a name="l01266"></a>01266   reporters.push_back(runSummary);
<a name="l01267"></a>01267   reporters.push_back(runReport);
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   <span class="comment">// Setup Multi Data CHP Output</span>
<a name="l01270"></a>01270   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-md-chp-output&quot;</span>)){
<a name="l01271"></a>01271     <span class="keywordtype">string</span> ccchpDir;
<a name="l01272"></a>01272     <span class="comment">/* If chp directory not specified use  output/cc-chp/ by default. */</span>
<a name="l01273"></a>01273     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-md-chp-out-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l01274"></a>01274       ccchpDir =<a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(outDir,<span class="stringliteral">&quot;cc-md-chp&quot;</span>); 
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276     <span class="keywordflow">else</span> { 
<a name="l01277"></a>01277       ccchpDir = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-md-chp-out-dir&quot;</span>); 
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279     <a class="code" href="classUtil.html#a21a08a463a4b0b321b58979b0404e017" title="Chop off the last character if it is a path separator.">Util::chompLastIfSep</a>(ccchpDir);
<a name="l01280"></a>01280     <a class="code" href="classQuantMethodMultiDataCCCHPReport.html">QuantMethodMultiDataCCCHPReport</a> *ccchpReporter = <span class="keyword">new</span> <a class="code" href="classQuantMethodMultiDataCCCHPReport.html">QuantMethodMultiDataCCCHPReport</a>(ccchpDir);
<a name="l01281"></a>01281     vector&lt;string&gt; resultFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>);
<a name="l01282"></a>01282     <span class="keywordflow">if</span>(resultFiles.size() &gt; 0)
<a name="l01283"></a>01283         ccchpReporter-&gt;<a class="code" href="classQuantMethodMultiDataCCCHPReport.html#a3115e89542dcbf7822ddf5568a410098" title="Set the CHP filenames to use for output.">setChpFileNames</a>(resultFiles);
<a name="l01284"></a>01284     ccchpReporter-&gt;<a class="code" href="classQuantMethodMultiDataCCCHPReport.html#abead96ffb3df4b2ffc43c4c82d498edf" title="The list of types to load.">SetGenoTypeOnly</a>(<span class="keyword">false</span>);
<a name="l01285"></a>01285     ccchpReporter-&gt;<a class="code" href="classQuantMethodMultiDataCCCHPReport.html#a7ab7a88764474376965312f92e6fa163" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(stats));
<a name="l01286"></a>01286     ccchpReporter-&gt;<a class="code" href="classQuantMethodMultiDataCCCHPReport.html#a7ab7a88764474376965312f92e6fa163" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(runSummary));
<a name="l01287"></a>01287     reporters.push_back(ccchpReporter);
<a name="l01288"></a>01288   }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   <span class="comment">// Setup Old Expression CHP Output</span>
<a name="l01291"></a>01291   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;cc-chp-output&quot;</span>)) {
<a name="l01292"></a>01292     <span class="keywordtype">string</span> ccchpDir;
<a name="l01293"></a>01293     <span class="comment">/* If chp directory not specified use  output/cc-chp/ by default. */</span>
<a name="l01294"></a>01294     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-chp-out-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l01295"></a>01295       ccchpDir = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(outDir,<span class="stringliteral">&quot;cc-chp&quot;</span>); 
<a name="l01296"></a>01296     }
<a name="l01297"></a>01297     <span class="keywordflow">else</span> {
<a name="l01298"></a>01298       ccchpDir = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-chp-out-dir&quot;</span>); 
<a name="l01299"></a>01299     }
<a name="l01300"></a>01300     <a class="code" href="classUtil.html#a21a08a463a4b0b321b58979b0404e017" title="Chop off the last character if it is a path separator.">Util::chompLastIfSep</a>(ccchpDir);
<a name="l01301"></a>01301     <a class="code" href="classQuantMethodExprCCCHPReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprCCCHPReport</a> *ccchpReporter = <span class="keyword">new</span> <a class="code" href="classQuantMethodExprCCCHPReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprCCCHPReport</a>(info, ccchpDir, eMethod-&gt;<a class="code" href="classQuantMethod.html#ab1b819505891590c9f3e57d9cc67d4de" title="What is the name of the quantification method?">getType</a>());
<a name="l01302"></a>01302     vector&lt;string&gt; resultFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>);
<a name="l01303"></a>01303     <span class="keywordflow">if</span>(resultFiles.size() &gt; 0)
<a name="l01304"></a>01304         ccchpReporter-&gt;<a class="code" href="classQuantMethodExprCCCHPReport.html#a337a6702efee88d9e742f0e287121461" title="Set the CHP filenames to use for output.">setChpFileNames</a>(resultFiles);
<a name="l01305"></a>01305     ccchpReporter-&gt;<a class="code" href="classQuantMethodExprCCCHPReport.html#aeec65019478d7859e14232f5d385ccd1" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(stats));
<a name="l01306"></a>01306     ccchpReporter-&gt;<a class="code" href="classQuantMethodExprCCCHPReport.html#aeec65019478d7859e14232f5d385ccd1" title="Register a Chip Summary interface instance to pull metrics from.">registerChipSummary</a>(dynamic_cast&lt;ChipSummary *&gt;(runSummary));
<a name="l01307"></a>01307     reporters.push_back(ccchpReporter);
<a name="l01308"></a>01308   }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="comment">// setup XDA CHP output if neccesary.</span>
<a name="l01311"></a>01311   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;xda-chp-output&quot;</span>)) {
<a name="l01312"></a>01312     <span class="keywordtype">string</span> chpDir;
<a name="l01313"></a>01313     <span class="comment">/* If chp directory not specified use  output/chp/ by default. */</span>
<a name="l01314"></a>01314     <span class="keywordflow">if</span> (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;xda-chp-out-dir&quot;</span>) == <span class="stringliteral">&quot;&quot;</span>) { 
<a name="l01315"></a>01315       chpDir =<a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(outDir,<span class="stringliteral">&quot;chp&quot;</span>); 
<a name="l01316"></a>01316     } 
<a name="l01317"></a>01317     <span class="keywordflow">else</span> {
<a name="l01318"></a>01318       chpDir = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;xda-chp-out-dir&quot;</span>); 
<a name="l01319"></a>01319     }
<a name="l01320"></a>01320     <a class="code" href="classUtil.html#a21a08a463a4b0b321b58979b0404e017" title="Chop off the last character if it is a path separator.">Util::chompLastIfSep</a>(chpDir);
<a name="l01321"></a>01321     <a class="code" href="classQuantMethodExprCHPReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprCHPReport</a> *chpReporter = <span class="keyword">new</span> <a class="code" href="classQuantMethodExprCHPReport.html" title="Class for reporting results of quantification methods.">QuantMethodExprCHPReport</a>(info, chpDir, eMethod-&gt;<a class="code" href="classQuantMethod.html#ab1b819505891590c9f3e57d9cc67d4de" title="What is the name of the quantification method?">getType</a>());
<a name="l01322"></a>01322     vector&lt;string&gt; resultFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;result-files&quot;</span>);
<a name="l01323"></a>01323     <span class="keywordflow">if</span>(resultFiles.size() &gt; 0)
<a name="l01324"></a>01324         chpReporter-&gt;<a class="code" href="classQuantMethodExprCHPReport.html#ace7a668a4c48978a059380e118ac329d" title="Set the CHP filenames to use for output.">setChpFileNames</a>(resultFiles);
<a name="l01325"></a>01325     reporters.push_back(chpReporter);
<a name="l01326"></a>01326   }
<a name="l01327"></a>01327   
<a name="l01328"></a>01328   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a3c98038375042f9b230b3e4e2151fe00" title="Get the boolean value of an option.">getOptBool</a>(<span class="stringliteral">&quot;subsample-report&quot;</span>)) {
<a name="l01329"></a>01329     <a class="code" href="classQuantMethodSamplerReport.html">QuantMethodSamplerReport</a> *sReport = NULL;
<a name="l01330"></a>01330     <span class="comment">/* Add our sampling reporter, just reports on 1 out of every 10 probesets. */</span>
<a name="l01331"></a>01331     <span class="keywordtype">string</span> prefix = <a class="code" href="classFs.html#af44351abee4cbc47f94b83cb2f62899f" title="join strings with the path sep. /// while we would want people to keep the path with FsPath...">Fs::join</a>(outDir,info.<a class="code" href="classAnalysisInfo.html#a1c684133674d56f7588c24c56c6a4c75" title="Name of the analysis.">m_AnalysisName</a>);
<a name="l01332"></a>01332     sReport = <span class="keyword">new</span> <a class="code" href="classQuantMethodSamplerReport.html">QuantMethodSamplerReport</a>(9, prefix, 5, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01333"></a>01333     reporters.push_back(sReport);
<a name="l01334"></a>01334   }
<a name="l01335"></a>01335 
<a name="l01336"></a>01336 }
<a name="l01337"></a>01337 <span class="comment"></span>
<a name="l01338"></a>01338 <span class="comment">/** </span>
<a name="l01339"></a>01339 <span class="comment"> * Read the design of the chip from the cdf file. Also can read the</span>
<a name="l01340"></a>01340 <span class="comment"> * design from an spf file is that is supplied.</span>
<a name="l01341"></a>01341 <span class="comment"> * </span>
<a name="l01342"></a>01342 <span class="comment"> * @param layout - Object to be filled in.</span>
<a name="l01343"></a>01343 <span class="comment"> * @param psGroups - Probe sets to be filled in.</span>
<a name="l01344"></a>01344 <span class="comment"> * @param probesToLoad - Additional probes to be loaded (i.e. background probes.)</span>
<a name="l01345"></a>01345 <span class="comment"> * @param probeSubset - Bitmap to remember the probes that were actually loaded.</span>
<a name="l01346"></a>01346 <span class="comment"> */</span>
<a name="l01347"></a>01347 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::loadCdfLayout(    <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> &amp;layout, 
<a name="l01348"></a>01348                                                 vector&lt;MetaProbeset *&gt; &amp;metaToLoad,
<a name="l01349"></a>01349                                                 <span class="keyword">const</span> vector&lt;Probe *&gt; &amp;probesToLoad, 
<a name="l01350"></a>01350                                                 std::vector&lt;const char *&gt; *probesetNames,
<a name="l01351"></a>01351                                                 vector&lt;bool&gt; &amp;probeSubset, 
<a name="l01352"></a>01352                                                 <span class="keywordtype">bool</span> justStats, 
<a name="l01353"></a>01353                                                 <span class="keywordtype">bool</span> doAll,
<a name="l01354"></a>01354                                                 probeidmap_t &amp;killList)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356   set&lt;const char *, Util::ltstr&gt; psNameLoadMap;
<a name="l01357"></a>01357   <span class="keywordtype">string</span> cdfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>);
<a name="l01358"></a>01358   <span class="keywordtype">string</span> spfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360   <span class="comment">// Are we doing a subset of all the probe sets? </span>
<a name="l01361"></a>01361   <span class="keywordflow">if</span>(!metaToLoad.empty() &amp;&amp; !doAll) {
<a name="l01362"></a>01362     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; metaToLoad.size(); i++) {
<a name="l01363"></a>01363       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> psIx = 0; psIx &lt; metaToLoad[i]-&gt;probesets.size(); psIx++) { 
<a name="l01364"></a>01364         psNameLoadMap.insert(metaToLoad[i]-&gt;probesets[psIx]);
<a name="l01365"></a>01365       }
<a name="l01366"></a>01366     }
<a name="l01367"></a>01367   }
<a name="l01368"></a>01368   <span class="comment">// Load up the data from the file.</span>
<a name="l01369"></a>01369   <span class="keywordtype">string</span> fileName = cdfFile!=<span class="stringliteral">&quot;&quot;</span> ? cdfFile : spfFile;
<a name="l01370"></a>01370   <span class="keywordflow">try</span> {
<a name="l01371"></a>01371     <span class="keywordflow">if</span>(cdfFile!=<span class="stringliteral">&quot;&quot;</span>) {
<a name="l01372"></a>01372       <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Opening cdf file: &quot;</span>) + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(cdfFile));
<a name="l01373"></a>01373       <span class="keywordflow">if</span>(!layout.<a class="code" href="classChipLayout.html#aa9bdb0e181302d4953aab10ed847c7bf" title="Open a file and parse the probe sets.">openCdf</a>(       cdfFile, 
<a name="l01374"></a>01374                                 psNameLoadMap, 
<a name="l01375"></a>01375                                 probesetNames,
<a name="l01376"></a>01376                                 probeSubset, 
<a name="l01377"></a>01377                                 <span class="stringliteral">&quot;&quot;</span>, 
<a name="l01378"></a>01378                                 killList, 
<a name="l01379"></a>01379                                 justStats)) 
<a name="l01380"></a>01380         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Couldn&#39;t open cdf file: &quot;</span> + cdfFile);
<a name="l01381"></a>01381     }
<a name="l01382"></a>01382     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(spfFile!=<span class="stringliteral">&quot;&quot;</span>) {
<a name="l01383"></a>01383       std::set&lt;affxcdf::GeneChipProbeSetType&gt; psTypesToLoad;
<a name="l01384"></a>01384       <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;kill-list&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01385"></a>01385         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Cannot specify probe kill list with spf file&quot;</span>);
<a name="l01386"></a>01386       <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Opening layout file: &quot;</span>) + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(spfFile));
<a name="l01387"></a>01387       layout.<a class="code" href="classChipLayout.html#af902ac26fbddd00db96825c4b9830379" title="Read in probelist data from a simple probe format file.">openSpf</a>(   spfFile, 
<a name="l01388"></a>01388                         psNameLoadMap, 
<a name="l01389"></a>01389                         probesetNames, 
<a name="l01390"></a>01390                         probeSubset,
<a name="l01391"></a>01391                         <span class="stringliteral">&quot;&quot;</span>, 
<a name="l01392"></a>01392                         justStats, 
<a name="l01393"></a>01393                         psTypesToLoad);
<a name="l01394"></a>01394     }
<a name="l01395"></a>01395     <span class="keywordflow">else</span> {
<a name="l01396"></a>01396       <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must have either a cdf file or spf file in cdf mode.&quot;</span>);
<a name="l01397"></a>01397     }
<a name="l01398"></a>01398   }
<a name="l01399"></a>01399   <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="classExcept.html" title="General purpose exception error for error handling.">Except</a> &amp;e) {
<a name="l01400"></a>01400     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(e.<a class="code" href="classExcept.html#a6983a18bbb12fd78301d1ee77b2371ff" title="Standard what() call, just returns error message.">what</a>());
<a name="l01401"></a>01401   }
<a name="l01402"></a>01402   <span class="keywordflow">catch</span>(...) {
<a name="l01403"></a>01403     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Uncaught exception opening file: &#39;&quot;</span> + fileName + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l01404"></a>01404   }
<a name="l01405"></a>01405 }
<a name="l01406"></a>01406 <span class="comment"></span>
<a name="l01407"></a>01407 <span class="comment">/** </span>
<a name="l01408"></a>01408 <span class="comment"> * Read the design of the chip from the pgf &amp; clf files.</span>
<a name="l01409"></a>01409 <span class="comment"> * </span>
<a name="l01410"></a>01410 <span class="comment"> * @param layout - Object to be filled in.</span>
<a name="l01411"></a>01411 <span class="comment"> * @param metaToLoad</span>
<a name="l01412"></a>01412 <span class="comment"> * @param probesToLoad - Additional probes to be loaded (i.e. background probes.)</span>
<a name="l01413"></a>01413 <span class="comment"> * @param probeSubset - Bitmap to remember the probes that were actually loaded.</span>
<a name="l01414"></a>01414 <span class="comment"> * @param killList  </span>
<a name="l01415"></a>01415 <span class="comment"> */</span>
<a name="l01416"></a>01416 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::loadPgfLayout(    <a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> &amp;layout, 
<a name="l01417"></a>01417                                                 std::vector&lt;MetaProbeset *&gt; &amp;metaToLoad,
<a name="l01418"></a>01418                                                 <span class="keyword">const</span> std::vector&lt;Probe *&gt; &amp;probesToLoad, 
<a name="l01419"></a>01419                                                 std::vector&lt;const char *&gt; *probesetNames,
<a name="l01420"></a>01420                                                 std::vector&lt;bool&gt; &amp;probeSubset, 
<a name="l01421"></a>01421                                                 probeidmap_t &amp;killList,
<a name="l01422"></a>01422                                                 <span class="keywordtype">bool</span> justStats, <span class="keywordtype">bool</span> doAll) {
<a name="l01423"></a>01423   <a class="code" href="classaffx_1_1ClfFile.html" title="To be called a CLF file, the file requires.">affx::ClfFile</a> clf;
<a name="l01424"></a>01424   vector&lt;string&gt; requiredCols;
<a name="l01425"></a>01425   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l01426"></a>01426   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numProbes = 0;
<a name="l01427"></a>01427   std::set&lt;const char *, Util::ltstr&gt; psIdLoadMap;
<a name="l01428"></a>01428   vector&lt;unsigned int&gt; psIdNotInGroup;
<a name="l01429"></a>01429   std::string pgfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>); 
<a name="l01430"></a>01430   std::string clfFile = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;clf-file&quot;</span>);
<a name="l01431"></a>01431 
<a name="l01432"></a>01432   <span class="comment">/* open clf file. */</span>
<a name="l01433"></a>01433   <span class="keywordflow">if</span> (clfFile==<span class="stringliteral">&quot;&quot;</span>)
<a name="l01434"></a>01434     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify a clf-file for chip.&quot;</span>);
<a name="l01435"></a>01435   <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Opening clf file: &quot;</span>) +  <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(clfFile));
<a name="l01436"></a>01436   <span class="keywordflow">if</span>(!clf.<a class="code" href="classaffx_1_1ClfFile.html#adc9c176d87fb24e08f2043983eb621c5" title="Open a CLF file ///.">open</a>(clfFile))
<a name="l01437"></a>01437     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Couldn&#39;t open clf file: &quot;</span>) + clfFile);
<a name="l01438"></a>01438   layout.<a class="code" href="classChipLayout.html#a5183f26edeb8f361999fe3cd6718bb40" title="Set the x and y dimensions for the array.">setDimensions</a>(clf.getXMax() + 1, clf.getYMax() + 1);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   <span class="comment">/* Make sure our assumptions about CLF file are true */</span>
<a name="l01441"></a>01441   <a class="code" href="classErr.html#ad1a633f602fe60689cdc12d9ca1842e9" title="errAbort based version of assert with an error message.">Err::check</a>(clf.<a class="code" href="classaffx_1_1ClfFile.html#a57e85ecd6068ca189d2681bbcde39657" title="Return the value of the sequential header ///.">getSequential</a>() == 1,
<a name="l01442"></a>01442              <span class="stringliteral">&quot;ProbesetSummarizeStageEngine::loadPgfLayout() - unable to handle clf file without sequential set to 1.&quot;</span>);
<a name="l01443"></a>01443   <a class="code" href="classErr.html#ad1a633f602fe60689cdc12d9ca1842e9" title="errAbort based version of assert with an error message.">Err::check</a>(clf.<a class="code" href="classaffx_1_1ClfFile.html#ac4945d44ecfd36f422fd756b1f733cf3" title="Return the value of the order header ///.">getOrder</a>().compare(<span class="stringliteral">&quot;col_major&quot;</span>) == 0 || clf.<a class="code" href="classaffx_1_1ClfFile.html#ac4945d44ecfd36f422fd756b1f733cf3" title="Return the value of the order header ///.">getOrder</a>().compare(<span class="stringliteral">&quot;row_major&quot;</span>) == 0,
<a name="l01444"></a>01444              <span class="stringliteral">&quot;Unable to handle clf file without order set to row_major (old mislabeled &#39;col_major&#39; accepted due to earlier bug.)&quot;</span>);
<a name="l01445"></a>01445   
<a name="l01446"></a>01446   <span class="comment">/* What probes are we loading? */</span>
<a name="l01447"></a>01447   numProbes = (clf.getXMax() + 1) * (clf.getYMax() + 1);
<a name="l01448"></a>01448   probeSubset.resize(numProbes);
<a name="l01449"></a>01449   <span class="keywordflow">for</span>(i = 0; i &lt; probeSubset.size(); i++) 
<a name="l01450"></a>01450     probeSubset[i] = <span class="keyword">false</span>;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452   <span class="comment">// Are we doing a subset of all the probe sets? </span>
<a name="l01453"></a>01453   <span class="keywordflow">if</span>(!metaToLoad.empty() &amp;&amp; !doAll) {
<a name="l01454"></a>01454     <span class="keywordflow">for</span>(i = 0; i &lt; metaToLoad.size(); i++) {
<a name="l01455"></a>01455       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> psIx = 0; psIx &lt; metaToLoad[i]-&gt;probesets.size(); psIx++) { 
<a name="l01456"></a>01456         psIdLoadMap.insert(metaToLoad[i]-&gt;probesets[psIx]);
<a name="l01457"></a>01457       }
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459   }
<a name="l01460"></a>01460   
<a name="l01461"></a>01461   <span class="comment">/* Open actual pgf file. */</span>
<a name="l01462"></a>01462   <span class="keywordflow">if</span>(<a class="code" href="classUtil.html#a0d2126d2d7027b17fdcba5f94e18567e" title="Check to see if two strings are the same.">Util::sameString</a>(pgfFile,<span class="stringliteral">&quot;&quot;</span>)) 
<a name="l01463"></a>01463     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must specify PGF for chip.&quot;</span>);
<a name="l01464"></a>01464   <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(1, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Opening pgf file: &quot;</span>) + <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(pgfFile));
<a name="l01465"></a>01465   time_t startTime = time(NULL);
<a name="l01466"></a>01466   <span class="keywordflow">if</span>(!layout.<a class="code" href="classChipLayout.html#a565b406afe91fd7b595ca2461f17c3dc" title="Open and parse out the data of a file.">openPgf</a>(pgfFile, clf.getXMax() + 1, clf.getYMax() + 1, psIdLoadMap, probesetNames, NULL,
<a name="l01467"></a>01467                   probeSubset, <span class="stringliteral">&quot;&quot;</span>, killList, justStats, <span class="keyword">false</span>)) {
<a name="l01468"></a>01468     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Couldn&#39;t open PGF file: &quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(pgfFile));
<a name="l01469"></a>01469   }
<a name="l01470"></a>01470   time_t endTime = time(NULL);
<a name="l01471"></a>01471   <span class="keywordtype">int</span> t = endTime - startTime;
<a name="l01472"></a>01472   <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot;Pgf load took approximately: &quot;</span>) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(t) + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(<span class="stringliteral">&quot; seconds.&quot;</span>));
<a name="l01473"></a>01473 }
<a name="l01474"></a>01474 
<a name="l01475"></a>01475 <span class="comment"></span>
<a name="l01476"></a>01476 <span class="comment">/** </span>
<a name="l01477"></a>01477 <span class="comment"> * Load up the probe set definitions.</span>
<a name="l01478"></a>01478 <span class="comment"> * </span>
<a name="l01479"></a>01479 <span class="comment"> * @param layout - Object to be filled in.</span>
<a name="l01480"></a>01480 <span class="comment"> * @param psGroups - Probe sets to be filled in.</span>
<a name="l01481"></a>01481 <span class="comment"> * @param metaToLoad</span>
<a name="l01482"></a>01482 <span class="comment"> * @param killList  </span>
<a name="l01483"></a>01483 <span class="comment"> * @param probesToLoad - Additional probes to be loaded (i.e. background probes.)</span>
<a name="l01484"></a>01484 <span class="comment"> * @param probeSubset - Bitmap to remember the probes that were actually loaded.</span>
<a name="l01485"></a>01485 <span class="comment"> * @param probetIds </span>
<a name="l01486"></a>01486 <span class="comment"> * @param probesetNames</span>
<a name="l01487"></a>01487 <span class="comment"> */</span>
<a name="l01488"></a>01488 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::loadChipLayout(<a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a> &amp;layout, 
<a name="l01489"></a>01489                                              vector&lt;MetaProbeset *&gt; &amp;metaToLoad,  
<a name="l01490"></a>01490                                              probeidmap_t &amp;killList,
<a name="l01491"></a>01491                                              std::vector&lt;const char *&gt; *probesetNames,
<a name="l01492"></a>01492                                              <span class="keyword">const</span> vector&lt;Probe *&gt; &amp;probesToLoad, 
<a name="l01493"></a>01493                                              vector&lt;bool&gt; &amp;probeSubset, 
<a name="l01494"></a>01494                                              <span class="keywordtype">bool</span> justStats, 
<a name="l01495"></a>01495                                              <span class="keywordtype">bool</span> doAll)
<a name="l01496"></a>01496 {
<a name="l01497"></a>01497   <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span> || <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>) 
<a name="l01498"></a>01498     loadCdfLayout(layout,
<a name="l01499"></a>01499                   metaToLoad, 
<a name="l01500"></a>01500                   probesToLoad, 
<a name="l01501"></a>01501                   probesetNames, 
<a name="l01502"></a>01502                   probeSubset, 
<a name="l01503"></a>01503                   justStats, 
<a name="l01504"></a>01504                   doAll, 
<a name="l01505"></a>01505                   killList);
<a name="l01506"></a>01506   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l01507"></a>01507     loadPgfLayout(      layout, 
<a name="l01508"></a>01508                         metaToLoad, 
<a name="l01509"></a>01509                         probesToLoad, 
<a name="l01510"></a>01510                         probesetNames, 
<a name="l01511"></a>01511                         probeSubset, 
<a name="l01512"></a>01512                         killList, 
<a name="l01513"></a>01513                         justStats, 
<a name="l01514"></a>01514                         doAll);
<a name="l01515"></a>01515   <span class="keywordflow">else</span>
<a name="l01516"></a>01516     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Must be in either pgf or cdf mode.&quot;</span>);
<a name="l01517"></a>01517   <span class="keywordflow">if</span>(metaToLoad.empty()) {
<a name="l01518"></a>01518     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(3, <span class="stringliteral">&quot;Making metasets from probesets.&quot;</span>);
<a name="l01519"></a>01519     metaToLoad.reserve(probesetNames-&gt;size());
<a name="l01520"></a>01520     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> psIx = 0; psIx &lt; probesetNames-&gt;size(); psIx++) {
<a name="l01521"></a>01521       <a class="code" href="classMetaProbeset.html" title="Very basic class to store the meta probesets (groups of probesets) that a user specifies for analysis...">MetaProbeset</a> *<span class="keyword">set</span> = <span class="keyword">new</span> <a class="code" href="classMetaProbeset.html" title="Very basic class to store the meta probesets (groups of probesets) that a user specifies for analysis...">MetaProbeset</a>();
<a name="l01522"></a>01522       <span class="keyword">set</span>-&gt;freeSubs = <span class="keyword">false</span>;
<a name="l01523"></a>01523       <span class="keyword">set</span>-&gt;name = (*probesetNames)[psIx];
<a name="l01524"></a>01524       <span class="keyword">set</span>-&gt;probesets.resize(1);
<a name="l01525"></a>01525       <span class="keyword">set</span>-&gt;probesets[0] = <span class="keyword">set</span>-&gt;name;
<a name="l01526"></a>01526       metaToLoad.push_back(<span class="keyword">set</span>);
<a name="l01527"></a>01527     }
<a name="l01528"></a>01528     <a class="code" href="classVerbose.html#ac4034f68f4c8d2b49cd6340984b940ce" title="Print a message to the stream.">Verbose::out</a>(2, <span class="stringliteral">&quot;Making metasets from probesets.&quot;</span>);
<a name="l01529"></a>01529   }
<a name="l01530"></a>01530 }
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 <span class="keywordtype">void</span>
<a name="l01533"></a>01533 ProbesetSummarizeStageEngine::determineDesiredOrder(<a class="code" href="classChipLayout.html" title="ChipLayout - Data structure to represent the probesets encoded in the CDF, SPF or PGF files which def...">ChipLayout</a>&amp; layout,
<a name="l01534"></a>01534                                                vector&lt;int&gt; &amp;desiredOrder, 
<a name="l01535"></a>01535                                                <span class="keywordtype">bool</span> haveSubset,
<a name="l01536"></a>01536                                                vector&lt;MetaProbeset *&gt; &amp;metaSets) {
<a name="l01537"></a>01537 
<a name="l01538"></a>01538   <span class="comment">// If no meta probesets then just use the layout in the cdf/spf/pgf</span>
<a name="l01539"></a>01539   <span class="comment">// Fill in probes that weren&#39;t seen</span>
<a name="l01540"></a>01540   vector&lt;int&gt; seen(layout.<a class="code" href="classChipLayout.html#abedbffee7c6a978e3e5545d659a78ec7" title="Get the total number of probes on this chip.">getProbeCount</a>());
<a name="l01541"></a>01541   fill(seen.begin(), seen.end(), -1);
<a name="l01542"></a>01542   desiredOrder.reserve(seen.size());
<a name="l01543"></a>01543   <span class="keywordflow">if</span>(!haveSubset) {
<a name="l01544"></a>01544     <span class="keyword">const</span> vector&lt;int&gt; &amp;layoutOrder = layout.getProbeLayoutOrder();
<a name="l01545"></a>01545     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; layoutOrder.size(); i++) {
<a name="l01546"></a>01546       <span class="keywordflow">if</span>(seen[layoutOrder[i]] &lt; 0) {
<a name="l01547"></a>01547         seen[layoutOrder[i]] = desiredOrder.size();
<a name="l01548"></a>01548         desiredOrder.push_back(layoutOrder[i]);
<a name="l01549"></a>01549       }
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551   }
<a name="l01552"></a>01552   <span class="comment">// If meta sets then we want to order in the same order as the</span>
<a name="l01553"></a>01553   <span class="comment">// meta probesets.</span>
<a name="l01554"></a>01554   <span class="keywordflow">else</span> {
<a name="l01555"></a>01555     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; metaSets.size(); i++) {
<a name="l01556"></a>01556         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; metaSets[i]-&gt;probesets.size(); j++) {
<a name="l01557"></a>01557             <a class="code" href="classProbeListPacked.html">ProbeListPacked</a> pl = layout.<a class="code" href="classChipLayout.html#ae465f92816b1c9983a45d1f73293cc7b" title="Find a probe set using the name as a key.">getProbeListByName</a>(metaSets[i]-&gt;probesets[j]);
<a name="l01558"></a>01558             <span class="keywordflow">if</span> (!pl.isNull()) {
<a name="l01559"></a>01559                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pIx = 0; pIx &lt; pl.probe_cnt(); pIx++) {
<a name="l01560"></a>01560                   <span class="keywordflow">if</span>(seen[pl.get_probeId(pIx)] &lt; 0) {
<a name="l01561"></a>01561                     seen[pl.get_probeId(pIx)] = desiredOrder.size();
<a name="l01562"></a>01562                     desiredOrder.push_back(pl.get_probeId(pIx));
<a name="l01563"></a>01563                   }
<a name="l01564"></a>01564                 }
<a name="l01565"></a>01565             }
<a name="l01566"></a>01566         }
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568   }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; seen.size(); i++) {
<a name="l01571"></a>01571     <span class="keywordflow">if</span>(seen[i] &lt; 0) {
<a name="l01572"></a>01572       desiredOrder.push_back(i);
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574   }
<a name="l01575"></a>01575 }
<a name="l01576"></a>01576 
<a name="l01577"></a>01577 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::addProbeSet(<a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *basicPs, <a class="code" href="classProbeSet.html" title="Collection of atoms that measure target that should be absent or present at the same time...">ProbeSet</a> *currentPs) {
<a name="l01578"></a>01578   <span class="keywordflow">if</span>(basicPs-&gt;<a class="code" href="classProbeSet.html#a23b9df97be8aacc01ad21642b8c966b9" title="Number of atoms in each group, used to get the offsets into the atoms vector.">atomsPerGroup</a>.size() != 1) {
<a name="l01579"></a>01579     <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;addProbeset() - Error: Can&#39;t merge probesets with more than one block&quot;</span>);
<a name="l01580"></a>01580   }
<a name="l01581"></a>01581   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; currentPs-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.size(); i++) {
<a name="l01582"></a>01582     basicPs-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>.push_back(currentPs-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>[i]);<span class="comment"></span>
<a name="l01583"></a>01583 <span class="comment">    ///@todo we should really make sure that PM-only and PM-MM probesets are merged correctly</span>
<a name="l01584"></a>01584 <span class="comment"></span>    <span class="keywordflow">if</span>(basicPs-&gt;hasMM() != currentPs-&gt;hasMM())
<a name="l01585"></a>01585         <a class="code" href="classErr.html#a121c0cbb1687c93444a1b5f7f6ea56af" title="Print the message supplied and abort program.">Err::errAbort</a>(<span class="stringliteral">&quot;Cannot merge probesets which have MM with those that do not.&quot;</span>);
<a name="l01586"></a>01586     basicPs-&gt;<a class="code" href="classProbeSet.html#a23b9df97be8aacc01ad21642b8c966b9" title="Number of atoms in each group, used to get the offsets into the atoms vector.">atomsPerGroup</a>[0] += (currentPs-&gt;hasMM() ? 
<a name="l01587"></a>01587             currentPs-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>[i]-&gt;probes.size() / 2 : currentPs-&gt;<a class="code" href="classProbeSet.html#ab92eb06095441bf193a6fce3f758540b" title="Atoms that make up this probe set.">atoms</a>[i]-&gt;probes.size());
<a name="l01588"></a>01588   }
<a name="l01589"></a>01589 
<a name="l01590"></a>01590 }
<a name="l01591"></a>01591 
<a name="l01592"></a>01592 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::fillInAnalysisInfo(<a class="code" href="classAnalysisInfo.html" title="Information about a particular analysis run.">AnalysisInfo</a> &amp;info, <a class="code" href="classQuantMethod.html" title="QuantMethod - Interface for computing quantification summaries from PM intensities grouped into probe...">QuantMethod</a> *qMethod, std::string prefix) {<span class="comment"></span>
<a name="l01593"></a>01593 <span class="comment">    ///@todo need to refactor to ensure consistency between meta info tracked in probeset-summarize</span>
<a name="l01594"></a>01594 <span class="comment">    ///      versus probeset-genotype</span>
<a name="l01595"></a>01595 <span class="comment">    ///@todo automatically pull state and options info?</span>
<a name="l01596"></a>01596 <span class="comment">    ///@todo sync up option name with label in chp header</span>
<a name="l01597"></a>01597 <span class="comment"></span>    <span class="comment">// FOR NOW -- PLEASE KEEP THIS IN SYNC WITH probeset-genotype</span>
<a name="l01598"></a>01598     vector&lt;string&gt; celFiles = <a class="code" href="classOptions.html#ab20d0083424d9d9a8b94da46f487f57a" title="Return a vector of values for a particular option.">getOptVector</a>(<span class="stringliteral">&quot;cels&quot;</span>);
<a name="l01599"></a>01599     <a class="code" href="classErr.html#ad1a633f602fe60689cdc12d9ca1842e9" title="errAbort based version of assert with an error message.">Err::check</a>(qMethod != NULL, <span class="stringliteral">&quot;Options::fillInAnalysisInfo() - Must have quantification method.&quot;</span>);
<a name="l01600"></a>01600     info.<a class="code" href="classAnalysisInfo.html#a485fade346a6f248b915cbd0a6e1041c" title="What version of the algorithm is being used.">m_AlgVersion</a> = qMethod-&gt;<a class="code" href="classQuantMethod.html#a4799b1ab9adeff7ea3681938367ae670" title="What version of the expression algorithm are we implementing?">getVersion</a>();
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     info.<a class="code" href="classAnalysisInfo.html#a2cc9986186213673fb4ca8decc70124e" title="What is the name of the program.">m_ProgramName</a> = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-name&quot;</span>);
<a name="l01603"></a>01603     info.<a class="code" href="classAnalysisInfo.html#a705a56532115d0c0c8f10644e633b64d" title="What program created this chp file.">m_ProgramVersion</a> = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;version-to-report&quot;</span>);
<a name="l01604"></a>01604     info.<a class="code" href="classAnalysisInfo.html#aa1f9eedaa9c2024dfde2af6a71155bb1" title="What company created this chp file.">m_ProgramCompany</a> = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-company&quot;</span>);
<a name="l01605"></a>01605     info.<a class="code" href="classAnalysisInfo.html#a89c1bfe7a31fccc70d06cb42f68c435e" title="What chip is this?">m_ChipType</a> = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chip-type&quot;</span>);
<a name="l01606"></a>01606     info.<a class="code" href="classAnalysisInfo.html#aa32b7ba5f935bc64316e903980e9acbe" title="What is our id for GCOS?">m_ProgID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01607"></a>01607     info.<a class="code" href="classAnalysisInfo.html#ad906bb9bddd45bd2d3ed08ee3eff5fd3" title="GUID associated with a specific process.">m_ExecGuid</a> = <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>);
<a name="l01608"></a>01608 
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="comment">// State and Execution info</span>
<a name="l01611"></a>01611     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(<span class="stringliteral">&quot;apt-engine&quot;</span>, <span class="stringliteral">&quot;ProbesetSummarizeStageEngine&quot;</span>);
<a name="l01612"></a>01612     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;program-name&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-name&quot;</span>));
<a name="l01613"></a>01613     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;command-line&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;command-line&quot;</span>));
<a name="l01614"></a>01614     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;exec-guid&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;exec-guid&quot;</span>));
<a name="l01615"></a>01615     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;analysis-guid&quot;</span>, info.<a class="code" href="classAnalysisInfo.html#ab9d3f400692f10270650ed0f02e8d2a0" title="GUID (global unique ID) associated with a specific analysis.">m_AnalysisGuid</a>);
<a name="l01616"></a>01616     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;time-str&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;time-start&quot;</span>));
<a name="l01617"></a>01617     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;version&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;version-to-report&quot;</span>));
<a name="l01618"></a>01618     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;cvs-id&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;program-cvs-id&quot;</span>));
<a name="l01619"></a>01619     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + <span class="stringliteral">&quot;free-mem&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;free-mem-at-start&quot;</span>));<span class="comment"></span>
<a name="l01620"></a>01620 <span class="comment">    ///@todo add other state:</span>
<a name="l01621"></a>01621 <span class="comment">    ///@todo time-end state</span>
<a name="l01622"></a>01622 <span class="comment"></span>
<a name="l01623"></a>01623     <span class="comment">// Engine Options</span>
<a name="l01624"></a>01624     std::string subprefix = <span class="stringliteral">&quot;opt-&quot;</span>;<span class="comment"></span>
<a name="l01625"></a>01625 <span class="comment">    ///@todo probably remove do-ps-names -- no longer an option</span>
<a name="l01626"></a>01626 <span class="comment"></span>    info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;do-ps-names&quot;</span>,   (<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>) != <span class="stringliteral">&quot;&quot;</span> || <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>)!=<span class="stringliteral">&quot;&quot;</span> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>));
<a name="l01627"></a>01627     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;chip-type&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;chip-type&quot;</span>));
<a name="l01628"></a>01628     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;probe-count&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probe-count&quot;</span>));
<a name="l01629"></a>01629     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;force&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;force&quot;</span>));
<a name="l01630"></a>01630     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;precision&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;precision&quot;</span>));
<a name="l01631"></a>01631     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;out-dir&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;out-dir&quot;</span>));
<a name="l01632"></a>01632     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;cc-expr-chp-out-dir&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-chp-out-dir&quot;</span>));
<a name="l01633"></a>01633     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;cc-md-chp-out-dir&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cc-md-chp-out-dir&quot;</span>));
<a name="l01634"></a>01634     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;xda-chp-out-dir&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;xda-chp-out-dir&quot;</span>));
<a name="l01635"></a>01635     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;cdf-file&quot;</span>,       <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;cdf-file&quot;</span>)));
<a name="l01636"></a>01636     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;spf-file&quot;</span>,       <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;spf-file&quot;</span>)));
<a name="l01637"></a>01637     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;pgf-file&quot;</span>,       <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;pgf-file&quot;</span>)));
<a name="l01638"></a>01638     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;clf-file&quot;</span>,       <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;clf-file&quot;</span>)));
<a name="l01639"></a>01639     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;bgp-file&quot;</span>,       <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;bgp-file&quot;</span>)));
<a name="l01640"></a>01640     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;ps-list-file&quot;</span>,   <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;probeset-ids&quot;</span>)));
<a name="l01641"></a>01641     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;meta-ps-file&quot;</span>,   <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;meta-probesets&quot;</span>)));
<a name="l01642"></a>01642     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;qc-groups-file&quot;</span>, <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;qc-probesets&quot;</span>)));
<a name="l01643"></a>01643     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;kill-list&quot;</span>,      <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;kill-list&quot;</span>)));
<a name="l01644"></a>01644     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;temp-dir&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;temp-dir&quot;</span>));
<a name="l01645"></a>01645     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;use-disk&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;use-disk&quot;</span>));
<a name="l01646"></a>01646     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;diskCache&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;disk-cache&quot;</span>));
<a name="l01647"></a>01647     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;cel-count&quot;</span>, <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(celFiles.size()));
<a name="l01648"></a>01648     <span class="keywordflow">for</span>(uint32_t i = 0; i &lt; celFiles.size(); i++) {
<a name="l01649"></a>01649       std::string paramName = prefix + subprefix + <span class="stringliteral">&quot;cel-&quot;</span> + <a class="code" href="Convert_8h.html#a9e68e488e4da0371aea30596313537df" title="Little template function to make string conversion easy.">ToStr</a>(i+1);
<a name="l01650"></a>01650       info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(paramName, <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(celFiles[i]));
<a name="l01651"></a>01651     }
<a name="l01652"></a>01652 
<a name="l01653"></a>01653     <span class="comment">// Algorithm Options</span>
<a name="l01654"></a>01654     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;analysis-name&quot;</span>, info.<a class="code" href="classAnalysisInfo.html#a4e52df55ab7398557852b211c5a50d41" title="What algorithm are we reporting.">m_AlgName</a>);
<a name="l01655"></a>01655     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;set-analysis-name&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;set-analysis-name&quot;</span>));
<a name="l01656"></a>01656     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;analysis-spec&quot;</span>, info.<a class="code" href="classAnalysisInfo.html#a4e52df55ab7398557852b211c5a50d41" title="What algorithm are we reporting.">m_AlgName</a>);
<a name="l01657"></a>01657     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;feat-effect-file&quot;</span>, <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;use-feat-eff&quot;</span>)));
<a name="l01658"></a>01658     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;target-sketch-file&quot;</span>, <a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;target-sketch&quot;</span>)));
<a name="l01659"></a>01659     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;do-residuals&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;feat-details&quot;</span>));
<a name="l01660"></a>01660     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;do-feature-effects&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;feat-effects&quot;</span>));
<a name="l01661"></a>01661     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;write-sketch&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;write-sketch&quot;</span>));
<a name="l01662"></a>01662     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;reference-profile-file&quot;</span>,<a class="code" href="classFs.html#a16925724086de1c12ea58bad4f8df75c" title="like the unix function of the same name. ///">Fs::basename</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;reference-profile&quot;</span>)));
<a name="l01663"></a>01663     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(prefix + subprefix + <span class="stringliteral">&quot;write-profile&quot;</span>, <a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;write-profile&quot;</span>));
<a name="l01664"></a>01664 
<a name="l01665"></a>01665     <span class="comment">// Quantification Related Meta Info</span>
<a name="l01666"></a>01666     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(<span class="stringliteral">&quot;quantification-name&quot;</span>, qMethod-&gt;<a class="code" href="classQuantMethod.html#ab1b819505891590c9f3e57d9cc67d4de" title="What is the name of the quantification method?">getType</a>());
<a name="l01667"></a>01667     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(<span class="stringliteral">&quot;quantification-version&quot;</span>, qMethod-&gt;<a class="code" href="classQuantMethod.html#a4799b1ab9adeff7ea3681938367ae670" title="What version of the expression algorithm are we implementing?">getVersion</a>());
<a name="l01668"></a>01668     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(<span class="stringliteral">&quot;quantification-scale&quot;</span>, <a class="code" href="classQuantMethod.html#a6a4921cca844ef99404228081863c8c4" title="Convert a Scale enumeration to a text description.">QuantMethod::scaleToTxt</a>(qMethod-&gt;<a class="code" href="classQuantMethod.html#a2284897bb0665c4cea9f8e030e20d796" title="What scale are the target effects on? Are they linear (like plier) or log2 (like rma).">getScale</a>()));
<a name="l01669"></a>01669     info.<a class="code" href="classAnalysisInfo.html#af479563f1370004fffb4b14f67aefe23" title="Add a key/value parameter pair to our inforomation.">addParam</a>(<span class="stringliteral">&quot;quantification-type&quot;</span>, <a class="code" href="classQuantMethod.html#aaab461044d36fd604004b47934b209d3" title="Convert a QuantType enumeration to a human readable string representation.">QuantMethod::quantTypeToTxt</a>(qMethod-&gt;<a class="code" href="classQuantMethod.html#a2889dd697efae0503edd00e4087e991b" title="What type of quantification method is this? Summarization like plier detection like dabg...">getQuantType</a>()));
<a name="l01670"></a>01670 }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 
<a name="l01673"></a>01673 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::printStandardMethods(std::ostream &amp;out) {
<a name="l01674"></a>01674       map&lt;string,string&gt;::iterator iter;
<a name="l01675"></a>01675       out &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;Standard Methods:&quot;</span> &lt;&lt; endl;
<a name="l01676"></a>01676       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxLength = 0;
<a name="l01677"></a>01677       <span class="keywordflow">for</span>(iter = m_stdMethods.begin(); iter != m_stdMethods.end(); iter++) {
<a name="l01678"></a>01678         <span class="keywordflow">if</span>(iter-&gt;first.size() &gt; maxLength)
<a name="l01679"></a>01679           maxLength = iter-&gt;first.size();
<a name="l01680"></a>01680       }
<a name="l01681"></a>01681       <span class="keywordflow">for</span>(iter = m_stdMethods.begin(); iter != m_stdMethods.end(); iter++) {
<a name="l01682"></a>01682         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentLength = 0;
<a name="l01683"></a>01683         out &lt;&lt; <span class="stringliteral">&quot; &#39;&quot;</span> &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">&quot;&#39; &quot;</span>;
<a name="l01684"></a>01684         currentLength = iter-&gt;first.size();
<a name="l01685"></a>01685         <span class="keywordflow">while</span>(currentLength &lt; maxLength + 1) {
<a name="l01686"></a>01686           out.put(<span class="charliteral">&#39; &#39;</span>);
<a name="l01687"></a>01687           currentLength++;
<a name="l01688"></a>01688         }
<a name="l01689"></a>01689         out &lt;&lt; iter-&gt;second &lt;&lt; endl;
<a name="l01690"></a>01690       }
<a name="l01691"></a>01691 }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::closeGlobalA5() {
<a name="l01694"></a>01694   <span class="comment">// A5 close global groups</span>
<a name="l01695"></a>01695   <span class="keywordflow">if</span> (m_a5_global_output_group!=NULL) {
<a name="l01696"></a>01696     m_a5_global_output_group-&gt;close();
<a name="l01697"></a>01697     <span class="keyword">delete</span> m_a5_global_output_group;
<a name="l01698"></a>01698     m_a5_global_output_group=NULL;
<a name="l01699"></a>01699   }
<a name="l01700"></a>01700   <span class="keywordflow">if</span> (m_a5_global_input_group!=NULL) {
<a name="l01701"></a>01701     m_a5_global_input_group-&gt;close();
<a name="l01702"></a>01702     <span class="keyword">delete</span> m_a5_global_input_group;
<a name="l01703"></a>01703     m_a5_global_input_group=NULL;
<a name="l01704"></a>01704   }
<a name="l01705"></a>01705 
<a name="l01706"></a>01706   <span class="comment">// A5 close global files</span>
<a name="l01707"></a>01707   <span class="keywordflow">if</span>(m_a5_global_output_file != m_a5_global_input_file) {
<a name="l01708"></a>01708     affx::TsvReport::closeA5File(m_a5_global_output_file);
<a name="l01709"></a>01709     affx::TsvReport::closeA5File(m_a5_global_input_file);
<a name="l01710"></a>01710   } <span class="keywordflow">else</span> {
<a name="l01711"></a>01711     affx::TsvReport::closeA5File(m_a5_global_output_file);
<a name="l01712"></a>01712     m_a5_global_input_file = NULL;
<a name="l01713"></a>01713   }
<a name="l01714"></a>01714 }
<a name="l01715"></a>01715 
<a name="l01716"></a>01716 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::extraHelp() {
<a name="l01717"></a>01717     <a class="code" href="classChipStreamFactory.html" title="Factory class for making chip streams based on a string representation.">ChipStreamFactory</a> cFactory;
<a name="l01718"></a>01718     <a class="code" href="classPmAdjusterFactory.html" title="Factory class for making chip streams based on a string representation.">PmAdjusterFactory</a> aFactory;
<a name="l01719"></a>01719     <a class="code" href="classQuantMethodFactory.html" title="Factory class for making chip streams based on a string representation.">QuantMethodFactory</a> qFactory(QuantMethodFactory::Expression);
<a name="l01720"></a>01720     <a class="code" href="classAnalysisStreamFactory.html" title="Object for making new analysis streams from a text specification.">AnalysisStreamFactory</a> asFactory;
<a name="l01721"></a>01721 
<a name="l01722"></a>01722     printStandardMethods(cout);
<a name="l01723"></a>01723     <a class="code" href="classEngineUtil.html#ac60d1bb1a13c6bb184c42089ac962095" title="Print out a header and then a series of self documenting objects.">EngineUtil::printSelfDocs</a>(<span class="stringliteral">&quot;Data transformations:&quot;</span>, cFactory.<a class="code" href="classChipStreamFactory.html#a09751e33c85bfda7d8c8addee9cc1918" title="Get the vector of documentation objects that this factory is aware of.">getDocs</a>());
<a name="l01724"></a>01724     <a class="code" href="classEngineUtil.html#ac60d1bb1a13c6bb184c42089ac962095" title="Print out a header and then a series of self documenting objects.">EngineUtil::printSelfDocs</a>(<span class="stringliteral">&quot;Pm Intensity Adjustments:&quot;</span>, aFactory.<a class="code" href="classPmAdjusterFactory.html#a6f54e0030cc442973e3d95752f9c31cc" title="Get the vector of documentation objects that this factory is aware of.">getDocs</a>());
<a name="l01725"></a>01725     <a class="code" href="classEngineUtil.html#ac60d1bb1a13c6bb184c42089ac962095" title="Print out a header and then a series of self documenting objects.">EngineUtil::printSelfDocs</a>(<span class="stringliteral">&quot;Quantification Methods:&quot;</span>, qFactory.getDocs());
<a name="l01726"></a>01726     <a class="code" href="classEngineUtil.html#ac60d1bb1a13c6bb184c42089ac962095" title="Print out a header and then a series of self documenting objects.">EngineUtil::printSelfDocs</a>(<span class="stringliteral">&quot;Analysis Streams:&quot;</span>, asFactory.<a class="code" href="classAnalysisStreamFactory.html#ac7547e5f2c10200dc6bf49ba69e84405" title="Get the vector of documentation objects that this factory is aware of.">getDocs</a>());
<a name="l01727"></a>01727 }
<a name="l01728"></a>01728 
<a name="l01729"></a>01729 <span class="keywordtype">void</span> ProbesetSummarizeStageEngine::explain() {
<a name="l01730"></a>01730     <a class="code" href="classEngineUtil.html#a090e75dbffbe46910abd1fdc41c8b8c7" title="Print out a little ditty for the given type of self documenting object.">EngineUtil::explainParameter</a>(<a class="code" href="classOptions.html#a0efc7e2a4a55297f0f642d1d8bc08b82" title="Get the value of an option.">getOpt</a>(<span class="stringliteral">&quot;explain&quot;</span>));
<a name="l01731"></a>01731 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Mar 23 2016 12:58:49 for Affymetrix Power Tools by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
